<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>EPhone</title>
  <link rel="stylesheet" href="style.css">
  <link rel="apple-touch-icon" href="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1758510900942_qdqqd_djw0z2.jpeg">
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="EPhone">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="icon" type="image/png" href="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1756312261242_qdqqd_g0eriz.jpeg">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <script src="https://unpkg.com/dexie/dist/dexie.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
  <script src="https://phoebeboo.github.io/mewoooo/pp.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/streamsaver@2.0.6/StreamSaver.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
  <script src="online-chat-manager.js" defer></script>
  <script src="online-chat-integration.js" defer></script>
  <script src="sticker-vision.js" defer></script>
  <script src="notification-manager.js" defer></script>
  <script src="character-generator.js" defer></script>
  <script src="script.js" defer="defer"></script>
</head>
<body>
  <div id="phone-screen">
    <div id="status-bar"> <span id="status-bar-time">12:00</span>
      <div id="status-bar-battery" class="battery-container"> <span class="battery-text">--%</span>
        <div class="battery-icon">
          <div class="battery-level"></div>
        </div>
      </div>
    </div>
    <div id="lock-screen">
        <div id="lock-screen-content">
            <div class="lock-icon">üîì</div>
            <div class="lock-time-container">
                <div id="lock-date">1Êúà1Êó• ÊòüÊúü‰∏Ä</div>
                <div id="lock-time">12:00</div>
            </div>
            
            <div id="lock-password-area" style="display: none;">
                <div class="lock-instruction">ËæìÂÖ•ÂØÜÁ†Å</div>
                <div class="lock-dots">
                    <div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
                </div>
                <div class="lock-keypad">
                    <div class="key" data-num="1">1</div>
                    <div class="key" data-num="2">2<br><span>ABC</span></div>
                    <div class="key" data-num="3">3<br><span>DEF</span></div>
                    <div class="key" data-num="4">4<br><span>GHI</span></div>
                    <div class="key" data-num="5">5<br><span>JKL</span></div>
                    <div class="key" data-num="6">6<br><span>MNO</span></div>
                    <div class="key" data-num="7">7<br><span>PQRS</span></div>
                    <div class="key" data-num="8">8<br><span>TUV</span></div>
                    <div class="key" data-num="9">9<br><span>WXYZ</span></div>
                    <div class="key empty"></div>
                    <div class="key" data-num="0">0</div>
                    <div class="key delete" data-action="delete">‚å´</div>
                </div>
                <div class="lock-cancel-btn">ÂèñÊ∂à</div>
            </div>
            
            <div id="lock-swipe-area">
                <div class="swipe-bar"></div>
            </div>
        </div>
    </div>
    <div id="notification-bar"><img id="notification-avatar" src="">
      <div id="notification-content">
        <div class="name"></div>
        <div class="message"></div>
      </div>
    </div>
<div id="dynamic-island-content">
  <img id="island-album-art" src="">
  <div id="island-lyric-container">
    <span id="island-lyric-text"></span>
  </div>
</div>

    <div id="home-screen" class="screen active">
      <div id="home-screen-pages-container">
        <div id="home-screen-pages">
          <div class="home-screen-page">
            <div id="main-content-area">
              <div id="profile-widget"> <img id="profile-banner-img" src="https://i.imgur.com/1n3a43H.jpeg" class="editable-image">
                <div class="profile-avatar-container"> <img id="profile-avatar-img" src="https://i.postimg.cc/y8xWzCqj/anime-boy.jpg" class="editable-image"> </div>
                <div class="profile-info">
                  <p id="profile-username" class="editable-text">@ insonneve ü™¶</p>
                  <p id="profile-sub-username" class="editable-text">@ insonneve</p>
                  <p id="profile-bio" class="editable-text">‰Ω†Â•ΩÂÉèËøáÂæóÂæàÂ•Ω Ëø´‰∏çÂèäÂæÖÁöÑÊäπÂéªÊàëÂ≠òÂú®ÁöÑÁóïËøπ</p>
                  <p id="profile-location" class="editable-text"> <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5-2.5-1.12 2.5-2.5 2.5z"></path>
                    </svg> <span>ÂåóÊµ∑ÈÅì</span> </p>
                </div>
              </div>
              <div id="desktop-layout">
                <div id="desktop-widget-column">
                  <div class="desktop-widget text-only">
                    <p id="widget-text-1" class="editable-text">Be fearless in pursuit of happiness</p>
                  </div>
                  <div class="desktop-widget icon-left"> <img id="widget-avatar-1" src="https://i.imgur.com/1n3a43H.jpeg" class="editable-image"> <span id="widget-text-2" class="editable-text">Dare to be different</span> </div>
                  <div class="desktop-widget icon-right"> <span id="widget-text-3" class="editable-text">* Keep your spirit free</span> <img id="widget-avatar-2" src="https://i.imgur.com/5A0tE9a.jpeg" class="editable-image"> </div>
                </div>
                <div id="desktop-app-container">
                  <div class="desktop-app-icon" onclick="showScreen('chat-list-screen')">
                    <div class="icon-bg-desktop"><img id="icon-img-qq" src="https://i.postimg.cc/MTC3Tkw8/IMG-6436.jpg" alt="QQ"></div> <span class="label"data-lang-key="homeAppQQ">QQ</span>
                  </div>
                  <div class="desktop-app-icon" onclick="showScreen('world-book-screen')">
                    <div class="icon-bg-desktop"><img id="icon-img-world-book" src="https://i.postimg.cc/HWf1JKzn/IMG-6435.jpg" alt="‰∏ñÁïå‰π¶"></div> <span class="label"data-lang-key="homeAppWorldBook">‰∏ñÁïå‰π¶</span>
                  </div>
                  <div class="desktop-app-icon" onclick="showScreen('wallpaper-screen')">
                    <div class="icon-bg-desktop"><img id="icon-img-wallpaper" src="https://i.postimg.cc/T1j03pQr/IMG-6440.jpg" alt="Â§ñËßÇËÆæÁΩÆ"></div> <span class="label"data-lang-key="homeAppAppearance">Â§ñËßÇËÆæÁΩÆ</span>
                  </div>
                  <div class="desktop-app-icon" onclick="openRenderingRulesScreen()">
                    <div class="icon-bg-desktop"><img id="icon-img-renderer" src="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1756312261242_qdqqd_g0eriz.jpeg" alt="Ê∏≤ÊüìÂô®"></div> <span class="label"data-lang-key="homeAppRenderer">Ê∏≤ÊüìÂô®</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="home-screen-page">
            <div class="polaroid-widget-container">
              <div class="polaroid-photos">
                <div class="polaroid-photo" style="transform: rotate(-6deg);" onclick="handleWidgetImageChange('polaroid-img-1')"> <img id="polaroid-img-1" src="https://i.imgur.com/Bv63o3h.jpg" alt="Photo 1"> </div>
                <div class="polaroid-photo" style="transform: rotate(2deg);" onclick="handleWidgetImageChange('polaroid-img-2')"> <img id="polaroid-img-2" src="https://i.imgur.com/GzPzBfF.jpg" alt="Photo 2"> </div>
                <div class="polaroid-photo" style="transform: rotate(5deg);" onclick="handleWidgetImageChange('polaroid-img-3')"> <img id="polaroid-img-3" src="https://i.imgur.com/Wp72cEM.jpg" alt="Photo 3"> </div>
              </div>
            </div>
            <div id="page-2-app-container">
              <div class="left-column-stack">
        <!-- ÂéüÊù•ÁöÑÂ§ßÁªÑ‰ª∂ -->
        <div class="large-widget" onclick="handleWidgetImageChange('large-widget-img')"> 
            <img class="large-widget-img" id="large-widget-img" src="https://i.imgur.com/Bv63o3h.jpg" alt="Colorful Widget"> 
        </div>
        
        <!-- Êñ∞Â¢ûÔºöÂ∑¶‰æß App ÁΩëÊ†º -->
        <div class="left-app-grid">
            <!-- ÊîØ‰ªòÂÆùÂõæÊ†á -->
            <div class="desktop-app-icon" onclick="openAlipayScreen()">
    <div class="icon-bg-desktop">
        <img id="icon-img-alipay" src="https://i.postimg.cc/SK31X0Bb/IMG_2231.png" alt="ÊîØ‰ªòÂÆù">
    </div> 
    <span class="label">ÊîØ‰ªòÂÆù</span>
</div>

<div class="desktop-app-icon" onclick="openAuctionScreen()">
    <div class="icon-bg-desktop"> 
        <img id="icon-img-auction" 
             src="https://i.postimg.cc/Hs7BLh76/alipay.png" 
             alt="ÈªëÂ∏Ç">
    </div>
    <span class="label">ÈªëÂ∏Ç</span>
</div>
<div class="desktop-app-icon" onclick="openGreenRiverScreen()">
    <div class="icon-bg-desktop"> 
        <img id="icon-img-green-river" 
             src="https://i.postimg.cc/0j55Pj1L/green-river-icon.png" 
             alt="ÁªøÊ±ü">
    </div>
    <span class="label">ÁªøÊ±ü</span>
</div>
<div class="desktop-app-icon" onclick="openEmailApp()">
    <div class="icon-bg-desktop"> 
        <img id="icon-img-mail" src="https://i.postimg.cc/PfR7f37x/mail.png" alt="Mail">
    </div>
    <span class="label">ÈÇÆÁÆ±</span>
</div>
            <!-- Êú™Êù•ÂèØ‰ª•Âú®ËøôÈáåÂä†Êõ¥Â§ö App -->
        </div>
    </div>
              <div class="right-column-stack">
    
    <div class="app-subgrid">
        <div class="small-widget" onclick="openPresetScreen()">
            <div class="small-widget-icon-wrapper"> 
                <img class="small-widget-img" id="icon-img-preset" src="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1758510900942_qdqqd_djw0z2.jpeg" alt="È¢ÑËÆæ"> 
            </div> 
            <span class="small-widget-label" data-lang-key="homeAppPreset">È¢ÑËÆæ</span>
        </div>
        <div class="small-widget" onclick="showScreen('tutorial-screen')">
            <div class="small-widget-icon-wrapper"> 
                <img class="small-widget-img" id="icon-img-tutorial" src="https://i.postimg.cc/d10GjC4g/IMG-7302.jpg" alt="ÊïôÁ®ã"> 
            </div> 
            <span class="small-widget-label" data-lang-key="homeAppTutorial">ÊïôÁ®ã</span>
        </div>
        <div class="small-widget" onclick="openWerewolfLobby('global')">
            <div class="small-widget-icon-wrapper"> 
                <img class="small-widget-img" id="icon-img-werewolf" src="https://i.postimg.cc/k401K5g7/IMG-7304.jpg" alt="Áãº‰∫∫ÊùÄ"> 
            </div> 
            <span class="small-widget-label" data-lang-key="homeAppWerewolf">Áãº‰∫∫ÊùÄ</span>
        </div>
        <div class="small-widget" onclick="showScreen('x-social-screen')">
            <div class="small-widget-icon-wrapper"> 
                <img class="small-widget-img" id="icon-img-x" src="https://i.postimg.cc/Y9d3BztC/1.png" alt="X"> 
            </div> 
            <span class="small-widget-label" data-lang-key="homeAppX">X</span>
        </div>
    </div>

    <div class="vinyl-transparent-widget">
                      <div class="vinyl-disc-bg">
                          <img id="vinyl-img" 
                               src="https://i.postimg.cc/y8xWzCqj/anime-boy.jpg" 
                               class="vinyl-cover editable-image" 
                               onclick="handleWidgetImageChange('vinyl-img')">
                      </div>
                      <div class="vinyl-arm-wrapper">
                          <svg width="50" height="120" viewBox="0 0 50 120" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <circle cx="35" cy="15" r="12" fill="white" stroke="#ddd" stroke-width="2"/>
                              <path d="M35 15 L40 80 L25 90" stroke="#ddd" stroke-width="6" stroke-linecap="round" fill="none"/>
                              <path d="M35 15 L40 80 L25 90" stroke="white" stroke-width="3" stroke-linecap="round" fill="none"/>
                              <rect x="18" y="88" width="14" height="22" rx="5" fill="white" stroke="#ddd" stroke-width="2"/>
                              <circle cx="25" cy="102" r="2" fill="#ccc"/>
                              <circle cx="25" cy="96" r="2" fill="#ccc"/>
                          </svg>
                      </div>
                  </div> </div> </div> </div>
          <div class="home-screen-page">
            <div id="page-3-content" style="padding: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 25px; align-content: start;">
              <div class="desktop-app-icon" onclick="openMyphoneScreen()">
                <div class="icon-bg-desktop">
                  <img id="icon-img-myphone" src="https://i.postimg.cc/MTC3Tkw8/IMG-6436.jpg" alt="Myphone">
                </div>
                <span class="label">Myphone</span>
              </div>
              <div class="desktop-app-icon" onclick="openDrawAndGuess()">
                <div class="icon-bg-desktop">
                  <img id="icon-img-draw-guess" src="https://i.postimg.cc/k5dG3B4p/draw-guess-icon.png" alt="‰Ω†ÁîªÊàëÁåú">
                </div>
                <span class="label">‰Ω†ÁîªÊàëÁåú</span>
              </div>
              <div class="desktop-app-icon" onclick="openCharacterGeneratorScreen()">
                <div class="icon-bg-desktop">
                  <img id="icon-img-char-generator" src="https://i.postimg.cc/nzGYM8qb/character-gen.jpg" alt="ËßíËâ≤ÁîüÊàê">
                </div>
                <span class="label">ËßíËâ≤ÁîüÊàê</span>
              </div>
            </div>
          </div>
        </div> </div>
      <div id="home-screen-pagination">
        <div class="pagination-dot active"></div>
        <div class="pagination-dot"></div>
        <div class="pagination-dot"></div>
      </div>
      <div id="desktop-dock">
        <div class="desktop-app-icon" onclick="showScreen('api-settings-screen')">
          <div class="icon-bg-desktop"><img id="icon-img-api-settings" src="https://i.postimg.cc/MK8rJ8t7/IMG-6438.jpg" alt="APIËÆæÁΩÆ"></div> <span class="label"data-lang-key="homeAppApiSettings">APIËÆæÁΩÆ</span>
        </div>
        <div class="desktop-app-icon" onclick="showScreen('font-settings-screen')">
          <div class="icon-bg-desktop"><img id="icon-img-font" src="https://i.postimg.cc/pXxk1JXk/IMG-6442.jpg" alt="Â≠ó‰Ωì"></div> <span class="label"data-lang-key="homeAppFont">Â≠ó‰Ωì</span>
        </div>
        <div class="desktop-app-icon" onclick="openCharacterSelector()">
          <div class="icon-bg-desktop"><img id="icon-img-char-phone" src="https://i.postimg.cc/pXj9h20L/IMG-7275.jpg" alt="Cphone"></div> <span class="label"data-lang-key="homeAppCPhone">Cphone</span>
        </div>
        <div class="desktop-app-icon" onclick="showScreen('douban-screen')">
          <div class="icon-bg-desktop"><img id="icon-img-douban" src="https://i.postimg.cc/Pq2xJN1g/IMG-7301.jpg" alt="Ë±ÜÁì£"></div> <span class="label"data-lang-key="homeAppDouban">Ë±ÜÁì£</span>
        </div>
      </div>
    </div>
    <div id="character-selection-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">‚Äπ</span> <span data-lang-key="cphoneTitleSelect">ÈÄâÊã©‰∏ÄÈÉ®ÊâãÊú∫</span> <span style="width: 30px;"></span> </div>
      <div id="character-grid" class="list-container"> </div>
    </div>
    <div id="character-phone-screen" class="screen">
      <div id="char-home-screen" class="char-screen active">
        <div style="height: 50px;"></div>

        <div id="cphone-pages-container">
          <div id="cphone-pages">
            <div class="cphone-page">
              <div id="cphone-layout-container">
            
            <div class="cphone-staggered-group">
                <div class="cphone-bubble-pill top">
                    <div class="bubble-avatar-container">
                        <img id="cphone-widget-avatar-1" src="https://i.postimg.cc/y8xWzCqj/anime-boy.jpg" class="editable-image" onclick="handleWidgetImageChange('cphone-widget-avatar-1')">
                    </div>
                    <div class="bubble-content left-align" onclick="editBubbleText('cphone-text-1')">
                         
                         <p id="cphone-text-1">Cat radio station‚òÜÔæü.*ÔΩ•ÔΩ°</p>
                         
                    </div>
                </div>
                
                <div class="cphone-bubble-pill bottom">
                    <div class="bubble-content right-align" onclick="editBubbleText('cphone-text-2')">
                        <p id="cphone-text-2" style="font-family: 'Times New Roman', serif;">It's 17:03:42 Now, Good Afternoon‚ú®</p>
                    </div>
                    <div class="bubble-avatar-container">
                        <img id="cphone-widget-avatar-2" src="https://i.postimg.cc/VkQfgzGJ/1.jpg" class="editable-image" onclick="handleWidgetImageChange('cphone-widget-avatar-2')">
                    </div>
                </div>
            </div>

            <div class="cphone-fixed-row">
                <div class="cphone-fixed-app-grid">
                    <div class="app-icon small" onclick="openCharApp('qq')">
                        <div class="icon-bg"><img id="cphone-icon-img-qq" src=""></div><span class="label">QQ</span>
                    </div>
                    <div class="app-icon small" onclick="openCharApp('album')">
                        <div class="icon-bg"><img id="cphone-icon-img-album" src=""></div><span class="label" data-lang-key="cphoneAppAlbum">Áõ∏ÂÜå</span>
                    </div>
                    <div class="app-icon small" onclick="openCharApp('browser')">
                        <div class="icon-bg"><img id="cphone-icon-img-browser" src=""></div><span class="label" data-lang-key="cphoneAppBrowser">ÊµèËßàÂô®</span>
                    </div>
                    <div class="app-icon small" onclick="openCharApp('taobao')">
                        <div class="icon-bg"><img id="cphone-icon-img-taobao" src=""></div><span class="label" data-lang-key="cphoneAppTaobao">Ê∑òÂÆù</span>
                    </div>
                </div>

                <div class="cphone-stack-polaroid">
                    <div class="polaroid-bg-layer"></div>
                    <div class="polaroid-main-layer">
                        <div class="polaroid-photo-frame">
                             <img id="cphone-polaroid-img" src="https://i.imgur.com/Bv63o3h.jpg" class="editable-image" onclick="handleWidgetImageChange('cphone-polaroid-img')">
                        </div>
                    </div>
                </div>
            </div>

            <div class="cphone-fixed-row">
                <div class="cphone-circle-widget-wrapper">
                    <div class="cphone-circle-bg">
                         <img id="cphone-circle-img" src="https://i.imgur.com/Wp72cEM.jpg" class="editable-image" onclick="handleWidgetImageChange('cphone-circle-img')">
                    </div>
                    <div class="circle-text-area">
    <p id="cphone-circle-text" onclick="editBubbleText('cphone-circle-text')">Super happy</p>
    <p id="cphone-circle-subtext" onclick="editBubbleText('cphone-circle-subtext')">Day & Night</p> 
</div>
                </div>

                <div class="cphone-fixed-app-grid">
                     <div class="app-icon small" onclick="openCharApp('memo')">
                        <div class="icon-bg"><img id="cphone-icon-img-memo" src=""></div><span class="label"data-lang-key="cphoneAppMemo">Â§áÂøòÂΩï</span>
                    </div>
                    <div class="app-icon small" onclick="openCharApp('diary')">
                        <div class="icon-bg"><img id="cphone-icon-img-diary" src=""></div><span class="label"data-lang-key="cphoneAppDiary">Êó•ËÆ∞</span>
                    </div>
                    <div class="app-icon small" onclick="openCharApp('amap')">
                        <div class="icon-bg"><img id="cphone-icon-img-amap" src=""></div><span class="label"data-lang-key="cphoneAppAmap">È´òÂæ∑Âú∞Âõæ</span>
                    </div>
                    <div class="app-icon small" onclick="openCharApp('usage')">
                        <div class="icon-bg"><img id="cphone-icon-img-usage" src=""></div><span class="label"data-lang-key="cphoneAppUsage">APPËÆ∞ÂΩï</span>
                    </div>
                </div>
            </div>

              </div>
            </div>

            <!-- CPhone Á¨¨‰∫åÈ°µ -->
            <div class="cphone-page">
              <div id="cphone-page-2-container">
                <div style="height: 80px;"></div>
                
                <div class="cphone-fixed-row">
                  <div class="cphone-fixed-app-grid">
                    <div class="app-icon small" onclick="openCharApp('settings')">
                      <div class="icon-bg"><img id="cphone-icon-img-settings" src="https://i.postimg.cc/mkmMRpqb/settings-icon.png"></div>
                      <span class="label" data-lang-key="cphoneAppSettings">ËÆæÁΩÆ</span>
                    </div>
                  </div>
                </div>

              </div>
            </div>

          </div>
        </div>

        <!-- È°µÈù¢ÊåáÁ§∫Âô® -->
        <div class="cphone-pagination">
          <span class="cphone-pagination-dot active" data-page="0"></span>
          <span class="cphone-pagination-dot" data-page="1"></span>
        </div>

        <div class="cphone-dock-container">
            <div class="cphone-dock glass">
                <div class="app-icon" onclick="openCharApp('music')">
                    <div class="icon-bg"><img id="cphone-icon-img-music" src=""></div>
                    <span class="label" data-lang-key="cphoneAppMusic">Èü≥‰πê</span>
                </div>
                <div class="app-icon" onclick="openCharApp('bilibili')">
                    <div class="icon-bg" style="background-color: #FB7299;"><img id="cphone-icon-img-bilibili" src="https://i.postimg.cc/Wz5gV0jB/bilibili-icon.png" style="border-radius:0;"></div>
                    <span class="label">Bilibili</span>
                </div>
                <div class="app-icon" onclick="openCharApp('reddit')">
                    <div class="icon-bg"><img id="cphone-icon-img-reddit" src=""></div>
                    <span class="label">Reddit</span>
                </div>
                <div class="app-icon" onclick="switchToMyPhone()">
                    <div class="icon-bg"><img id="cphone-icon-img-ephone" src=""></div>
                    <span class="label">Ephone</span>
                </div>
            </div>
        </div>
      </div> 
      <div id="char-amap-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‚Äπ</span> <span>Ë∂≥Ëøπ</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-amap-btn" title="ÈáçÊñ∞ÁîüÊàêË∂≥Ëøπ"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div id="char-amap-list" class="list-container"> </div>
      </div>
      <div id="char-qq-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‚Äπ</span> <span>QQ</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-qq-btn" title="ÈáçÊñ∞ÁîüÊàê"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div id="char-chat-list" class="list-container"></div>
      </div>
      <div id="char-qq-conversation-screen" class="char-screen">
        <div class="header"> <span class="back-btn" id="back-to-char-qq-list-btn">‚Äπ</span> <span id="char-conversation-partner-name"></span> <span style="width: 30px;"></span> </div>
        <div id="char-conversation-messages" class="list-container"> </div>
        <div id="char-conversation-input-area" style="padding: 8px; border-top: 1px solid var(--border-color); display: flex; gap: 8px; background-color: #f7f7f7;"> <input type="text" id="char-simulated-input" placeholder="ËøôÊòØÊ®°ÊãüÂØπËØùÔºåÊó†Ê≥ïÂèëÈÄÅÊ∂àÊÅØ" data-lang-key-placeholder="cphoneSimulatedChatPlaceholder"disabled
            style="flex-grow: 1; padding: 10px; border-radius: 6px; border: 1px solid #ddd; background: #eee;"> <button id="char-simulated-send-btn" style="padding: 0 20px; border: none; background-color: var(--accent-color); color: white; border-radius: 6px; font-weight: 500;">ÂèëÈÄÅ</button> </div>
      </div>
      <div id="char-album-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‚Äπ</span> <span data-lang-key="cphoneAlbumTitle">TAÁöÑÁõ∏ÂÜå</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-album-btn" title="ÈáçÊñ∞ÁîüÊàêÁõ∏ÂÜåÂÜÖÂÆπ"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div class="list-container">
          <div id="char-album-grid"></div>
        </div>
      </div>
      <div id="char-browser-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‚Äπ</span> <span data-lang-key="cphoneBrowserTitle">TAÁöÑÊµèËßàÂô®ÂéÜÂè≤</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-browser-btn" title="ÈáçÊñ∞ÁîüÊàêÊµèËßàËÆ∞ÂΩï"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div id="char-browser-history" class="list-container"> </div>
      </div>
      <div id="char-browser-article-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharScreen('char-browser-screen')">‚Äπ</span> <span id="char-article-title" style="max-width: 70%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">ÊñáÁ´†</span>
          <div class="header-actions"> <span class="action-btn" id="favorite-article-btn" title="Êî∂Ëóè"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
              </svg> </span> <span class="action-btn" id="copy-article-content-btn" title="Â§çÂà∂ÂÜÖÂÆπ"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg> </span> </div>
        </div>
        <div id="char-article-content" class="list-container" style="padding: 20px; font-size: 16px; line-height: 1.8; overflow-y: auto;"></div>
      </div>
      <div id="char-taobao-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‚Äπ</span> <span data-lang-key="cphoneTaobaoTitle">TAÁöÑÊ∑òÂÆùËÆ¢Âçï</span>
          <div class="header-actions"> <span class="action-btn" id="char-wallet-btn" title="Êü•ÁúãÈí±ÂåÖ" onclick="openCharWallet()"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round">
                <path d="M20 12V8H4v4"></path>
                <path d="M4 8V6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v2"></path>
                <path d="M18 12v6a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2v-6"></path>
              </svg> </span> <span class="action-btn" id="regenerate-char-taobao-btn" title="ÈáçÊñ∞ÁîüÊàêË¥≠‰π∞ËÆ∞ÂΩï"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div id="char-product-grid" class="list-container"></div>
      </div>
      <div id="char-wallet-screen" class="char-screen">
        <div class="header"> <span class="back-btn" id="char-wallet-back-btn">‚Äπ</span> <span data-lang-key="cphoneWalletTitle">Èí±ÂåÖ</span> <span style="width: 30px;"></span> </div>
        <div id="char-wallet-content" class="list-container" style="padding: 15px; display: flex; flex-direction: column; gap: 15px;"> </div>
      </div>
      <div id="char-memo-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‚Äπ</span> <span data-lang-key="cphoneMemoTitle">Â§áÂøòÂΩï</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-memo-btn" title="ÈáçÊñ∞ÁîüÊàêÂ§áÂøòÂΩï"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> <span class="action-btn" id="add-char-memo-btn">+</span> </div>
        </div>
        <div id="char-memo-list" class="list-container" style="padding: 10px;"></div>
      </div>
      <div id="char-memo-detail-screen" class="char-screen">
        <div class="header"> <span class="back-btn" id="char-memo-detail-back-btn">‚Äπ</span> <span id="char-memo-detail-title"></span>
          <div class="header-actions"> <span class="action-btn" id="favorite-memo-btn" title="Êî∂Ëóè"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
              </svg> </span> <span class="action-btn" id="copy-memo-content-btn" title="Â§çÂà∂ÂÜÖÂÆπ"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg> </span> </div>
        </div>
        <div class="form-container" style="padding: 0;"> <textarea id="char-memo-detail-content" readonly></textarea> </div>
      </div>
      <div id="char-diary-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‚Äπ</span> <span data-lang-key="cphoneDiaryTitle">Êó•ËÆ∞</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-diary-btn" title="ÈáçÊñ∞ÁîüÊàêÊó•ËÆ∞Êú¨"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> <span class="action-btn" id="add-char-diary-btn">+</span> </div>
        </div>
        <div id="char-diary-list" class="list-container"></div>
      </div>
      <div id="char-diary-detail-screen" class="char-screen">
        <div class="header"> <span class="back-btn" id="char-diary-detail-back-btn">‚Äπ </span> <span id="char-diary-detail-title"></span>
          <div class="header-actions"> <span class="action-btn" id="favorite-diary-btn" title="Êî∂Ëóè"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
              </svg> </span> <span class="action-btn" id="copy-diary-content-btn" title="Â§çÂà∂ÂÜÖÂÆπ"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg> </span> </div>
        </div>
        <div id="char-diary-detail-content-wrapper" class="list-container">
          <div id="char-diary-detail-content"> </div>
        </div>
      </div>
      <div id="char-usage-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‚Äπ</span> <span data-lang-key="cphoneUsageTitle">App‰ΩøÁî®ËÆ∞ÂΩï</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-usage-btn" title="ÈáçÊñ∞ÁîüÊàêËÆ∞ÂΩï"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div id="char-usage-list" class="list-container"> </div>
      </div>
      <div id="char-qq-transcript-modal" class="modal">
        <div class="modal-content" style="height: 80%;">
          <div class="modal-header"> <span id="transcript-modal-char-name"></span> </div>
          <div class="modal-body" id="transcript-modal-body" style="background-color: #f0f2f5; padding: 15px; display: flex; flex-direction: column; gap: 15px;"> </div>
          <div class="modal-footer"> <button class="save" id="close-transcript-modal-btn" style="width:100%;">ÂÖ≥Èó≠</button> </div>
        </div>
      </div>
      <div id="char-music-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‚Äπ</span> <span data-lang-key="cphoneMusicTitle">TAÁöÑÊ≠åÂçï</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-music-btn" title="ÈáçÊñ∞ÁîüÊàêÊ≠åÂçï"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div id="char-music-list" class="list-container"> </div>
      </div>
<div id="char-reddit-screen" class="char-screen">
  <div class="header" >
    <span class="back-btn" onclick="switchToCharHomeScreen()">‚Äπ</span>
    <span>Reddit</span>
    
    <div class="header-actions"> 
        <span class="action-btn" id="regenerate-char-reddit-btn" title="Ê†πÊçÆ‰∫∫ËÆæÁîüÊàêÊé®ËçêÊµÅ"> 
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
            </svg> 
        </span> 
    </div>
    </div>
  
  <div class="search-bar-container" style="background-color: #fff; padding: 10px; border-bottom: 1px solid #eee;">
    <div style="display: flex; gap: 8px;">
      <input type="search" id="char-reddit-search-input" placeholder="ÊêúÁ¥¢ Reddit..." 
             style="flex-grow:1; padding: 8px 12px; border-radius: 20px; border: 1px solid #ddd; background: #f6f7f8;">
      <button id="char-reddit-search-btn" class="form-button" 
              style="width: auto; margin: 0; padding: 0 15px; background-color: #FF4500; border-radius: 20px; font-size: 14px;">Go</button>
    </div>
  </div>

  <div id="char-reddit-list" class="list-container" style="padding: 0; background-color: #DAE0E6;">
  </div>
</div>
      <div id="char-bilibili-screen" class="char-screen">
        <div class="header"> 
            <span class="back-btn" onclick="switchToCharHomeScreen()">‚Äπ</span> 
            <span>Bilibili</span> 
            <div class="header-actions"> 
                <span class="action-btn" id="regenerate-char-bilibili-btn" title="Ê†πÊçÆ‰∫∫ËÆæÁîüÊàêÊé®Ëçê"> 
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                        <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
                    </svg> 
                </span> 
            </div>
            </div>
        <div class="search-bar-container" style="padding: 10px; background: transparent;"> 
            <div style="display: flex; gap: 8px;">
                <input type="search" id="char-bilibili-search-input" placeholder="ÊêúÁ¥¢ËßÜÈ¢ë..." style="flex-grow:1; padding: 8px 12px; border-radius: 8px; border: 1px solid var(--border-color);"> 
                <button id="char-bilibili-search-btn" class="form-button" style="width: auto; margin: 0; padding: 0 15px; background-color: #FB7299;">ÊêúÁ¥¢</button> 
            </div>
        </div>
        <div id="char-bilibili-list" class="list-container" style="padding: 10px;"> </div>
      </div>

      <div id="char-bilibili-player-screen" class="char-screen" style="background-color: var(--secondary-bg);">
    <div class="header"> 
        <span class="back-btn" onclick="closeCharBilibiliPlayer()">‚Äπ</span> 
        <span>ËßÜÈ¢ëËØ¶ÊÉÖ</span> 
        <span style="width: 30px;"></span> 
    </div>
        <div style="display: flex; flex-direction: column; height: 100%;">
            <div style="width: 100%; aspect-ratio: 16/9; background: black; display: flex; align-items: center;">
                <video id="char-bilibili-video" controls playsinline style="width: 100%; max-height: 100%;"></video>
            </div>
            <div class="list-container" style="background-color: var(--secondary-bg); flex-grow: 1; padding: 15px;">
                <h2 id="char-bilibili-player-title" style="font-size: 18px; margin: 0 0 10px 0; line-height: 1.4;"></h2>
                <div id="char-bilibili-player-author" style="font-size: 14px; color: #FB7299; font-weight: 500; margin-bottom: 15px;"></div>
                <div style="height: 1px; background: var(--border-color); margin-bottom: 15px;"></div>
                <div id="char-bilibili-player-desc" style="font-size: 13px; color: var(--text-secondary); line-height: 1.6; white-space: pre-wrap;"></div>
            </div>
        </div>
      </div>
    </div>
    
    <!-- MY Phone ËßíËâ≤ÈÄâÊã©Â±èÂπï -->
    <div id="myphone-selection-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">‚Äπ</span> <span data-lang-key="myphoneTitleSelect">Ë∞ÅÂèØ‰ª•Êü•Áúã‰Ω†ÁöÑÊâãÊú∫</span> <span style="width: 30px;"></span> </div>
      <div id="myphone-character-grid" class="list-container"> </div>
    </div>
    
    <!-- MY Phone ‰∏ªÂ±èÂπï -->
    <div id="myphone-screen" class="screen">
      <div id="myphone-home-screen" class="char-screen active">
        <div style="height: 50px;"></div>

        <div id="myphone-layout-container">
            
            <div class="cphone-staggered-group">
                <div class="cphone-bubble-pill top">
                    <div class="bubble-avatar-container">
                        <img id="myphone-widget-avatar-1" src="https://i.postimg.cc/y8xWzCqj/anime-boy.jpg" class="editable-image" onclick="handleWidgetImageChange('myphone-widget-avatar-1')">
                    </div>
                    <div class="bubble-content left-align" onclick="editBubbleText('myphone-text-1')">
                         
                         <p id="myphone-text-1">My little world ‚ô°</p>
                         
                    </div>
                </div>
                
                <div class="cphone-bubble-pill bottom">
                    <div class="bubble-content right-align" onclick="editBubbleText('myphone-text-2')">
                        <p id="myphone-text-2" style="font-family: 'Times New Roman', serif;">Welcome to my phone~</p>
                    </div>
                    <div class="bubble-avatar-container">
                        <img id="myphone-widget-avatar-2" src="https://i.postimg.cc/VkQfgzGJ/1.jpg" class="editable-image" onclick="handleWidgetImageChange('myphone-widget-avatar-2')">
                    </div>
                </div>
            </div>

            <div class="cphone-fixed-row">
                <div class="cphone-fixed-app-grid">
                    <div class="app-icon small" onclick="openMyPhoneApp('qq')">
                        <div class="icon-bg"><img id="myphone-icon-img-qq" src=""></div><span class="label">QQ</span>
                    </div>
                    <div class="app-icon small" onclick="openMyPhoneApp('album')">
                        <div class="icon-bg"><img id="myphone-icon-img-album" src=""></div><span class="label" data-lang-key="cphoneAppAlbum">Áõ∏ÂÜå</span>
                    </div>
                    <div class="app-icon small" onclick="openMyPhoneApp('browser')">
                        <div class="icon-bg"><img id="myphone-icon-img-browser" src=""></div><span class="label" data-lang-key="cphoneAppBrowser">ÊµèËßàÂô®</span>
                    </div>
                    <div class="app-icon small" onclick="openMyPhoneApp('taobao')">
                        <div class="icon-bg"><img id="myphone-icon-img-taobao" src=""></div><span class="label" data-lang-key="cphoneAppTaobao">Ê∑òÂÆù</span>
                    </div>
                </div>

                <div class="cphone-stack-polaroid">
                    <div class="polaroid-bg-layer"></div>
                    <div class="polaroid-main-layer">
                        <div class="polaroid-photo-frame">
                             <img id="myphone-polaroid-img" src="https://i.imgur.com/Bv63o3h.jpg" class="editable-image" onclick="handleWidgetImageChange('myphone-polaroid-img')">
                        </div>
                    </div>
                </div>
            </div>

            <div class="cphone-fixed-row">
                <div class="cphone-circle-widget-wrapper">
                    <div class="cphone-circle-bg">
                         <img id="myphone-circle-img" src="https://i.imgur.com/Wp72cEM.jpg" class="editable-image" onclick="handleWidgetImageChange('myphone-circle-img')">
                    </div>
                    <div class="circle-text-area">
    <p id="myphone-circle-text" onclick="editBubbleText('myphone-circle-text')">My Mood</p>
    <p id="myphone-circle-subtext" onclick="editBubbleText('myphone-circle-subtext')">Today</p> 
</div>
                </div>

                <div class="cphone-fixed-app-grid">
                     <div class="app-icon small" onclick="openMyPhoneApp('memo')">
                        <div class="icon-bg"><img id="myphone-icon-img-memo" src=""></div><span class="label"data-lang-key="cphoneAppMemo">Â§áÂøòÂΩï</span>
                    </div>
                    <div class="app-icon small" onclick="openMyPhoneApp('diary')">
                        <div class="icon-bg"><img id="myphone-icon-img-diary" src=""></div><span class="label"data-lang-key="cphoneAppDiary">Êó•ËÆ∞</span>
                    </div>
                    <div class="app-icon small" onclick="openMyPhoneApp('amap')">
                        <div class="icon-bg"><img id="myphone-icon-img-amap" src=""></div><span class="label"data-lang-key="cphoneAppAmap">È´òÂæ∑Âú∞Âõæ</span>
                    </div>
                    <div class="app-icon small" onclick="openMyPhoneApp('usage')">
                        <div class="icon-bg"><img id="myphone-icon-img-usage" src=""></div><span class="label"data-lang-key="cphoneAppUsage">APPËÆ∞ÂΩï</span>
                    </div>
                </div>
            </div>

        </div>

        <div class="cphone-dock-container">
            <div class="cphone-dock glass">
                <div class="app-icon" onclick="openMyPhoneApp('music')">
                    <div class="icon-bg"><img id="myphone-icon-img-music" src=""></div>
                    <span class="label" data-lang-key="cphoneAppMusic">Èü≥‰πê</span>
                </div>
                <div class="app-icon" onclick="openMyPhoneSettings()">
                    <div class="icon-bg"><img id="myphone-icon-img-settings" src=""></div>
                    <span class="label">ËÆæÁΩÆ</span>
                </div>
                <div class="app-icon" onclick="openMyPhoneViewRecords()">
                    <div class="icon-bg"><img id="myphone-icon-img-records" src=""></div>
                    <span class="label">Êü•ÁúãËÆ∞ÂΩï</span>
                </div>
                <div class="app-icon" onclick="showScreen('home-screen')">
                    <div class="icon-bg"><img id="myphone-icon-img-ephone" src=""></div>
                    <span class="label">EPhone</span>
                </div>
            </div>
        </div>
      </div>
      
      <!-- MY Phone È´òÂæ∑Âú∞Âõæ -->
      <div id="myphone-amap-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToMyPhoneHomeScreen()">‚Äπ</span> <span>Ë∂≥Ëøπ</span>
          <div class="header-actions"> 
            <span class="action-btn" id="add-myphone-amap-btn" title="ÊâãÂä®Ê∑ªÂä†Ë∂≥Ëøπ"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg> 
            </span>
            <span class="action-btn" id="regenerate-myphone-amap-btn" title="ÈáçÊñ∞ÁîüÊàêË∂≥Ëøπ"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> 
            </span>
            <span class="action-btn" id="delete-myphone-amap-btn" title="Âà†Èô§"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg> 
            </span> 
          </div>
        </div>
        <div id="myphone-amap-list" class="list-container"> </div>
      </div>
      
      <!-- MY Phone QQ -->
      <div id="myphone-qq-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToMyPhoneHomeScreen()">‚Äπ</span> <span>QQ</span>
          <div class="header-actions"> 
            <span class="action-btn" id="add-myphone-qq-btn" title="ÊâãÂä®Ê∑ªÂä†ÂØπËØù"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg> 
            </span>
            <span class="action-btn" id="regenerate-myphone-qq-btn" title="ÈáçÊñ∞ÁîüÊàê"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> 
            </span>
            <span class="action-btn" id="delete-myphone-qq-btn" title="Âà†Èô§"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg> 
            </span> 
          </div>
        </div>
        <div id="myphone-chat-list" class="list-container"></div>
      </div>
      
      <!-- MY Phone QQ ÂØπËØù -->
      <div id="myphone-qq-conversation-screen" class="char-screen">
        <div class="header"> 
          <span class="back-btn" id="back-to-myphone-qq-list-btn">‚Äπ</span> 
          <span id="myphone-conversation-partner-name"></span> 
          <div class="header-actions" id="myphone-conversation-settings-btn" style="display: none;">
            <span class="action-btn" title="ËÆæÁΩÆ">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 1v6m0 6v6m-9-9h6m6 0h6"></path>
                <path d="M19.07 4.93l-4.24 4.24m0 5.66l4.24 4.24M4.93 4.93l4.24 4.24m0 5.66l-4.24 4.24"></path>
              </svg>
            </span>
          </div>
        </div>
        <div id="myphone-conversation-messages" class="list-container"> </div>
        <div id="myphone-conversation-input-area" style="padding: 8px; border-top: 1px solid var(--border-color); display: flex; gap: 8px; background-color: #f7f7f7;"> 
          <input type="text" id="myphone-simulated-input" placeholder="" style="flex-grow: 1; padding: 10px; border-radius: 6px; border: 1px solid #ddd; background: #eee;"> 
          <button id="myphone-simulated-send-btn" style="padding: 0 20px; border: none; background-color: var(--accent-color); color: white; border-radius: 6px; font-weight: 500;">ÂèëÈÄÅ</button> 
        </div>
      </div>
      
      <!-- MY Phone ËÅîÁ≥ª‰∫∫ËÆæÁΩÆ -->
      <div id="myphone-contact-settings-screen" class="char-screen">
        <div class="header"> 
          <span class="back-btn" id="back-to-myphone-conversation-btn">‚Äπ</span> 
          <span>ËÅîÁ≥ª‰∫∫ËÆæÁΩÆ</span> 
          <span style="width: 30px;"></span> 
        </div>
        <div class="list-container" style="padding: 20px;">
          <div style="margin-bottom: 30px;">
            <div style="text-align: center; margin-bottom: 20px;">
              <div id="myphone-settings-avatar-preview" style="width: 80px; height: 80px; border-radius: 50%; margin: 0 auto; overflow: hidden; border: 2px solid var(--border-color);">
                <img id="myphone-settings-avatar-img" src="" style="width: 100%; height: 100%; object-fit: cover;">
              </div>
              <button id="myphone-change-avatar-btn" style="margin-top: 15px; padding: 8px 20px; background: var(--accent-color); color: white; border: none; border-radius: 6px; cursor: pointer;">Êõ¥Êç¢Â§¥ÂÉè</button>
            </div>
          </div>
          
          <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-color);">ËÅîÁ≥ª‰∫∫ÂêçÁß∞</label>
            <input type="text" id="myphone-settings-name" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--secondary-bg); color: var(--text-color); box-sizing: border-box;">
          </div>
          
          <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-color);">Â§áÊ≥®</label>
            <input type="text" id="myphone-settings-remark" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--secondary-bg); color: var(--text-color); box-sizing: border-box;">
          </div>
          
          <button id="myphone-save-contact-settings-btn" style="width: 100%; padding: 12px; background: var(--accent-color); color: white; border: none; border-radius: 8px; font-weight: 500; cursor: pointer; margin-bottom: 15px;">‰øùÂ≠òËÆæÁΩÆ</button>
          
          <div style="border-top: 1px solid var(--border-color); padding-top: 20px; margin-top: 20px;">
            <h3 style="margin: 0 0 15px 0; font-size: 16px; font-weight: 500; color: var(--text-color);">ÂØπËØùËÆ∞ÂΩï</h3>
            <div id="myphone-conversation-list" style="max-height: 200px; overflow-y: auto;"></div>
            <button id="myphone-add-message-btn" style="width: 100%; padding: 10px; background: var(--secondary-bg); color: var(--text-color); border: 1px solid var(--border-color); border-radius: 6px; cursor: pointer; margin-top: 10px;">Ê∑ªÂä†ÂØπËØù</button>
          </div>
        </div>
      </div>
      
      <!-- MY Phone Áõ∏ÂÜå -->
      <div id="myphone-album-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToMyPhoneHomeScreen()">‚Äπ</span> <span data-lang-key="myphoneAlbumTitle">ÊàëÁöÑÁõ∏ÂÜå</span>
          <div class="header-actions"> 
            <span class="action-btn" id="add-myphone-album-btn" title="ÊâãÂä®Ê∑ªÂä†ÁÖßÁâá"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg> 
            </span>
            <span class="action-btn" id="regenerate-myphone-album-btn" title="ÈáçÊñ∞ÁîüÊàêÁõ∏ÂÜåÂÜÖÂÆπ"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> 
            </span>
            <span class="action-btn" id="delete-myphone-album-btn" title="Âà†Èô§"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg> 
            </span> 
          </div>
        </div>
        <div class="list-container">
          <div id="myphone-album-grid"></div>
        </div>
      </div>
      
      <!-- MY Phone ÊµèËßàÂô® -->
      <div id="myphone-browser-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToMyPhoneHomeScreen()">‚Äπ</span> <span data-lang-key="myphoneBrowserTitle">ÊàëÁöÑÊµèËßàÂô®ÂéÜÂè≤</span>
          <div class="header-actions"> 
            <span class="action-btn" id="add-myphone-browser-btn" title="ÊâãÂä®Ê∑ªÂä†ÊµèËßàËÆ∞ÂΩï"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg> 
            </span>
            <span class="action-btn" id="regenerate-myphone-browser-btn" title="ÈáçÊñ∞ÁîüÊàêÊµèËßàËÆ∞ÂΩï"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> 
            </span>
            <span class="action-btn" id="delete-myphone-browser-btn" title="Âà†Èô§"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg> 
            </span> 
          </div>
        </div>
        <div id="myphone-browser-list" class="list-container"> </div>
      </div>
      
      <!-- MY Phone ÊµèËßàÂô®ÊñáÁ´†ËØ¶ÊÉÖ -->
      <div id="myphone-browser-article-screen" class="char-screen">
        <div class="header"> <span class="back-btn" id="back-to-myphone-browser-list-btn">‚Äπ</span> <span id="myphone-article-title-header"></span> <span style="width: 30px;"></span> </div>
        <div class="list-container" style="padding: 15px;">
          <h2 id="myphone-article-title" style="font-size: 20px; margin-bottom: 10px;"></h2>
          <div id="myphone-article-meta" style="font-size: 12px; color: var(--text-secondary); margin-bottom: 20px;"></div>
          <div id="myphone-article-content" style="font-size: 15px; line-height: 1.8; white-space: pre-wrap;"></div>
        </div>
      </div>
      
      <!-- MY Phone Ê∑òÂÆù -->
      <div id="myphone-taobao-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToMyPhoneHomeScreen()">‚Äπ</span> <span data-lang-key="myphoneTaobaoTitle">ÊàëÁöÑÊ∑òÂÆù</span>
          <div class="header-actions"> 
            <span class="action-btn" id="add-myphone-taobao-btn" title="ÊâãÂä®Ê∑ªÂä†Ë¥≠Áâ©ËÆ∞ÂΩï"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg> 
            </span>
            <span class="action-btn" id="regenerate-myphone-taobao-btn" title="ÈáçÊñ∞ÁîüÊàêË¥≠Áâ©ËÆ∞ÂΩï"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> 
            </span>
            <span class="action-btn" id="delete-myphone-taobao-btn" title="Âà†Èô§"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg> 
            </span> 
          </div>
        </div>
        <div id="myphone-taobao-grid" class="list-container"> </div>
      </div>
      
      <!-- MY Phone Èí±ÂåÖ -->
      <div id="myphone-wallet-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToMyPhoneHomeScreen()">‚Äπ</span> <span>Èí±ÂåÖ</span> <span style="width: 30px;"></span> </div>
      </div>
      
      <!-- MY Phone Â§áÂøòÂΩï -->
      <div id="myphone-memo-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToMyPhoneHomeScreen()">‚Äπ</span> <span data-lang-key="myphoneMemoTitle">ÊàëÁöÑÂ§áÂøòÂΩï</span>
          <div class="header-actions"> 
            <span class="action-btn" id="add-myphone-memo-btn" title="ÊâãÂä®Ê∑ªÂä†Â§áÂøòÂΩï"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg> 
            </span>
            <span class="action-btn" id="regenerate-myphone-memo-btn" title="ÈáçÊñ∞ÁîüÊàêÂ§áÂøòÂΩï"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> 
            </span>
            <span class="action-btn" id="delete-myphone-memo-btn" title="Âà†Èô§"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg> 
            </span> 
          </div>
        </div>
        <div id="myphone-memo-list" class="list-container"> </div>
      </div>
      
      <!-- MY Phone Â§áÂøòÂΩïËØ¶ÊÉÖ -->
      <div id="myphone-memo-detail-screen" class="char-screen">
        <div class="header"> <span class="back-btn" id="back-to-myphone-memo-list-btn">‚Äπ</span> <span id="myphone-memo-title-header"></span> <span style="width: 30px;"></span> </div>
        <div class="list-container" style="padding: 15px;">
          <h3 id="myphone-memo-detail-title" style="font-size: 18px; margin-bottom: 10px;"></h3>
          <div id="myphone-memo-detail-date" style="font-size: 12px; color: var(--text-secondary); margin-bottom: 15px;"></div>
          <div id="myphone-memo-detail-content" style="font-size: 15px; line-height: 1.6; white-space: pre-wrap;"></div>
        </div>
      </div>
      
      <!-- MY Phone Êó•ËÆ∞ -->
      <div id="myphone-diary-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToMyPhoneHomeScreen()">‚Äπ</span> <span data-lang-key="myphoneDiaryTitle">ÊàëÁöÑÊó•ËÆ∞</span>
          <div class="header-actions"> 
            <span class="action-btn" id="add-myphone-diary-btn" title="ÊâãÂä®Ê∑ªÂä†Êó•ËÆ∞"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg> 
            </span>
            <span class="action-btn" id="regenerate-myphone-diary-btn" title="ÈáçÊñ∞ÁîüÊàêÊó•ËÆ∞"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> 
            </span>
            <span class="action-btn" id="delete-myphone-diary-btn" title="Âà†Èô§"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg> 
            </span> 
          </div>
        </div>
        <div id="myphone-diary-list" class="list-container"> </div>
      </div>
      
      <!-- MY Phone Êó•ËÆ∞ËØ¶ÊÉÖ -->
      <div id="myphone-diary-detail-screen" class="char-screen">
        <div class="header"> <span class="back-btn" id="back-to-myphone-diary-list-btn">‚Äπ</span> <span id="myphone-diary-title-header"></span> <span style="width: 30px;"></span> </div>
        <div class="list-container" style="padding: 15px;">
          <h3 id="myphone-diary-detail-title" style="font-size: 18px; margin-bottom: 10px;"></h3>
          <div id="myphone-diary-detail-date" style="font-size: 12px; color: var(--text-secondary); margin-bottom: 5px;"></div>
          <div id="myphone-diary-detail-weather" style="font-size: 12px; color: var(--text-secondary); margin-bottom: 15px;"></div>
          <div id="myphone-diary-detail-preface" style="font-size: 14px; font-style: italic; color: var(--text-secondary); margin-bottom: 15px; padding: 10px; background: rgba(0,0,0,0.05); border-radius: 8px;"></div>
          <div id="myphone-diary-detail-content" style="font-size: 15px; line-height: 1.6; white-space: pre-wrap;"></div>
        </div>
      </div>
      
      <!-- MY Phone APP‰ΩøÁî®ËÆ∞ÂΩï -->
      <div id="myphone-usage-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToMyPhoneHomeScreen()">‚Äπ</span> <span data-lang-key="myphoneUsageTitle">ÊàëÁöÑAPP‰ΩøÁî®ËÆ∞ÂΩï</span>
          <div class="header-actions"> 
            <span class="action-btn" id="add-myphone-usage-btn" title="ÊâãÂä®Ê∑ªÂä†‰ΩøÁî®ËÆ∞ÂΩï"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg> 
            </span>
            <span class="action-btn" id="regenerate-myphone-usage-btn" title="ÈáçÊñ∞ÁîüÊàê‰ΩøÁî®ËÆ∞ÂΩï"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> 
            </span>
            <span class="action-btn" id="delete-myphone-usage-btn" title="Âà†Èô§"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg> 
            </span> 
          </div>
        </div>
        <div id="myphone-usage-list" class="list-container"> </div>
      </div>
      
      <!-- MY Phone Èü≥‰πê -->
      <div id="myphone-music-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToMyPhoneHomeScreen()">‚Äπ</span> <span data-lang-key="myphoneMusicTitle">ÊàëÁöÑÈü≥‰πê</span>
          <div class="header-actions"> 
            <span class="action-btn" id="add-myphone-music-btn" title="ÊâãÂä®Ê∑ªÂä†Ê≠åÊõ≤"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg> 
            </span>
            <span class="action-btn" id="regenerate-myphone-music-btn" title="ÈáçÊñ∞ÁîüÊàêÊ≠åÂçï"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> 
            </span>
            <span class="action-btn" id="delete-myphone-music-btn" title="Âà†Èô§"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg> 
            </span> 
          </div>
        </div>
        <div id="myphone-music-list" class="list-container"> </div>
      </div>
      
      <!-- MY Phone ËÆæÁΩÆ -->
      <div id="myphone-settings-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToMyPhoneHomeScreen()">‚Äπ</span> <span>ËÆæÁΩÆ</span> <span style="width: 30px;"></span> </div>
        <div class="list-container" style="padding: 20px;">
          <div class="settings-section" style="background: var(--secondary-bg); border-radius: 12px; padding: 0; overflow: hidden;">
            <div class="settings-item" style="padding: 15px; border-bottom: 0.5px solid rgba(0,0,0,0.1);">
              <label style="font-size: 15px;">ÂêØÁî®ÈîÅÂ±èÂØÜÁ†Å</label>
              <label class="toggle-switch">
                <input type="checkbox" id="myphone-lock-screen-toggle">
                <span class="slider"></span>
              </label>
            </div>
            
            <!-- ÈîÅÂ±èËØ¶ÊÉÖ (JSÊéßÂà∂ÊòæÁ§∫ÈöêËóè) -->
            <div id="myphone-lock-screen-settings-detail" style="display: none;">
              <div class="settings-item" style="padding: 15px; background-color: rgba(0,0,0,0.02); border-bottom: 0.5px solid rgba(0,0,0,0.1);">
                <div style="display: flex; flex-direction: column; gap: 8px; width: 100%;">
                  <div style="display: flex; justify-content: space-between; align-items: center;">
                    <label style="font-size: 14px; color: var(--text-secondary);">4‰ΩçÊï∞Â≠óÂØÜÁ†Å</label>
                    <input type="tel" id="myphone-lock-screen-password-input" maxlength="4" placeholder="1234" 
                           style="width: 100px; padding: 8px 12px; border: 1px solid rgba(0,0,0,0.1); border-radius: 8px; 
                                  font-size: 14px; letter-spacing: 3px; text-align: center; background: white;">
                  </div>
                  <div style="font-size: 12px; color: var(--text-secondary); padding-left: 0;">
                    ÂºÄÂêØÂêéÔºåÁÇπÂáªMyPhoneÂõæÊ†áÊó∂ÈúÄË¶ÅËæìÂÖ•ÂØÜÁ†ÅÊâçËÉΩËøõÂÖ•
                  </div>
                </div>
              </div>
              
              <div class="settings-item" style="padding: 15px; background-color: rgba(0,0,0,0.02);">
                <div style="display: flex; flex-direction: column; gap: 8px; width: 100%;">
                  <label style="font-size: 14px; color: var(--text-secondary);">ÈîÅÂ±èÂ£ÅÁ∫∏</label>
                  <div style="display: flex; align-items: center; gap: 10px;">
                    <div id="myphone-lock-wallpaper-preview" class="wallpaper-thumbnail" 
                         style="width: 60px; height: 80px; border-radius: 8px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                                display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; text-align: center;">
                      Êó†
                    </div>
                    <div style="display: flex; gap: 8px;">
                      <button class="settings-mini-btn" onclick="document.getElementById('myphone-lock-wallpaper-input').click()">Êú¨Âú∞</button>
                      <button id="myphone-upload-lock-wallpaper-url-btn" class="settings-mini-btn">URL</button>
                    </div>
                    <input type="file" id="myphone-lock-wallpaper-input" accept="image/*" style="display: none;">
                  </div>
                  <div style="font-size: 12px; color: var(--text-secondary);">
                    ËÆæÁΩÆÊ≠§ËßíËâ≤MyPhoneÁöÑÈîÅÂ±èÂ£ÅÁ∫∏
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- MY Phone Êü•ÁúãËÆ∞ÂΩïÔºàÂç†‰ΩçÔºâ -->
      <div id="myphone-view-records-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToMyPhoneHomeScreen()">‚Äπ</span> <span>Êü•ÁúãËÆ∞ÂΩï</span> <span style="width: 30px;"></span> </div>
        <div class="list-container" style="padding: 50px 20px; text-align: center; color: var(--text-secondary);">
          <p>Ê≠§ÂäüËÉΩÊ≠£Âú®ÂºÄÂèë‰∏≠...</p>
        </div>
      </div>
    </div>
    
    <!-- ËßíËâ≤ÁîüÊàêÂô®Â±èÂπïÂ∞ÜÁî±character-generator.jsÂä®ÊÄÅÂàõÂª∫ -->
    
    <div id="world-book-screen" class="screen">
      <div class="header">
        <div class="header-left-actions"> <span class="back-btn" onclick="showScreen('home-screen')">‚Äπ</span> <span class="action-btn" id="import-world-book-btn" title="ÂØºÂÖ•‰∏ñÁïå‰π¶"data-lang-key-title="worldBookImportTitle"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17 8 12 3 7 8"></polyline>
              <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg> </span> <span class="action-btn" id="export-world-book-btn" title="ÂØºÂá∫‰∏ñÁïå‰π¶"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg> </span> </div> <span data-lang-key="worldBookTitle">‰∏ñÁïå‰π¶</span>
        <div class="header-actions"> <span class="action-btn" id="manage-world-book-categories-btn" title="ÁÆ°ÁêÜÂàÜÁ±ª"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg> </span> <span class="action-btn" id="add-world-book-btn">+</span> </div>
      </div>
      <div id="world-book-tabs"></div>
      <div id="world-book-content-container"></div>
    </div>
    <div id="world-book-editor-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('world-book-screen')">‚Äπ</span> <span id="world-book-editor-title"data-lang-key="worldBookEditorTitle"data-lang-key="edit">ÁºñËæë‰∏ñÁïå‰π¶</span> <span class="save-btn" id="save-world-book-btn"data-lang-key="save">‰øùÂ≠ò</span> </div>
      <div class="form-container">
        <div class="form-group"> <label for="world-book-name-input"data-lang-key="worldBookNameLabel">‰π¶Âêç</label> <input type="text" id="world-book-name-input" placeholder="ËØ∑ËæìÂÖ•‰∏ñÁïå‰π¶ÁöÑÂêçÁß∞..."data-lang-key-placeholder="worldBookNamePlaceholder"> </div>
        <div class="form-group"> <label for="world-book-category-select"data-lang-key="worldBookCategoryLabel">ÂàÜÁ±ª</label> <select id="world-book-category-select"></select> </div>
        <div class="form-group">
          <label style="display: flex; align-items: center; justify-content: space-between; cursor: pointer;">
            <span>
              <span style="font-weight: 500;">ÂÖ®Â±Ä‰∏ñÁïå‰π¶</span>
              <span style="font-size: 12px; color: var(--text-secondary); display: block; margin-top: 4px;">ÂºÄÂêØÂêéÔºåÊâÄÊúâËßíËâ≤Â∞ÜËá™Âä®ÂÖ≥ËÅîÊ≠§‰∏ñÁïå‰π¶</span>
            </span>
            <input type="checkbox" id="world-book-global-switch" style="width: 44px; height: 24px; cursor: pointer;">
          </label>
        </div>
        <div class="form-group" id="world-book-inject-position-group">
          <label for="world-book-inject-position-select">
            <span style="font-weight: 500;">Ê≥®ÂÖ•‰ΩçÁΩÆ</span>
            <span style="font-size: 12px; color: var(--text-secondary); display: block; margin-top: 4px;">ÈÄâÊã©‰∏ñÁïå‰π¶ÂÜÖÂÆπÂú®ÊèêÁ§∫ËØç‰∏≠ÁöÑÊ≥®ÂÖ•‰ΩçÁΩÆ</span>
          </label>
          <select id="world-book-inject-position-select" style="margin-top: 8px; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--input-bg); color: var(--text-primary); font-size: 14px;">
            <option value="before">Ââç - ÊèêÁ§∫ËØçÂâçÈù¢</option>
            <option value="middle">‰∏≠ - ÊèêÁ§∫ËØç‰∏≠Èó¥</option>
            <option value="after">Âêé - ÊèêÁ§∫ËØçÊúÄÂêé</option>
          </select>
        </div>
        <div class="form-group" style="flex-grow: 1; display: flex; flex-direction: column;"> <label data-lang-key="worldBookEntriesLabel">ÂÜÖÂÆπÊù°ÁõÆ</label>
          <div id="world-book-entries-container" style="display: flex; flex-direction: column; gap: 15px; overflow-y: auto; padding: 5px; flex-grow: 1;"> </div>
        </div> <button id="add-world-book-entry-btn" class="form-button form-button-secondary"data-lang-key="worldBookAddEntryBtn"> [+] Ê∑ªÂä†Êñ∞Êù°ÁõÆ </button>
      </div>
    </div>
    <div id="preset-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">‚Äπ</span> <span data-lang-key="presetTitle">È¢ÑËÆæ</span>
        <div class="header-actions"> <span class="action-btn" id="import-preset-btn" title="ÂØºÂÖ•È¢ÑËÆæÊñá‰ª∂" data-lang-key-title="presetImportTitle"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17 8 12 3 7 8"></polyline>
              <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg> </span> <span class="action-btn" id="manage-preset-categories-btn" title="ÁÆ°ÁêÜÂàÜÁ±ª"data-lang-key-title="presetManageCategoriesTitle"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
            </svg> </span> <span class="action-btn" id="add-preset-btn">+</span> </div>
      </div>
      <div id="preset-tabs"></div>
      <div id="preset-content-container"></div>
    </div>
    <div id="tutorial-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">‚Äπ</span> <span data-lang-key="tutorialTitle">ÊïôÁ®ã</span> <span style="width: 30px;"></span> </div>
      <div class="list-container" style="padding: 0; overflow: hidden;"> <iframe id="tutorial-iframe" src="tutorial.html" style="width: 100%; height: 100%; border: none;"></iframe> </div>
    </div>
    <div id="preset-editor-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('preset-screen')">‚Äπ</span> <span id="preset-editor-title"data-lang-key="presetEditorTitle">ÁºñËæëÈ¢ÑËÆæ</span> <span class="save-btn" id="save-preset-btn"data-lang-key="save">‰øùÂ≠ò</span> </div>
      <div class="form-container">
        <div class="form-group"> <label for="preset-name-input"data-lang-key="presetNameLabel">È¢ÑËÆæÂêçÁß∞</label> <input type="text" id="preset-name-input" placeholder="ËØ∑ËæìÂÖ•È¢ÑËÆæÁöÑÂêçÁß∞..."data-lang-key-placeholder="presetNamePlaceholder"> </div>
        <div class="form-group"> <label for="preset-category-select"data-lang-key="presetCategoryLabel">ÂàÜÁ±ª</label> <select id="preset-category-select"></select> </div>
        <div class="form-group" style="flex-grow: 1; display: flex; flex-direction: column;"> <label data-lang-key="presetEntriesLabel">ÂÜÖÂÆπÊù°ÁõÆ</label>
          <div id="preset-entries-container" style="display: flex; flex-direction: column; gap: 15px; overflow-y: auto; padding: 5px; flex-grow: 1;"> </div>
        </div> <button type="button" id="add-preset-entry-btn" class="form-button form-button-secondary"data-lang-key="presetAddEntryBtn"> [+] Ê∑ªÂä†Êñ∞Êù°ÁõÆ </button>
      </div>
    </div>
    <div id="api-settings-screen" class="screen ios-settings-screen">
      <div class="header"> 
        <span class="back-btn" onclick="showScreen('home-screen')">‚Äπ</span> 
        <span data-lang-key="apiSettingsTitle">ËÆæÁΩÆ</span> 
        <span class="save-btn" id="save-api-settings-btn" data-lang-key="save">ÂÆåÊàê</span> 
      </div>
      
      <div class="settings-container ios-scroll-container">
        
        <!-- ËØ≠Ë®ÄËÆæÁΩÆ -->
        <div class="settings-section">
            <div class="settings-item">
                <label for="language-select" data-lang-key="languageLabel">ËØ≠Ë®Ä</label>
                <div class="settings-right">
                    <select id="language-select" class="settings-select">
                        <option value="zh-CN">ÁÆÄ‰Ωì‰∏≠Êñá</option>
                        <option value="en">English</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- API È¢ÑËÆæ -->
        <div class="settings-header" data-lang-key="apiPresetManagement">ÈÖçÁΩÆÈ¢ÑËÆæ</div>
        <div class="settings-section">
            <div class="settings-item">
                 <!-- ‰∏ãÊãâÊ°ÜÂÆπÂô®Ôºöflex-grow Âç†Êª°Â∑¶‰æßÁ©∫Èó¥ÔºåÂÜÖÈÉ®Â∑¶ÂØπÈΩê -->
                 <div style="flex-grow: 1; display: flex; align-items: center; justify-content: flex-start; overflow: hidden;">
                     <select id="api-preset-select" class="settings-select">
                         <!-- JS Â°´ÂÖÖÈÄâÈ°π -->
                     </select>
                 </div>
                 
                 <!-- ÊåâÈíÆÁªÑÔºöÂõ∫ÂÆöÂú®Âè≥‰æß -->
                 <div class="settings-right" style="flex-grow: 0; width: auto; margin-left: 10px;">
                     <button id="save-api-preset-btn" class="settings-mini-btn">‰øùÂ≠ò</button>
                     <button id="delete-api-preset-btn" class="settings-mini-btn">Âà†Èô§</button>
                 </div>
            </div>
        </div>

        <!-- ‰∏ª API ËÆæÁΩÆ -->
        <div class="settings-header" data-lang-key="apiPrimarySettings">‰∏ª API (ÂØπËØù)</div>
        <div class="settings-section">
            <!-- 1. ÊèêÁ§∫Êù° (ËøòÂéüÊà™ÂõæÊïàÊûú) -->
            <div class="settings-tip-wrapper">
                <div class="settings-tip-content">
                    ÊèêÁ§∫: Ëã•Ë¶Å‰ΩøÁî®‚ÄúÂèëÈÄÅÂõæÁâá‚ÄùÂäüËÉΩÔºåËØ∑Âä°ÂøÖÈÄâÊã©ÊîØÊåÅ Vision(ËßÜËßâ) ÁöÑÊ®°ÂûãÔºåÂ¶Ç <code>gpt-4o</code> Êàñ <code>gpt-4-vision-preview</code>„ÄÇ
                </div>
            </div>

            <!-- 2. ËæìÂÖ•Ê°ÜÈÉ®ÂàÜ -->
            <div class="settings-item">
                <label>Âèç‰ª£Âú∞ÂùÄ</label>
                <div class="settings-right">
                    <input type="text" id="proxy-url" placeholder="https://api.openai.com">
                </div>
            </div>
            <div class="settings-item">
                <label>API Key</label>
                <div class="settings-right">
                    <input type="password" id="api-key" placeholder="sk-...">
                </div>
            </div>
            <div class="settings-item">
                <label>Ê®°ÂûãÔºàÊâãÂÜôÔºâ</label>
                <div class="settings-right">
                    <input type="text" id="model-input" placeholder="ÂèØÊâãÂÜôÊ®°ÂûãÂêçÁß∞Êàñ‰ªé‰∏ãÊñπÊãâÂèñËá™Âä®Â°´ÂÖ•" style="flex-grow: 1;">
                </div>
            </div>
            <div class="settings-item">
                <label>ÊãâÂèñÊ®°Âûã</label>
                <div class="settings-right">
                    <select id="model-select" class="settings-select" style="flex-grow: 1; width: auto;"></select>
                    <button id="fetch-models-btn" class="settings-mini-btn">ÊãâÂèñ</button>
                </div>
            </div>
        </div>

        <!-- ÂâØ API ËÆæÁΩÆ -->
        <div class="settings-header" data-lang-key="apiSecondarySettings">ÂâØ API (ÈïøËÆ∞ÂøÜÊÄªÁªì)</div>
        <div class="settings-section">
            <div class="settings-item">
                <label>Âèç‰ª£Âú∞ÂùÄ</label>
                <div class="settings-right">
                    <input type="text" id="secondary-proxy-url" placeholder="ÁïôÁ©∫‰ΩøÁî®‰∏ªAPI">
                </div>
            </div>
            <div class="settings-item">
                <label>API Key</label>
                <div class="settings-right">
                    <input type="password" id="secondary-api-key" placeholder="ÂèØÈÄâ">
                </div>
            </div>
            <!-- ‰øÆÊîπÁÇπÔºöÊ®°ÂûãÂíåÊãâÂèñÊåâÈíÆÂú®‰∏ÄË°å -->
            <div class="settings-item">
                <label>Ê®°ÂûãÔºàÊâãÂÜôÔºâ</label>
                <div class="settings-right">
                    <input type="text" id="secondary-model-input" placeholder="ÂèØÊâãÂÜôÊ®°ÂûãÂêçÁß∞Êàñ‰ªé‰∏ãÊñπÊãâÂèñËá™Âä®Â°´ÂÖ•" style="flex-grow: 1;">
                </div>
            </div>
            <div class="settings-item">
                <label>ÊãâÂèñÊ®°Âûã</label>
                <div class="settings-right">
                     <!-- ‰∏ãÊãâÊ°ÜÂç†ÊçÆÂâ©‰ΩôÁ©∫Èó¥ -->
                    <select id="secondary-model-select" class="settings-select" style="flex-grow: 1; width: auto;"></select>
                    <!-- ÊåâÈíÆÊîæÂú®ÊóÅËæπ -->
                    <button id="fetch-secondary-models-btn" class="settings-mini-btn">ÊãâÂèñ</button>
                </div>
            </div>
        </div>

        <!-- ÂèÇÊï∞ËÆæÁΩÆ -->
        <div class="settings-header">ÂèÇÊï∞ËÆæÁΩÆ</div>
        <div class="settings-section">
             <div class="settings-item">
                <label>Ê∏©Â∫¶ (Temperature) <span id="api-temperature-value" style="color:var(--accent-color);">0.8</span></label>
                <div class="settings-right" style="width: 50%;">
                    <input type="range" id="api-temperature-slider" min="0" max="2" step="0.1" value="0.8">
                </div>
            </div>
        </div>

        <!-- ÂêéÂè∞‰∏éËá™Âä®Âåñ -->
        <div class="settings-header" data-lang-key="apiBgActivitySettings">ÂêéÂè∞Ê¥ªÂä®</div>
        <div class="settings-section">
            <div class="settings-item">
                <label>ÂêØÁî®ÂêéÂè∞ËßíËâ≤Ê¥ªÂä®</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="background-activity-switch">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-item">
                <label>Ê£ÄÊµãÈó¥Èöî (Áßí)</label>
                <div class="settings-right">
                    <input type="number" id="background-interval-input" min="30" value="60" class="settings-num-input">
                </div>
            </div>
            <div class="settings-item">
                <label>ÊãâÈªëÂÜ∑ÈùôÊúü (Â∞èÊó∂)</label>
                <div class="settings-right">
                    <input type="number" id="block-cooldown-input" min="0.1" step="0.1" value="1" class="settings-num-input">
                </div>
            </div>
        </div>
        <div class="settings-desc">ÂºÄÂêØÂêéÂè∞Ê¥ªÂä®‰ºöÂ¢ûÂä† API Ë¥πÁî®„ÄÇ</div>

        <!-- ËØ≠Èü≥ËÆæÁΩÆ -->
        <div class="settings-header" data-lang-key="apiTtsSettings">Minimax TTS ËØ≠Èü≥</div>
        <div class="settings-section">
            <div class="settings-item">
                <label>Group ID</label>
                <div class="settings-right">
                     <input type="text" id="minimax-group-id" placeholder="ËæìÂÖ• Group ID">
                </div>
            </div>
            <div class="settings-item">
                <label>API Key</label>
                <div class="settings-right">
                     <input type="password" id="minimax-api-key" placeholder="ËæìÂÖ• API Key">
                </div>
            </div>
            <!-- ÂàÜË°å 1: Ê®°Âûã -->
            <div class="settings-item">
                <label>Ê®°Âûã</label>
                <div class="settings-right">
                    <select id="minimax-model-select" class="settings-select">
                        <!-- JS ‰ºöÂ°´ÂÖÖÈÄâÈ°π -->
                    </select>
                </div>
            </div>
            <!-- ÂàÜË°å 2: Êé•Âè£ÂüüÂêç (ÊâãÂä®ÂÜôÊ≠ªÂú®ËøôÈáåÔºå‰∏çÂÜç‰æùËµñ JS Âä®ÊÄÅÊèíÂÖ•) -->
            <div class="settings-item">
                <label>Êé•Âè£ÂüüÂêç</label>
                <div class="settings-right">
                    <select id="minimax-domain-select" class="settings-select">
                        <option value="https://api.minimax.chat">üá®üá≥ ÂõΩÂÜÖ (api.minimax.chat)</option>
                        <option value="https://api.minimaxi.chat">üåè Êµ∑Â§ñ (api.minimaxi.chat)</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- ÁîüÂõæËÆæÁΩÆ (AI & NovelAI) -->
        <div class="settings-header" data-lang-key="apiImageGenSettings">ÂõæÂÉèÁîüÊàê</div>
        <div class="settings-section">
            <!-- ÈÄöÁî®ÁîüÂõæ -->
            <div class="settings-item">
                <label>ÂêØÁî®ÈÄöÁî® AI ÁîüÂõæ</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="enable-ai-drawing-switch">
                    <span class="slider"></span>
                </label>
            </div>
            
            <!-- NovelAI -->
            <div class="settings-item">
                <label>ÂêØÁî® NovelAI</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="novelai-switch">
                    <span class="slider"></span>
                </label>
            </div>
            
            <!-- NovelAI ËØ¶ÊÉÖ (JSÊéßÂà∂ÊòæÁ§∫/ÈöêËóè) -->
            <div id="novelai-details" style="display:none; background-color: #f9f9f9; border-top: 0.5px solid #ebedf0;">
                <div class="settings-item">
                    <label>Ê®°Âûã</label>
                    <div class="settings-right">
                         <select id="novelai-model" class="settings-select">
                            <option value="nai-diffusion-4-curated-preview">V4.5 Curated</option>
                            <option value="nai-diffusion-4-5-full">V4.5 Full</option>
                            <option value="nai-diffusion-3">Anime V3</option>
                        </select>
                    </div>
                </div>
                <div class="settings-item">
                    <label>API Key</label>
                    <div class="settings-right">
                        <div style="position:relative; width:100%;">
                             <input type="password" id="novelai-api-key" placeholder="pst-...">
                             <span id="novelai-key-toggle" style="position: absolute; right: 0; top: 50%; transform: translateY(-50%); cursor: pointer;">üßê</span>
                        </div>
                    </div>
                </div>
                <div class="settings-item" style="justify-content: space-around;">
                    <button id="novelai-settings-btn" class="settings-mini-btn">‚öôÔ∏è ÁîüÊàêÂèÇÊï∞</button>
                    <button id="novelai-test-btn" class="settings-mini-btn">üß™ ÊµãËØïÁîüÊàê</button>
                </div>
            </div>
        </div>

        <!-- ‰∫ëÊúçÂä°‰∏éÂ≠òÂÇ® -->
        <!-- ‰∫ëÊúçÂä°‰∏éÂ≠òÂÇ® (ÁÅ∞Êù°‰∏ãÊ≤âÁâà) -->
        <div class="settings-header">‰∫ëÊúçÂä°‰∏éÂ≠òÂÇ®</div>
        <div class="settings-section">
             
             <!-- === ImgBB === -->
             <!-- 1. ÂÖàÊîæÂºÄÂÖ≥Ë°å -->
             <div class="settings-item">
                <label>ImgBB ÂõæÂ∫ä</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="imgbb-enable-switch">
                    <span class="slider"></span>
                </label>
            </div>
            <!-- 2. ÂÜçÊîæËØ¶ÊÉÖÂÆπÂô® (ÁÅ∞Êù°ÁßªÂÖ•Ê≠§Â§Ñ) -->
            <div id="imgbb-settings-details" style="display:none;">
                 <!-- ÁÅ∞Êù°Ë¢´ÁßªÂà∞‰∫ÜËøôÈáå -->
                 <div class="settings-tip-wrapper">
                    <div class="settings-tip-content">
                        ÂºÄÂêØÂêéÔºåÊú¨Âú∞ÂõæÁâáÂ∞ÜËá™Âä®‰∏ä‰º†Âà∞ ImgBB ÂõæÂ∫ä‰ª•ÂáèÂ∞è‰ΩìÁßØ„ÄÇ<br>
                        ‚ö†Ô∏è ÂõæÁâáÂ∞Ü‰∏ä‰º†Âà∞ÂÖ¨ÂÖ±‰∫íËÅîÁΩëÔºåËØ∑Âãø‰∏ä‰º†ÁßÅÂØÜÁÖßÁâáÔºÅ<br>
                        üîó <a href="https://api.imgbb.com/" target="_blank">ÁÇπÂáªÊ≠§Â§ÑÊ≥®ÂÜåÂπ∂Ëé∑Âèñ API Key</a>
                    </div>
                </div>
                
                 <div class="settings-item">
                    <label>API Key</label>
                     <div class="settings-right">
                        <div style="position:relative; width:100%;">
                            <input type="password" id="imgbb-api-key" placeholder="ËæìÂÖ• ImgBB Key">
                            <span id="imgbb-key-toggle" style="position: absolute; right: 0; top: 50%; transform: translateY(-50%); cursor: pointer;">üßê</span>
                        </div>
                     </div>
                 </div>
            </div>

            <!-- === Catbox === -->
             <!-- 1. ÂºÄÂÖ≥ -->
             <div class="settings-item">
                <label>Catbox ÊâòÁÆ°</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="catbox-enable-switch">
                    <span class="slider"></span>
                </label>
            </div>
            <!-- 2. ËØ¶ÊÉÖÂÆπÂô® (ÁÅ∞Êù°ÁßªÂÖ•Ê≠§Â§Ñ) -->
            <div id="catbox-settings-details" style="display:none;">
                 <!-- ÁÅ∞Êù°Ë¢´ÁßªÂà∞‰∫ÜËøôÈáå -->
                 <div class="settings-tip-wrapper">
                    <div class="settings-tip-content">
                        ÂºÄÂêØÂêéÔºåÊ≠åÊõ≤Êñá‰ª∂Â∞Ü‰∏ä‰º†Âà∞ Catbox.moe ÊâòÁÆ°„ÄÇ<br>
                        üîó <a href="https://catbox.moe/user/manage.php" target="_blank">ÁôªÂΩï Catbox Êü•Áúã User Hash</a>
                    </div>
                </div>

                 <div class="settings-item">
                    <label>User Hash</label>
                     <div class="settings-right">
                        <div style="position:relative; width:100%;">
                            <input type="password" id="catbox-userhash" placeholder="ËæìÂÖ• User Hash">
                            <span id="catbox-key-toggle" style="position: absolute; right: 0; top: 50%; transform: translateY(-50%); cursor: pointer;">üßê</span>
                        </div>
                     </div>
                 </div>
            </div>

             <!-- === GitHub === -->
             <!-- 1. ÂºÄÂÖ≥ -->
             <div class="settings-item">
                <label>GitHub ‰∫ëÂ§á‰ªΩ</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="github-enable-switch">
                    <span class="slider"></span>
                </label>
            </div>
            <!-- 2. ËØ¶ÊÉÖÂÆπÂô® (ÁÅ∞Êù°ÁßªÂÖ•Ê≠§Â§Ñ) -->
            <div id="github-settings-details" style="display:none;">
                <!-- ÁÅ∞Êù°Ë¢´ÁßªÂà∞‰∫ÜËøôÈáå -->
                <div class="settings-tip-wrapper">
                    <div class="settings-tip-content">
                        Â∞ÜÊï∞ÊçÆÂ§á‰ªΩÂà∞ÁßÅÊúâ GitHub ‰ªìÂ∫ìÔºåÊñπ‰æøË∑®ËÆæÂ§áÂêåÊ≠•„ÄÇ<br>
                        1. <a href="https://github.com/new" target="_blank">ÂàõÂª∫Êñ∞‰ªìÂ∫ì</a> (Âª∫ËÆÆËÆæ‰∏∫ Private)<br>
                        2. <a href="https://github.com/settings/tokens" target="_blank">Ëé∑Âèñ Token</a> (ÂøÖÈ°ªÂãæÈÄâ <strong>repo</strong> ÊùÉÈôê)
                    </div>
                </div>

                <div class="settings-item">
                    <label>Ëá™Âä®Â§á‰ªΩ (ÂàÜÈíü)</label>
                    <div class="settings-right" style="gap: 5px;">
                         <input type="number" id="github-backup-interval" value="30" class="settings-num-input">
                         <label class="toggle-switch" style="transform: scale(0.8);">
                            <input type="checkbox" id="github-auto-backup-switch">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                 <div class="settings-item"><label>Áî®Êà∑Âêç</label><div class="settings-right"><input type="text" id="github-username" placeholder="Â¶Ç: yourname"></div></div>
                 <div class="settings-item"><label>‰ªìÂ∫ìÂêç</label><div class="settings-right"><input type="text" id="github-repo" placeholder="Â¶Ç: my-backup"></div></div>
                 <div class="settings-item"><label>Token</label><div class="settings-right"><div style="position:relative; width:100%;"><input type="password" id="github-token"><span id="github-token-toggle" style="position: absolute; right: 0; top: 50%; transform: translateY(-50%); cursor: pointer;">üßê</span></div></div></div>
                 <div class="settings-item"><label>Êñá‰ª∂Âêç</label><div class="settings-right"><input type="text" id="github-filename" value="ephone_backup.json"></div></div>
                 
                 <!-- GitHub Proxy -->
                 <div class="settings-item">
                    <label>‰ª£ÁêÜ (Worker)</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="github-proxy-switch">
                        <span class="slider"></span>
                    </label>
                </div>
                 <div id="github-proxy-input-group" style="display:none;">
                     <div class="settings-tip-wrapper" style="padding-top:10px !important;">
                        <div class="settings-tip-content">
                            ÂõΩÂÜÖÁΩëÁªúÂª∫ËÆÆÂºÄÂêØ„ÄÇÈúÄËá™Âª∫ Cloudflare Worker„ÄÇ<br>
                            üîó <a href="https://dash.cloudflare.com/" target="_blank">ÂâçÂæÄ Cloudflare ÊéßÂà∂Âè∞</a>
                        </div>
                    </div>
                    <div class="settings-item">
                        <label>‰ª£ÁêÜÂú∞ÂùÄ</label>
                        <div class="settings-right"><input type="text" id="github-proxy-url" placeholder="https://..."></div>
                    </div>
                 </div>
                 
                 <!-- GitHub ÊåâÈíÆ -->
                 <div class="settings-item" style="justify-content: space-around;">
                    <button id="github-upload-btn" class="settings-mini-btn">‚òÅÔ∏è ‰∏ä‰º†Â§á‰ªΩ</button>
                    <button id="github-download-btn" class="settings-mini-btn">üì• ÊÅ¢Â§çÂ§á‰ªΩ</button>
                </div>
            </div>
        </div>
        <!-- ÊÄßËÉΩ -->
        <div class="settings-header">ÊÄßËÉΩ‰∏éÊòæÁ§∫</div>
        <div class="settings-section">
            <div class="settings-item">
                <label>ËÅäÂ§©ÂàóË°®Âä†ËΩΩÊï∞</label>
                <div class="settings-right">
                    <input type="number" id="chat-list-render-window-input" class="settings-num-input">
                </div>
            </div>
             <div class="settings-item">
                <label>ËÅäÂ§©ÂÜÖÂä†ËΩΩÊï∞</label>
                <div class="settings-right">
                    <input type="number" id="chat-render-window-input" class="settings-num-input">
                </div>
            </div>
        </div>

        <!-- AIË°å‰∏∫ÊéßÂà∂ (ÂÖ®Â±ÄÈªòËÆ§) -->
        <div class="settings-header">AIË°å‰∏∫ÊéßÂà∂ÔºàÂÖ®Â±ÄÈªòËÆ§Ôºâ</div>
        <div class="settings-section">
            <div class="settings-item">
                <div>
                    <div style="font-weight: 500;">ÂêØÁî®ÂøÉÂ£∞ÂäüËÉΩ</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">AI‰ºöÂú®ÊØèÊ¨°ÂõûÂ§çÂêéÁîüÊàêÂÜÖÂøÉÁã¨ÁôΩÔºàÂøÉÂ£∞ÂíåÊï£ËÆ∞Ôºâ</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="global-enable-thoughts-switch">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="settings-item">
                <div>
                    <div style="font-weight: 500;">ÂêØÁî®Âä®ÊÄÅÂäüËÉΩ</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">AIÂèØ‰ª•‰∏ªÂä®ÂèëÂä®ÊÄÅ„ÄÅËØÑËÆ∫„ÄÅÁÇπËµû</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="global-enable-qzone-actions-switch">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="settings-item">
                <div>
                    <div style="font-weight: 500;">Êü•ÁúãUserÊâãÊú∫</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">AIÂèØ‰ª•‰∏ªÂä®Êü•Áúã‰Ω†ÁöÑÊâãÊú∫APPÔºàQQ„ÄÅÁõ∏ÂÜå„ÄÅÊ∑òÂÆù„ÄÅÈ´òÂæ∑Á≠âÔºâÔºåÂπ∂ÁªôÂá∫ÊÑüÊÉ≥</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="global-enable-view-myphone-switch">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div style="font-size: 12px; color: #666; margin-top: 10px; padding: 10px; background: #f5f5f5; border-radius: 6px;">
                üí° ÊèêÁ§∫ÔºöËøôÊòØÂÖ®Â±ÄÈªòËÆ§ËÆæÁΩÆ„ÄÇ‰Ω†ÂèØ‰ª•Âú®ÊØè‰∏™ËßíËâ≤ÁöÑËÅäÂ§©ËÆæÁΩÆ‰∏≠ÂçïÁã¨Ë¶ÜÁõñËøô‰∫õÈÄâÈ°π„ÄÇ
            </div>
        </div>


        <!-- ËÅîÊú∫ÂäüËÉΩ -->
        <div class="settings-header">
            ËÅîÊú∫ÂäüËÉΩ
            <div style="display: inline-flex; gap: 8px; margin-left: 10px;">
                <button class="help-icon-btn" onclick="openOnlineHelpLink('explain')" title="ÂäüËÉΩËß£Èáä">?</button>
                <button class="help-icon-btn help-guide-btn" onclick="openOnlineHelpLink('guide')" title="Êìç‰ΩúÊåáÂçó">ÊåáÂçó</button>
            </div>
        </div>
        <div class="settings-section">
            <!-- ÂêØÁî®ËÅîÊú∫ -->
            <div class="settings-item">
                <label>ÂêØÁî®Áúü‰∫∫ËÅîÊú∫</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="enable-online-chat-switch">
                    <span class="slider"></span>
                </label>
            </div>
            
            <!-- ËÅîÊú∫ËØ¶ÊÉÖ (JSÊéßÂà∂ÊòæÁ§∫/ÈöêËóè) -->
            <div id="online-chat-details" style="display:none;">
                <!-- ÊèêÁ§∫‰ø°ÊÅØ -->
                <div class="settings-tip-wrapper">
                    <div class="settings-tip-content">
                        ËÅîÊú∫ÂäüËÉΩËÆ©‰Ω†‰∏éÁúüÂÆûÂ•ΩÂèãËÅäÂ§©ÔºåÊ∂àÊÅØÁ´ØÂà∞Á´ØÂä†ÂØÜÔºåÊúçÂä°Âô®‰∏çÂ≠òÂÇ®ËÅäÂ§©ÂÜÖÂÆπ„ÄÇ<br>
                        ËøûÊé•Âà∞Âêå‰∏ÄÊúçÂä°Âô®ÁöÑÁî®Êà∑ÂèØ‰ª•‰∫íÁõ∏Ê∑ªÂä†Â•ΩÂèã„ÄÇ
                    </div>
                </div>
                
                <!-- ÊàëÁöÑ‰ø°ÊÅØ -->
                <div class="settings-item">
                    <label>ÊàëÁöÑID</label>
                    <div class="settings-right">
                        <input type="text" id="my-online-id" placeholder="ËÆæÁΩÆÂîØ‰∏ÄID" maxlength="20">
                    </div>
                </div>
                
                <div class="settings-item">
                    <label>ÊàëÁöÑÊòµÁß∞</label>
                    <div class="settings-right">
                        <input type="text" id="my-online-nickname" placeholder="ËÆæÁΩÆÊòæÁ§∫ÊòµÁß∞" maxlength="20">
                    </div>
                </div>
                
                <div class="settings-item">
                    <label>ÊàëÁöÑÂ§¥ÂÉè</label>
                    <div class="settings-right">
                        <div style="display: flex; align-items: center; gap: 10px; width: 100%;">
                            <img id="my-online-avatar-preview" src="https://i.postimg.cc/y8xWzCqj/anime-boy.jpg" 
                                 style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid #ddd;">
                            <button id="upload-online-avatar-btn" class="settings-mini-btn">‰∏ä‰º†</button>
                            <input type="file" id="online-avatar-input" accept="image/*" hidden>
                        </div>
                    </div>
                </div>
                
                <!-- ÊúçÂä°Âô®Âú∞ÂùÄ -->
                <div class="settings-item">
                    <label>ÊúçÂä°Âô®Âú∞ÂùÄ</label>
                    <div class="settings-right">
                        <input type="text" id="online-server-url" placeholder="wss://your-server.com/ws">
                    </div>
                </div>
                
                <!-- ËøûÊé•Áä∂ÊÄÅ -->
                <div class="settings-item">
                    <label>ËøûÊé•Áä∂ÊÄÅ</label>
                    <div class="settings-right">
                        <span id="online-connection-status" style="color: #999;">Êú™ËøûÊé•</span>
                    </div>
                </div>
                
                <!-- ËøûÊé•/Êñ≠ÂºÄÊåâÈíÆ -->
                <div class="settings-item" style="justify-content: center;">
                    <button id="connect-online-btn" class="settings-mini-btn" style="width: 45%;">ËøûÊé•ÊúçÂä°Âô®</button>
                    <button id="disconnect-online-btn" class="settings-mini-btn" style="width: 45%; display: none;">Êñ≠ÂºÄËøûÊé•</button>
                </div>
                
                <!-- Â•ΩÂèãÁî≥ËØ∑ÊåâÈíÆ -->
                <button class="settings-full-btn" id="open-friend-requests-btn">
                    Â•ΩÂèãÁî≥ËØ∑ <span id="friend-request-badge" style="display:none; background: #ff3b30; color: white; padding: 2px 8px; border-radius: 10px; font-size: 12px; margin-left: 8px;">0</span>
                </button>
                
                <!-- ÊêúÁ¥¢Ê∑ªÂä†Â•ΩÂèã -->
                <div class="settings-tip-wrapper">
                    <div class="settings-tip-content">
                        ÊêúÁ¥¢Âêå‰∏ÄÊúçÂä°Âô®‰∏äÁöÑÁî®Êà∑IDÂπ∂Ê∑ªÂä†Â•ΩÂèã
                    </div>
                </div>
                
                <div class="settings-item">
                    <label>ÊêúÁ¥¢ID</label>
                    <div class="settings-right">
                        <input type="text" id="search-friend-id-input" placeholder="ËæìÂÖ•Â•ΩÂèãID">
                    </div>
                </div>
                
                <div class="settings-item" style="justify-content: center;">
                    <button id="search-friend-btn" class="settings-mini-btn" style="width: 100%;">ÊêúÁ¥¢Âπ∂Ê∑ªÂä†Â•ΩÂèã</button>
                </div>
                
                <!-- ÊêúÁ¥¢ÁªìÊûúÊòæÁ§∫Âå∫Âüü -->
                <div id="friend-search-result" style="display: none; padding: 15px; background: #f9f9f9; border-radius: 8px; margin-top: 10px;">
                    <!-- JSÂä®ÊÄÅÂ°´ÂÖÖ -->
                </div>
                
                <!-- ÊàëÁöÑÂ•ΩÂèãÂàóË°® -->
                <button class="settings-full-btn" id="view-online-friends-btn">ÊàëÁöÑËÅîÊú∫Â•ΩÂèã</button>
            </div>
        </div>

        <!-- ÂêéÂè∞‰øùÊ¥ª -->
        <div class="settings-header">ÂêéÂè∞‰øùÊ¥ª</div>
        <div class="settings-section">
            <div class="settings-item">
                <label>
                    <span style="display: block;">ÂêØÁî®ÂêéÂè∞‰øùÊ¥ª</span>
                    <span style="font-size: 12px; color: var(--text-secondary); display: block; margin-top: 4px;">Èò≤Ê≠¢ÊµèËßàÂô®ÂíåPWAË¢´ÊâãÊú∫Á≥ªÁªüÂêéÂè∞ÊùÄÊéâ</span>
                </label>
                <label class="toggle-switch">
                    <input type="checkbox" id="background-keep-alive-switch">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="settings-item" id="keep-alive-status" style="display:none;">
                <label>‰øùÊ¥ªÁä∂ÊÄÅ</label>
                <div class="settings-right">
                    <span id="keep-alive-status-text" style="color: #999;">Êú™ÂêØÁî®</span>
                </div>
            </div>
        </div>
        <div class="settings-desc">
            ÂºÄÂêØÂêé‰ºö‰ΩøÁî®ÈùôÈªòÈü≥È¢ëÂíåÂÆöÊó∂‰ªªÂä°Á≠âÊäÄÊúØ‰øùÊåÅÂ∫îÁî®Âú®ÂêéÂè∞ÊåÅÁª≠ËøêË°åÔºåÂáèÂ∞ëË¢´Á≥ªÁªüÊ∏ÖÁêÜÁöÑÊ¶ÇÁéá„ÄÇ
        </div>

        <!-- Á≥ªÁªüÁ∫ßÈÄöÁü• -->
        <div class="settings-header">Á≥ªÁªüÁ∫ßÈÄöÁü• <span style="font-size: 12px; color: #999; margin-left: 10px;">v0.0.3</span></div>
        <div class="settings-section">
            <!-- 1. ‰∏ªÂºÄÂÖ≥ -->
            <div class="settings-item">
                <label>ÂêØÁî®Á≥ªÁªüÁ∫ßÈÄöÁü•</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="system-notification-enabled-switch">
                    <span class="slider"></span>
                </label>
            </div>
            
            <!-- ÊùÉÈôêÁä∂ÊÄÅÊòæÁ§∫ -->
            <div class="settings-item" id="notification-permission-status" style="display:none;">
                <label>ÈÄöÁü•ÊùÉÈôêÁä∂ÊÄÅ</label>
                <div class="settings-right">
                    <span id="permission-status-text" style="color: #999;">Êú™ËØ∑Ê±Ç</span>
                </div>
            </div>
            
            <!-- ËØ¶ÁªÜËÆæÁΩÆÂå∫ÂüüÔºà‰∏ªÂºÄÂÖ≥ÂºÄÂêØÂêéÊòæÁ§∫Ôºâ -->
            <div id="system-notification-details" style="display:none;">
                
                <!-- 2. Â∫îÁî®ÂêçÁß∞ -->
                <div class="settings-item">
                    <label>Â∫îÁî®ÊòæÁ§∫ÂêçÁß∞</label>
                    <div class="settings-right">
                        <input type="text" id="system-notification-app-name" placeholder="EPhone" maxlength="20">
                    </div>
                </div>
                
                <!-- 3. ÊµãËØïÈÄöÁü•ÊåâÈíÆ -->
                <button class="settings-full-btn" id="test-system-notification-btn">
                     ÂèëÈÄÅÊµãËØïÈÄöÁü•
                </button>
                
                <!-- 3.5 Ë∞ÉËØïÊåâÈíÆ -->
                <button class="settings-full-btn" id="debug-system-notification-btn" style="background: #ff9500;">
                    Ë∞ÉËØïÁ≥ªÁªüÈÄöÁü•
                </button>
                
                <!-- 4. ÊúçÂä°Âô®Êé®ÈÄÅÔºàÈ´òÁ∫ßÔºâ -->
                <div class="settings-item">
                    <label>ÂêØÁî®ÊúçÂä°Âô®Êé®ÈÄÅÔºàÈ´òÁ∫ßÔºâ</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="push-server-enabled-switch">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div id="push-server-details" style="display:none;">
                    <div class="settings-item">
                        <label>Êé®ÈÄÅÊúçÂä°Âô®Âú∞ÂùÄ</label>
                        <div class="settings-right">
                            <input type="text" id="push-server-url" placeholder="https://your-push-server.com">
                        </div>
                    </div>
                    
                    <div class="settings-item">
                        <label>API ÂØÜÈí•ÔºàÂèØÈÄâÔºâ</label>
                        <div class="settings-right">
                            <input type="text" id="push-server-api-key" placeholder="your-api-key">
                        </div>
                    </div>
                </div>
                
                <!-- 5. Ê∂àÊÅØÈúáÂä® -->
                <div class="settings-item">
                    <label>Ê∂àÊÅØÈúáÂä®</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="notification-vibration-enabled-switch">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div id="vibration-pattern-selector" style="display:none;">
                    <div class="settings-item">
                        <label>ÈúáÂä®Ê®°Âºè</label>
                        <div class="settings-right">
                            <select id="vibration-pattern-select">
                                <option value="short">Áü≠ÈúáÔºà1Ê¨°Ôºâ</option>
                                <option value="medium">‰∏≠ÈúáÔºà2Ê¨°Ôºâ</option>
                                <option value="long">ÈïøÈúáÔºà3Ê¨°Ôºâ</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                
                <!-- 7. ÊèêÁ§∫Èü≥ -->
                <div class="settings-item">
                    <label>Ëá™ÂÆö‰πâÊèêÁ§∫Èü≥</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="notification-sound-enabled-switch">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div id="notification-sound-details" style="display:none;">
                    <div class="settings-item">
                        <label>‰ΩøÁî®ÂÖ®Â±ÄÊèêÁ§∫Èü≥</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="use-global-sound-switch" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div id="custom-sound-input-wrapper" style="display:none;">
                        <div class="settings-item">
                            <label>Ëá™ÂÆö‰πâÊèêÁ§∫Èü≥ URL</label>
                            <div class="settings-right">
                                <input type="text" id="custom-notification-sound-url" placeholder="https://...">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 8. Âú®ËÅäÂ§©È°µÈù¢‰πüÂèëÈÄÅÁ≥ªÁªüÁ∫ßÈÄöÁü• -->
                <div class="settings-item">
                    <label>
                        <span style="display: block;">Âú®ËÅäÂ§©È°µÈù¢‰πüÂèëÈÄÅÈÄöÁü•</span>
                        <span style="font-size: 12px; color: var(--text-secondary); display: block; margin-top: 4px;">ÂºÄÂêØÂêéÂç≥‰ΩøÂú®ÂΩìÂâçËßíËâ≤ÁöÑËÅäÂ§©È°µÈù¢‰πü‰ºöÊî∂Âà∞Á≥ªÁªüÁ∫ßÈÄöÁü•</span>
                    </label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="notify-in-chat-page-switch">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <!-- 9. Á¶ÅÁî®ÂÜÖÈÉ®ÂºπÁ™ó -->
                <div class="settings-item">
                    <label>
                        <span style="display: block;">‰ªÖÁ≥ªÁªüÁ∫ßÈÄöÁü•</span>
                        <span style="font-size: 12px; color: var(--text-secondary); display: block; margin-top: 4px;">ÂºÄÂêØÂêéÂè™ÊòæÁ§∫Á≥ªÁªüÁ∫ßÈÄöÁü•Ôºå‰∏çÊòæÁ§∫Â∫îÁî®ÂÜÖÂºπÁ™ó</span>
                    </label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="disable-internal-notification-switch">
                        <span class="slider"></span>
                    </label>
                </div>
                
            </div>
        </div>
        <div class="settings-desc">
            Á≥ªÁªüÁ∫ßÈÄöÁü•‰ºöÂú®ËÆæÂ§áÈÄöÁü•‰∏≠ÂøÉÊòæÁ§∫ÔºåÊîØÊåÅÊ®™ÂπÖÂºπÁ™ó„ÄÇÈúÄË¶ÅÊéà‰∫àÈÄöÁü•ÊùÉÈôê„ÄÇ
        </div>

        <!-- Êï∞ÊçÆÁÆ°ÁêÜ (Âç±Èô©Âå∫Âüü) -->
        <div class="settings-header">Êï∞ÊçÆÁÆ°ÁêÜ</div>
        
        <div class="settings-section">
            <!-- 1. ÂõæÁâáÂç†Áî® + ÂéãÁº©ÊåâÈíÆ (Âêå‰∏ÄË°å) -->
            <div class="settings-item">
                <!-- Â∑¶‰æßÊ†áÈ¢ò -->
                <label style="flex-shrink: 0;">Êú¨Âú∞ÂõæÁâáÂç†Áî®</label>
                
                <!-- Âè≥‰æßÂå∫ÂüüÔºöÊï∞ÂÄº + ÊåâÈíÆ -->
                <div class="data-row-right">
                    <!-- Êï∞ÂÄº (Áî±JSÂ°´ÂÖÖÔºåCSS‰ºöÈöêËóèÂ§ö‰ΩôÊñáÂ≠óÂè™ÁïôMB) -->
                    <span id="total-image-size-display">ËÆ°ÁÆó‰∏≠...</span>
                    
                    <!-- ÂéãÁº©ÊåâÈíÆ -->
                    <button id="compress-images-btn" class="settings-mini-btn">ÂéãÁº©</button>
                </div>
            </div>
            
            <!-- ÂàóË°®ÊåâÈíÆÔºöÈªëËâ≤Â∑¶ÂØπÈΩê -->
            <button class="settings-full-btn" id="export-data-btn">ÂØºÂá∫ÊâÄÊúâÊï∞ÊçÆ</button>
            <button class="settings-full-btn" id="import-btn">ÂØºÂÖ•Â§á‰ªΩÊñá‰ª∂</button>
            <input id="import-data-input" type="file" accept="application/json" hidden>
            
            <button class="settings-full-btn" id="cleanup-data-btn">Ê∏ÖÁêÜÂÜó‰ΩôÊï∞ÊçÆ</button>
            <button class="settings-full-btn" id="delete-world-books-btn">Âà†Èô§‰∏ñÁïå‰π¶</button>
            <button class="settings-full-btn" id="clear-specific-data-btn">È´òÁ∫ßÊï∞ÊçÆÊ∏ÖÁêÜ</button>
            <button class="settings-full-btn" id="check-and-fix-data-btn">Êï∞ÊçÆÊ£ÄÊü•‰∏é‰øÆÂ§ç</button>
            <button class="settings-full-btn" id="emergency-reset-appearance-btn" >ÈáçÁΩÆÂΩìÂâçÂ§ñËßÇ</button>
            <button class="settings-full-btn" id="factory-reset-btn" > ÂàùÂßãÂåñÊâÄÊúâÂÜÖÂÆπ (ÊÖéÁî®)</button>
        </div>
        
        <!-- Â∫ïÈÉ®Âû´È´ò -->
        <div style="height: 60px;"></div>
      </div>
    </div>
<div id="import-options-modal" class="modal">
  <div class="modal-content" style="height: auto;">
    <div class="modal-header">
      <span>ÂèëÁé∞Â§á‰ªΩÊñá‰ª∂</span>
    </div>
    <div class="modal-body">
      <p>Âú®Ê≠§Â§á‰ªΩÊñá‰ª∂‰∏≠ÊâæÂà∞‰∫Ü‰ª•‰∏ãÊï∞ÊçÆÔºö</p>
      <ul id="import-preview-list" style="text-align: left; margin-left: 20px; max-height: 200px; overflow-y: auto; background: #f9f9f9; padding: 10px; border-radius: 8px;">
        </ul>
      <hr style="opacity: 0.2; margin: 20px 0;">
      <p style="font-weight: bold;">ËØ∑ÈÄâÊã©ÂØºÂÖ•ÊñπÂºèÔºö</p>
    </div>
    <div class="modal-footer" style="flex-direction: column; gap: 10px;">
      <button class="save btn-danger" id="confirm-full-import-btn" style="width: 100%; background-color: #ff3b30; border-color: #ff3b30;">
        <strong>ÂÆåÂÖ®ÂØºÂÖ• (Ë¶ÜÁõñÊâÄÊúâÊï∞ÊçÆ)</strong>
        <small style="display: block; font-weight: normal; opacity: 0.8;">Â∞ÜÂà†Èô§Êú¨Âú∞ÊâÄÊúâÊï∞ÊçÆÔºåÂπ∂ÊõøÊç¢‰∏∫Â§á‰ªΩÊñá‰ª∂‰∏≠ÁöÑÊï∞ÊçÆ„ÄÇ</small>
      </button>
      <button class="save" id="confirm-selective-import-btn" style="width: 100%;">
        <strong>ÈÄâÊã©ÊÄßÂØºÂÖ• (ÂêàÂπ∂Êï∞ÊçÆ)</strong>
        <small style="display: block; font-weight: normal; opacity: 0.8;">Â∞ÜÂ§á‰ªΩÊñá‰ª∂‰∏≠ÁöÑÊï∞ÊçÆ„ÄêÊ∑ªÂä†„ÄëÂà∞ÊÇ®Áé∞ÊúâÁöÑÊï∞ÊçÆ‰∏≠„ÄÇ</small>
      </button>
      <button class="cancel" id="cancel-import-options-btn" style="width: 100%; margin-top: 8px;" data-lang-key="cancel">ÂèñÊ∂à</button>
    </div>
  </div>
</div>

<div id="selective-import-modal" class="modal">
  <div class="modal-content" style="height: 70%;">
    <div class="modal-header">
      <span>ÈÄâÊã©Ë¶ÅÂêàÂπ∂ÁöÑÊï∞ÊçÆ</span>
      <label style="font-size: 14px; font-weight: normal; display: flex; align-items: center; gap: 5px;">
        <input type="checkbox" id="select-all-import-types"> ÂÖ®ÈÄâ
      </label>
    </div>
    <div class="modal-body" id="selective-import-list" style="padding: 0;">
      </div>
    <div class="modal-footer">
      <button class="cancel" id="cancel-selective-import-btn" data-lang-key="cancel">ÂèñÊ∂à</button>
      <button class="save" id="confirm-merge-import-btn">Á°ÆËÆ§ÂêàÂπ∂</button>
    </div>
  </div>
</div>
    <div id="data-clear-wizard-modal" class="modal">
      <div class="modal-content" style="height: 80%;">
        <div id="data-clear-step-1" class="wizard-step">
          <div class="modal-header"> <span>Á¨¨‰∏ÄÊ≠•ÔºöÈÄâÊã©Ë¶ÅÊ∏ÖÁêÜÁöÑËßíËâ≤</span> <label> <input type="checkbox" id="select-all-chars-for-clear"> ÂÖ®ÈÄâ </label> </div>
          <div class="modal-body" id="data-clear-char-list" style="padding: 0;"> </div>
          <div class="modal-footer"> <button class="cancel" id="cancel-clear-wizard-btn-step1"data-lang-key="cancel">ÂèñÊ∂à</button> <button class="save" id="go-to-clear-step2-btn">‰∏ã‰∏ÄÊ≠•</button> </div>
        </div>
        <div id="data-clear-step-2" class="wizard-step" style="display: none;">
          <div class="modal-header"> <span>Á¨¨‰∫åÊ≠•ÔºöÈÄâÊã©Ë¶ÅÊ∏ÖÁêÜÁöÑÊï∞ÊçÆÁ±ªÂûã</span> <label> <input type="checkbox" id="select-all-types-for-clear"> ÂÖ®ÈÄâ </label> </div>
          <div class="modal-body" id="data-clear-type-list" style="padding: 0;"> </div>
          <div class="modal-footer"> <button class="form-button-secondary" id="back-to-clear-step1-btn" style="width: 30%; margin:0;">‰∏ä‰∏ÄÊ≠•</button> <button class="cancel" id="cancel-clear-wizard-btn-step2" style="width: 30%; margin:0;"data-lang-key="cancel">ÂèñÊ∂à</button> <button class="save btn-danger"
              id="confirm-final-clear-btn" style="width: 30%; margin:0;">Á°ÆËÆ§Ê∏ÖÁêÜ</button> </div>
        </div>
      </div>
    </div>
    <div id="chat-list-screen" class="screen">
      <div class="header" id="main-chat-list-header"> <span class="back-btn" onclick="showScreen('home-screen')">‚Äπ</span> <span id="chat-list-title"data-lang-key="chatListTitle">Ê∂àÊÅØ</span>
        <div class="header-actions"> <span class="action-btn" id="add-group-chat-btn" title="ÂàõÂª∫Áæ§ËÅä"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M17.5 17.5C19.1569 17.5 20.5 16.1569 20.5 14.5C20.5 12.8431 19.1569 11.5 17.5 11.5C15.8431 11.5 14.5 12.8431 14.5 14.5C14.5 16.1569 15.8431 17.5 17.5 17.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M21 21L19 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M8.5 11.5C10.1569 11.5 11.5 10.1569 11.5 8.5C11.5 6.84315 10.1569 5.5 8.5 5.5C6.84315 5.5 5.5 6.84315 5.5 8.5C5.5 10.1569 6.84315 11.5 8.5 11.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M12.5 14.5H4.5C3.39543 14.5 2.5 15.3954 2.5 16.5V18.5H12.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg></span> <span class="action-btn" id="add-chat-btn">+</span> </div>
      </div>
      <div id="messages-view" class="chat-list-view active">
        <div id="chat-list"> </div>
      </div>
      <div id="qzone-screen" class="chat-list-view">
        <div class="qzone-header"> <span class="back-btn" id="qzone-back-btn">‚Äπ</span> <span data-lang-key="qzoneTitle">Â•ΩÂèãÂä®ÊÄÅ</span>
          <div class="header-actions"> <span class="action-btn" id="qzone-more-actions-btn" title="Êõ¥Â§öÊìç‰Ωú">‚Ä¶</span> </div>
        </div>
        <div class="qzone-content">
          <div class="qzone-profile-header">
            <div id="qzone-banner-container" class="qzone-banner-container"> <img id="qzone-banner-img" src="https://files.catbox.moe/r5heyt.gif" alt="ËÉåÊôØ"> <input type="file" id="qzone-banner-input" accept="image/*" hidden> </div>
            <div class="qzone-user-info">
              <div id="qzone-avatar-container" class="qzone-avatar-container"> <img id="qzone-avatar-img" src="https://files.catbox.moe/q6z5fc.jpeg" alt="Â§¥ÂÉè"> <input type="file" id="qzone-avatar-input" accept="image/*" hidden> </div> <span id="qzone-nickname">{{user}}</span>
            </div>
          </div>
          <div class="qzone-actions-bar">
            <div class="action-item" id="create-shuoshuo-btn"><span data-lang-key="qzoneActionShuoshuo">ËØ¥ËØ¥</span></div>
            <div class="action-item" id="create-post-btn"><span data-lang-key="qzoneActionPost">Âä®ÊÄÅ</span></div>
            <div class="action-item" id="open-album-btn"><span data-lang-key="qzoneActionAlbum">Áõ∏ÂÜå</span></div>
          </div>
          <div id="qzone-posts-list"></div>
        </div>
      </div>
      <div id="favorites-view" class="chat-list-view">
        <div class="header"> <span class="back-btn" id="favorites-back-btn">‚Äπ</span> <span data-lang-key="navFavorites">ÊàëÁöÑÊî∂Ëóè</span> <span class="action-btn" id="favorites-edit-btn"data-lang-key="edit">ÁºñËæë</span> </div>
        <div class="search-bar-container"> <input type="search" id="favorites-search-input" placeholder="ÊêúÁ¥¢Êî∂ËóèÁöÑÊ†áÈ¢ò„ÄÅÂÜÖÂÆπÊàñ‰ΩúËÄÖ..."> <button id="favorites-search-clear-btn" class="search-clear-btn" style="display: none;">√ó</button> </div>
        <div id="favorites-list" class="list-container"> </div>
        <div id="favorites-action-bar" style="display: none;"> <button id="favorites-delete-selected-btn" class="action-bar-btn">Âà†Èô§ (0)</button> </div>
      </div>
      <div id="memories-view" class="chat-list-view">
        <div class="header"> <span class="back-btn" id="memories-back-btn">‚Äπ</span> <span>Êàë‰ª¨ÁöÑÂõûÂøÜ</span> <span class="action-btn" id="add-countdown-btn">+</span> </div>
        <div id="memories-list" class="list-container" style="padding: 15px; display: flex; flex-direction: column; gap: 15px;"> </div>
      </div>
      <div id="npc-list-view" class="chat-list-view">
        <div class="header"> <span class="back-btn" id="npc-list-back-btn">‚Äπ</span> <span>NPC ÂàóË°®</span>
          <div class="header-actions"> <span class="action-btn" id="add-npc-btn">+</span> </div>
        </div>
        <div id="npc-list" class="list-container" style="padding: 0;"> </div>
      </div>
      <div id="chat-list-bottom-nav">
        <div class="nav-item active" data-view="messages-view"> <span data-lang-key="navMessages">Ê∂àÊÅØ</span> </div>
        <div class="nav-item" data-view="qzone-screen"> <span data-lang-key="navQzone">Âä®ÊÄÅ</span> </div>
        <div class="nav-item" data-view="memories-view"> <span data-lang-key="navMemories">ÂõûÂøÜ</span> </div>
        <div class="nav-item" data-view="favorites-view"> <span data-lang-key="navFavorites">Êî∂Ëóè</span> </div>
        <div class="nav-item" data-view="npc-list-view"> <span data-lang-key="navNpcList">NPC</span> </div>
      </div>
    </div>
    <div id="album-screen" class="screen">
      <div class="header"> <span class="back-btn" id="album-back-btn">‚Äπ</span> <span>ÊàëÁöÑÁõ∏ÂÜå</span> <span class="action-btn" id="create-album-btn-page">+</span> </div>
      <div class="list-container">
        <div id="album-grid-page"> </div>
      </div>
    </div>
    <div id="album-photos-screen" class="screen">
      <div class="header"> <span class="back-btn" id="album-photos-back-btn">‚Äπ</span> <span id="album-photos-title">Áõ∏ÂÜåÂêçÁß∞</span> <span class="action-btn" id="album-upload-photo-btn">‰∏ä‰º†</span> </div>
      <div class="list-container">
        <div id="photos-grid-page"> </div>
        <div id="photo-viewer-modal" class="modal"> <button id="photo-viewer-close-btn">√ó</button> <button id="photo-viewer-prev-btn" class="nav-arrow">‚Äπ</button>
          <div class="photo-viewer-content"> <img id="photo-viewer-image" src="" alt="ÂÖ®Â±èÁÖßÁâáÈ¢ÑËßà"> </div> <button id="photo-viewer-next-btn" class="nav-arrow">‚Ä∫</button>
        </div>
      </div>
    </div>
    <div id="npc-editor-modal" class="modal">
      <div class="modal-content" style="height: 80%;">
        <div class="modal-header"> <span id="npc-editor-title"data-lang-key="add">Ê∑ªÂä† NPC</span> </div>
        <div class="modal-body">
          <div class="form-group"> <label>NPC Â§¥ÂÉè</label>
            <div class="avatar-upload"> <img id="npc-avatar-preview" src="https://i.postimg.cc/VkQfgzGJ/1.jpg"> <button onclick="document.getElementById('npc-avatar-input').click()">‰∏ä‰º†Â§¥ÂÉè</button> <input type="file" id="npc-avatar-input" accept="image/*" hidden> </div>
          </div>
          <div class="form-group"> <label for="npc-name-input">NPC ÊòµÁß∞</label> <input type="text" id="npc-name-input" placeholder="ËæìÂÖ•NPCÁöÑÂ∏∏Áî®Âêç"> </div>
          <div class="form-group"> <label for="npc-persona-input">NPC ‰∫∫ËÆæ</label> <textarea id="npc-persona-input" rows="4" placeholder="ËØ¶ÁªÜÊèèËø∞Ëøô‰∏™NPCÁöÑÊÄßÊ†º„ÄÅËÉåÊôØ„ÄÅËØ¥ËØùÊñπÂºèÁ≠â..."></textarea> </div>
<div class="form-group" id="npc-group-section">
            <label for="npc-group-select">NPC ÂàÜÁªÑ (Áî®‰∫éNPCÈó¥‰∫íËØÑ)</label>
            <div style="display: flex; align-items: center; gap: 10px;">
              <select id="npc-group-select" style="flex-grow: 1;">
                <option value="">-- Êú™ÂàÜÁªÑ --</option>
              </select>
              <button id="manage-npc-groups-btn" type="button" class="form-button-secondary" style="margin-top: 0; padding: 12px;">ÁÆ°ÁêÜÂàÜÁªÑ</button>
            </div>
            <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;">
                Âè™ÊúâÂú®Âêå‰∏Ä‰∏™ÂàÜÁªÑÂÜÖÁöÑNPCÊâçËÉΩ‰∫íÁõ∏ÁúãËßÅÂíåËØÑËÆ∫ÂØπÊñπÁöÑÂä®ÊÄÅ„ÄÇ
            </p>
          </div>
          <hr style="opacity: 0.2;">
          <div class="form-group" style="display: flex; justify-content: space-between; align-items: center;"> <label for="npc-background-activity-switch" style="margin-bottom: 0;"> ÂêØÁî®Áã¨Á´ãÂêéÂè∞Ê¥ªÂä® <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;">
                ÂÖÅËÆ∏ËØ•NPCÂú®ÂêéÂè∞Áã¨Á´ãÂèëË°®Âä®ÊÄÅËØÑËÆ∫„ÄÇÈúÄÂêåÊó∂ÂºÄÂêØAPIËÆæÁΩÆ‰∏≠ÁöÑÊÄªÂºÄÂÖ≥„ÄÇ </p> </label> <label class="toggle-switch"> <input type="checkbox" id="npc-background-activity-switch"> <span class="slider"></span> </label> </div>
          <div class="form-group"> <label for="npc-action-cooldown-input"> Áã¨Á´ãË°åÂä®ÂÜ∑Âç¥ (ÂàÜÈíü) <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> ËØ•NPCÂú®ÂêéÂè∞‰∏ªÂä®Ë°åÂä®ÁöÑÊúÄÂ∞èÈó¥Èöî„ÄÇ </p> </label> <input type="number" id="npc-action-cooldown-input" min="1" value="15"
              style="width: 80px; text-align: center;"> </div>
          <div class="form-group"> <label>ÂÖ≥ËÅîÁöÑËßíËâ≤ (NPC‰ºöÂéªËØÑËÆ∫Ëøô‰∫õËßíËâ≤ÁöÑÂä®ÊÄÅ)</label>
            <div id="npc-association-list" style="max-height: 150px; overflow-y: auto; background: #f9f9f9; padding: 10px; border-radius: 8px;"> </div>
          </div>
        </div>
        <div class="modal-footer"> <button class="cancel" id="cancel-npc-editor-btn"data-lang-key="cancel">ÂèñÊ∂à</button> <button class="save" id="save-npc-btn">‰øùÂ≠ò</button> </div>
      </div>
    </div>
    <div id="clear-posts-modal" class="modal">
      <div class="modal-content" style="height: 70%;">
        <div class="modal-header"> <span>ÈÄâÊã©Ê∏ÖÁ©∫ËåÉÂõ¥</span> </div>
        <div class="modal-body" id="clear-posts-list" style="padding: 0;"> </div>
        <div class="modal-footer"> <button class="cancel" id="cancel-clear-posts-btn"data-lang-key="cancel">ÂèñÊ∂à</button> <button class="save btn-danger" id="confirm-clear-posts-btn">Á°ÆËÆ§Ê∏ÖÁ©∫</button> </div>
      </div>
    </div> <input type="file" id="album-photo-input" accept="image/*" multiple hidden>
    <div id="chat-interface-screen" class="screen">
      <div id="gomoku-overlay">
        <div id="gomoku-content-wrapper"> <canvas id="gomoku-board"></canvas>
          <div id="gomoku-controls"> <button id="close-gomoku-btn">Êî∂Ëµ∑Ê£ãÁõò</button> </div>
        </div>
      </div>
      <div id="reading-overlay">
        <div id="reading-restore-btn" style="display: none;">üìñ</div>
        <div id="reading-window">
          <div class="reading-header"> <span id="reading-title">Êú™ÈÄâÊã©‰π¶Á±ç</span>
            <div class="reading-controls"> <button id="toggle-reading-fullscreen-btn" title="ÂàáÊç¢ÂÖ®Â±è">
        <svg class="icon-maximize" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
        </svg>
        <svg class="icon-minimize" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
            <path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"></path>
        </svg>
    </button><button id="minimize-reading-btn" title="ÊúÄÂ∞èÂåñ" style="font-size: 20px; line-height: 1;"> <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round">
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg> </button> <button id="open-reading-library-btn" title="ÊâìÂºÄ‰π¶Â∫ì" style="font-size: 22px; line-height: 1;"> <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="3" y1="12" x2="21" y2="12"></line>
                  <line x1="3" y1="6" x2="21" y2="6"></line>
                  <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg></button> <button id="close-reading-btn" title="ÂÖ≥Èó≠"> <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg> </button></div>
          </div>
          <div id="reading-content">
            <p>ÁÇπÂáª‚ÄúÂØºÂÖ•‚ÄùÊåâÈíÆÔºå<br>‰ªéÊú¨Âú∞.txtÊñá‰ª∂ÊàñÁΩëÁªúURLÂä†ËΩΩ‰π¶Á±çÂÜÖÂÆπ„ÄÇ</p>
          </div>
          <div class="reading-footer"> <button id="prev-page-btn">‰∏ä‰∏ÄÈ°µ</button> <span id="page-indicator">0 / 0</span> <button id="next-page-btn">‰∏ã‰∏ÄÈ°µ</button> </div>
        </div>
      </div><input type="file" id="book-upload-input" accept=".txt, text/plain" hidden>
      <div class="header">
        <div class="default-controls"> <span class="back-btn" id="back-to-list-btn">‚Äπ</span>
          <div id="global-lyrics-bar"></div>
          <div id="chat-header-title-wrapper"> <span id="chat-header-title">ËÅäÂ§©ÂØπË±°</span>
            <div id="chat-header-status"> <span class="status-dot"></span> <span class="status-text">Âú®Á∫ø</span> </div>
          </div>
          <div class="header-actions"> <span class="action-btn" id="open-memory-screen-btn" title="ÈïøÊúüËÆ∞ÂøÜ"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M16 3H5C3.89543 3 3 3.89543 3 5V19C3 20.1046 3.89543 21 5 21H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M12 6L9 9L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M21 5V19C21 20.1046 20.1046 21 19 21H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg> </span> <span class="action-btn" id="listen-together-btn" title="‰∏ÄËµ∑Âê¨"><img src="https://i.postimg.cc/dV8sdNcx/210-20250618115221.png" alt="‰∏ÄËµ∑Âê¨"></span> <span class="action-btn" id="chat-settings-btn" title="ËÅäÂ§©ËÆæÁΩÆ"><img
                src="https://i.postimg.cc/bvPq64cv/CCA834-BA-5-A90-408-D-94-FA-7-EE156-B6-A765.png" alt="ËÆæÁΩÆ"></span> </div>
        </div>
        <div class="selection-controls"> 
          <!-- ÂèñÊ∂àÊåâÈíÆ (ÊõøÊç¢‰∏∫ X ÂõæÊ†á) -->
          <span id="selection-cancel-btn" title="ÂèñÊ∂à"> 
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
               <line x1="18" y1="6" x2="6" y2="18"></line>
               <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </span> 

          <span id="selection-count"></span>
          
          <div class="header-actions"> 
            <!-- Âè≥‰æßÁöÑÂÖ∂‰ªñÊåâÈíÆ‰øùÊåÅ‰Ω†ÂàöÊâç‰øÆÊîπÁöÑ SVG ‰∏çÂèò -->
            <span id="selection-screenshot-btn" class="action-btn" title="ÈïøÊà™Âõæ"> 
               <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                  <circle cx="12" cy="13" r="4"></circle>
               </svg>
            </span> 
            <span id="selection-favorite-btn" class="action-btn" title="Êî∂Ëóè"> 
               <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
               </svg>
            </span> 
            <span id="selection-forward-btn" class="action-btn" title="ËΩ¨Âèë" data-lang-key-title="chatSelectionForward"> 
               <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="17 11 12 6 7 11"></polyline>
                  <polyline points="17 18 12 13 7 18"></polyline>
               </svg>
            </span>
            <span id="selection-share-btn" class="action-btn" title="ÂàÜ‰∫´"> 
               <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="18" cy="5" r="3"></circle>
                  <circle cx="6" cy="12" r="3"></circle>
                  <circle cx="18" cy="19" r="3"></circle>
                  <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                  <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
               </svg>
            </span> 
            <span id="selection-soft-delete-btn" class="action-btn" title="Âà†Èô§(ÈÄöÁü•AI)"> 
               <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="3 6 5 6 21 6"></polyline>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
               </svg>
            </span>
            <span id="selection-erase-btn" class="action-btn" style="color: #ff3b30;" title="ÂΩªÂ∫ïÂà†Èô§">
               <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M20 20H7L3 16C2 15 2 13 3 12L13 2L22 11L20 20Z"></path>
                  <path d="M17 17L7 7"></path>
               </svg>
            </span> 
          </div>
        </div>
      </div>
      <div id="chat-messages">
        <div id="typing-indicator">ÂØπÊñπÊ≠£Âú®ËæìÂÖ•...</div>
      </div>
      <div id="chat-input-area">
        <div id="chat-at-mention-popup" class="at-mention-popup"></div>
        <div id="reply-preview-bar">
          <div class="reply-preview-content">
            <div class="sender">ÂõûÂ§ç xxx:</div>
            <div class="text">Ë¢´ÂºïÁî®ÁöÑÊ∂àÊÅØÂÜÖÂÆπ...</div>
          </div> <span id="cancel-reply-btn">√ó</span>
        </div>
        <div id="chat-input-actions-top"> <button id="open-sticker-panel-btn" class="chat-action-icon-btn action-button" title="Ë°®ÊÉÖÈù¢Êùø">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
        <line x1="9" y1="9" x2="9.01" y2="9"></line>
        <line x1="15" y1="9" x2="15.01" y2="9"></line>
    </svg>
</button> <button id="send-photo-btn" class="chat-action-icon-btn action-button" title="ÂèëÈÄÅÁÖßÁâá"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"
              xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
              <circle cx="12" cy="13" r="4"></circle>
            </svg></button> <button id="camera-capture-btn" class="chat-action-icon-btn action-button" title="ÊãçÁÖß">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"></path>
              <circle cx="12" cy="13" r="3"></circle>
            </svg>
          </button> <button id="upload-image-btn" class="chat-action-icon-btn action-button" title="‰∏ä‰º†ÂõæÁâá"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M21 3.5H3C2.44772 3.5 2 3.94772 2 4.5V19.5C2 20.0523 2.44772 20.5 3 20.5H21C21.5523 20.5 22 20.0523 22 19.5V4.5C22 3.94772 21.5523 3.5 21 3.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
              <path d="M16.5 13.5C17.6046 13.5 18.5 12.6046 18.5 11.5C18.5 10.3954 17.6046 9.5 16.5 9.5C15.3954 9.5 14.5 10.3954 14.5 11.5C14.5 12.6046 15.3954 13.5 16.5 13.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
              <path d="M22 14.5L18 10.5L10.3333 18.5M12.5 16L9 12.5L2 19.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg> </button><button id="transfer-btn" class="chat-action-icon-btn action-button" title="ËΩ¨Ë¥¶">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="2" y="6" width="20" height="12" rx="2"></rect>
        <circle cx="12" cy="12" r="2"></circle>
        <path d="M6 12h.01M18 12h.01"></path>
    </svg>
</button><button id="voice-message-btn" class="chat-action-icon-btn action-button" title="ÂèëÈÄÅËØ≠Èü≥"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"
              xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
              <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
              <path d="M12 19v4"></path>
              <path d="M8 23h8"></path>
            </svg></button> <button id="send-waimai-request-btn" class="chat-action-icon-btn action-button" title="ÂèëËµ∑Â§ñÂçñËØ∑Ê±Ç"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <path d="M16 10a4 4 0 0 1-8 0"></path>
            </svg></button> <button id="video-call-btn" class="chat-action-icon-btn action-button" title="ËßÜÈ¢ëÈÄöËØù"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polygon points="23 7 16 12 23 17 23 7"></polygon>
              <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
            </svg></button> <button id="group-video-call-btn" class="chat-action-icon-btn action-button" title="Áæ§ËßÜÈ¢ëÈÄöËØù"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg></button> <button id="send-poll-btn" class="chat-action-icon-btn action-button" title="ÂèëËµ∑ÊäïÁ•®"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M8 6h10"></path>
              <path d="M6 6h.01"></path>
              <path d="M8 12h10"></path>
              <path d="M6 12h.01"></path>
              <path d="M8 18h10"></path>
              <path d="M6 18h.01"></path>
            </svg></button> <button id="share-link-btn" class="chat-action-icon-btn action-button" title="ÂàÜ‰∫´ÈìæÊé•"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.72"></path>
              <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.72"></path>
            </svg></button> <button id="share-location-btn" class="chat-action-icon-btn action-button" title="ÂÖ±‰∫´‰ΩçÁΩÆ"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg></button> <button id="gomoku-btn" class="chat-action-icon-btn action-button" title="‰∫îÂ≠êÊ£ã"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <circle cx="12" cy="12" r="4"></circle>
              <circle cx="12" cy="12" r="7"></circle>
            </svg> </button> <button id="open-shopping-btn" class="chat-action-icon-btn action-button" title="Ë¥≠Áâ©"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg> </button> <button id="pat-btn" class="chat-action-icon-btn action-button" title="Êãç‰∏ÄÊãç" style="display: none;"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M16 5.02c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M14.5 11.02c0 .83-.67 1.5-1.5 1.5v0c-.83 0-1.5-.67-1.5-1.5v-5c0-.83.67-1.5 1.5-1.5v0c.83 0 1.5.67 1.5 1.5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M8 11.02c0 .83-.67 1.5-1.5 1.5v0c-.83 0-1.5-.67-1.5-1.5v-5c0-.83.67-1.5 1.5-1.5v0c.83 0 1.5.67 1.5 1.5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" />
            </svg> </button> <button id="edit-last-response-btn" class="chat-action-icon-btn action-button" title="ÂØºÊºîÊ®°ÂºèÔºöÁºñËæëAI‰∏ä‰∏ÄËΩÆÁöÑÂÆåÊï¥ÂìçÂ∫î"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M12 20h9"></path>
              <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
            </svg> </button> <button id="regenerate-btn" class="chat-action-icon-btn action-button" title="ÈáçÊñ∞ÁîüÊàêÂõûÂ§ç" style="display: flex;"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
              <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
            </svg> </button> <button id="propel-btn" class="chat-action-icon-btn action-button" title="Êé®ËøõÂâßÊÉÖ" style="display: flex;"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <polygon points="13 19 22 12 13 5 13 19"></polygon>
              <polygon points="2 19 11 12 2 5 2 19"></polygon>
            </svg> </button> <button id="show-announcement-board-btn" class="chat-action-icon-btn action-button" title="Áæ§ÂÖ¨ÂëäÊùø" style="display: none;"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M21.782 6.132a1 1 0 0 0-1.053-.08l-4.729 2.489a1 1 0 0 0-.5.88v4.158a1 1 0 0 0 .5.88l4.729 2.489a1 1 0 0 0 1.053-.08a1 1 0 0 0 .499-.921V7.052a1 1 0 0 0-.499-.92zm-6 3.207L11 7.05v9.9l4.782-2.281V9.339zM10 6H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h6V6z" />
            </svg> </button><button id="werewolf-game-btn" class="chat-action-icon-btn action-button" title="Áãº‰∫∫ÊùÄ" style="display: none;"> <svg width="24" height="24" viewBox="0 0 512 512" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M332.6 128.5c-61.1 0-110.5 49.4-110.5 110.5 0 23.4 7.3 45.1 19.9 63.3-19.3 6.3-40.1 9.7-61.9 9.7-88.2 0-160-71.8-160-160s71.8-160 160-160c5.3 0 10.5.3 15.6.8C202.9 44.1 160 0 160 0s-53.3 44.1-45.9 92.5c-48.4 24.3-82.1 73.4-82.1 129.6 0 80.9 65.5 146.4 146.4 146.4 20.2 0 39.4-4.1 56.8-11.5 24.1 33.6 63.3 56.8 107.4 56.8 7.2 0 14.2-0.6 21-1.7 15.2 24.2 41.2 41.1 71.6 41.1 44.7 0 80.9-36.2 80.9-80.9 0-25.2-11.5-47.7-29.6-62.6 11.6-16.1 18.4-35.6 18.4-56.5C443.1 177.9 393.7 128.5 332.6 128.5zM180.1 85.8c-52.1 0-94.4 42.3-94.4 94.4s42.3 94.4 94.4 94.4 94.4-42.3 94.4-94.4S232.2 85.8 180.1 85.8zM332.6 170.9c-37.8 0-68.4 30.6-68.4 68.4s30.6 68.4 68.4 68.4 68.4-30.6 68.4-68.4S370.4 170.9 332.6 170.9z">
              </path>
            </svg></button><button id="read-together-btn" class="chat-action-icon-btn action-button" title="‰∏ÄËµ∑ËØª‰π¶"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
              <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
            </svg></button> <button id="open-nai-gallery-btn" class="chat-action-icon-btn action-button" title="NAIÁîªÂªä">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 3l1.91 5.86L20 10.9l-5.86 1.91L12 18.6l-1.91-5.86L4 10.9l5.86-1.91L12 3z"/>
        <path d="M5 3l1.5 4.5L11 9l-4.5 1.5L5 12l-1.5-4.5L-1 6l4.5-1.5L5 3z"/>
        <path d="M19 15l-1.5 4.5L13 21l4.5-1.5L19 18l1.5 4.5L25 21l-4.5-1.5L19 15z"/>
    </svg>
</button>
<button id="open-quick-reply-btn" class="chat-action-icon-btn action-button" title="Âø´Êç∑ÂõûÂ§ç">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
              </svg>
            </button>
<button id="open-todo-list-btn" class="chat-action-icon-btn action-button" title="ÂæÖÂäû‰∫ãÈ°π">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M9 11l3 3L22 4"></path>
        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
    </svg>
</button> <button id="open-truth-game-btn" class="chat-action-icon-btn action-button" title="ÁúüÂøÉËØù">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
    </svg>
</button> <button id="open-watch-together-btn" class="chat-action-icon-btn action-button" title="‰∏ÄËµ∑ÁúãÁîµÂΩ±">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="2" y="7" width="20" height="15" rx="2" ry="2"></rect>
        <polyline points="17 2 12 7 7 2"></polyline>
    </svg>
</button> <button id="stop-api-call-btn" class="chat-action-icon-btn action-button" title="ÊöÇÂÅúË∞ÉÁî®" style="display: none;"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <rect x="9" y="8" width="2" height="8" rx="1" fill="currentColor"></rect>
              <rect x="13" y="8" width="2" height="8" rx="1" fill="currentColor"></rect>
            </svg> </button>
</div>
        <div id="chat-input-main-row"> <button id="chat-expand-btn" class="chat-action-icon-btn action-button" title="Â±ïÂºÄÂäüËÉΩ">+</button><textarea id="chat-input" rows="1" placeholder="ËæìÂÖ•Ê∂àÊÅØ..."></textarea>
          <div id="input-actions-wrapper"> <button id="wait-reply-btn" title="Á≠âÂæÖÂõûÂ§ç"><img src="https://i.postimg.cc/q72zq80N/ECE92-BBC-BE57-48-E9-BB2-C-345-B6019-C4-B2.png" alt="Á≠âÂæÖÂõûÂ§ç"></button> <button id="send-btn" class="action-button">ÂèëÈÄÅ</button> </div>
        </div>
      </div>
      <div id="chat-lock-overlay">
        <div id="chat-lock-content"></div>
      </div>
<div id="nai-gallery-panel">
    <div id="nai-gallery-panel-header">
        <span class="panel-btn" id="close-nai-gallery-btn" data-lang-key="cancel">ÂèñÊ∂à</span>
        
        <div id="nai-gallery-tabs">
            <div class="nai-gallery-tab active" data-tab-id="local">Êú¨Âú∞</div>
            <div class="nai-gallery-tab" data-tab-id="cloud">ÂõæÂ∫ä</div>
        </div>
        
        <div style="display: flex; gap: 10px;">
            <span class="panel-btn" id="manage-nai-gallery-btn">ÁÆ°ÁêÜ</span>
        </div>
    </div>
    
    <div id="nai-gallery-grid-container">
        <div id="nai-gallery-grid-local" class="nai-gallery-page active">
            </div>
        
        <div id="nai-gallery-grid-cloud" class="nai-gallery-page">
            </div>
    </div>
    
  
    
<div id="nai-gallery-action-bar">
    <label class="select-all-label" style="display: flex; align-items: center; gap: 5px;">
        <input type="checkbox" id="select-all-nai-gallery-checkbox"> ÂÖ®ÈÄâ
    </label>
    <button id="export-selected-nai-gallery-btn" class="action-bar-btn" style="background-color: #17a2b8; display: none; font-size: 14px; padding: 10px 15px;">ÂØºÂá∫ (0)</button>
    <button id="download-selected-nai-gallery-btn" class="action-bar-btn" style="background-color: #007bff; font-size: 14px; padding: 10px 15px;">‰∏ãËΩΩ (0)</button>
   <button id="upload-selected-nai-gallery-btn" class="action-bar-btn" style="background-color: #4cd964; display: none; font-size: 14px; padding: 10px 15px;">‰∏ä‰º† (0)</button>
    <button id="delete-selected-nai-gallery-btn" class="action-bar-btn" style="font-size: 14px; padding: 10px 15px;">Âà†Èô§ (0)</button>
</div>
</div>
      <div id="sticker-panel">
        <div id="sticker-panel-header"> <span class="panel-btn" id="close-sticker-panel-btn"data-lang-key="cancel">ÂèñÊ∂à</span> <span class="title">ÊàëÁöÑË°®ÊÉÖ</span>
          <div style="display: flex; gap: 10px;"> <span class="panel-btn" id="manage-sticker-categories-btn">ÂàÜÁ±ª</span> <span class="panel-btn" id="manage-stickers-btn">ÁÆ°ÁêÜ</span> <span class="panel-btn" id="add-sticker-batch-btn">ÊâπÈáè</span> <span class="panel-btn" id="upload-sticker-btn">‰∏ä‰º†</span> </div>
        </div>
        <div id="sticker-category-tabs"></div>
        <div id="sticker-search-container"> <input type="search" id="sticker-search-input" placeholder="ÊêúÁ¥¢Ë°®ÊÉÖÂêçÁß∞..."></div>
        <div id="sticker-grid"></div>
        <div id="sticker-action-bar"> <label class="select-all-label" style="display: flex; align-items: center; gap: 5px;"> <input type="checkbox" id="select-all-stickers-checkbox"> ÂÖ®ÈÄâ </label><button id="move-selected-stickers-btn" style="background-color: #ff9800; margin-left: 5px;">ÁßªÂä® (0)</button> <button id="export-selected-stickers-btn" style="background-color: #007bff;">ÂØºÂá∫ (0)</button><button id="delete-selected-stickers-btn">Âà†Èô§ (0)</button> </div>
      </div> <input type="file" id="sticker-upload-input" accept="image/*" style="display: none;"> <input type="file" id="image-upload-input" accept="image/*" style="display: none;"> <input type="file" id="camera-capture-input" accept="image/*" capture="environment" style="display: none;">
      <div id="music-player-overlay">
        <div class="music-player-window">
          <div class="music-player-top-actions">
            <div class="top-left-cluster"> <button id="music-return-btn">‚Äπ</button> <button id="music-exit-btn">√ó</button> </div>
            <div style="display: flex; align-items: center; gap: 15px;"> <button id="toggle-fullscreen-btn" title="ÂàáÊç¢ÂÖ®Â±è"> <svg class="icon-maximize" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3" />
                </svg> <svg class="icon-minimize" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3" />
                </svg> </button> <span id="music-playlist-btn">‚ò∞</span> </div>
          </div>
          <div id="music-player-avatar-display"> </div>
          <div id="music-info-top">
            <div style="display: flex; justify-content: center; align-items: center; gap: 10px;">
              <div id="music-time-counter">Â∑≤Áªè‰∏ÄËµ∑Âê¨‰∫Ü0.0Â∞èÊó∂</div> <button id="show-avatars-btn" title="ÊòæÁ§∫/ÈöêËóèÂ§¥ÂÉè"> <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="4"></circle>
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg> </button>
            </div>
            <div id="music-player-song-title">ËØ∑Ê∑ªÂä†Ê≠åÊõ≤</div>
            <div id="music-player-artist">...</div>
          </div>
          <div id="music-visual-container">
            <div id="vinyl-view"> <img id="music-player-cover" src="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1757748720126_qdqqd_1jt5sv.jpeg" alt="Album Art"> </div>
            <div id="inline-lyrics-view">
              <div id="music-lyrics-container">
                <div id="music-lyrics-list"> </div>
              </div>
            </div>
          </div>
          <div id="single-lyric-display">‚ô™ ‚ô™ ‚ô™</div>
          <div class="music-player-controls-wrapper">
            <div class="music-progress-bar-container">
              <div id="music-current-time" class="time-display">0:00</div>
              <div class="progress-bar">
                <div id="music-progress-fill" class="progress-bar-fill"></div>
              </div>
              <div id="music-total-time" class="time-display">0:00</div>
            </div>
            <div class="music-controls"> <button id="music-prev-btn">‚óÄ</button> <button id="music-play-pause-btn" class="play-pause-btn">‚ñ∂</button> <button id="music-next-btn">‚ñ∂</button> <button id="music-mode-btn">È°∫Â∫è</button> <button id="toggle-blur-btn" title="ÂàáÊç¢ËÉåÊôØÊ∏ÖÊô∞Â∫¶">Ê∏Ö</button>
            </div>
          </div>
        </div>
      </div>
      <div id="music-playlist-panel">
        <div class="playlist-header">
          <div class="header-left-actions" style="display: flex; align-items: center; gap: 10px;">
            <span class="panel-btn" id="close-playlist-btn" data-lang-key="back">ËøîÂõû</span>
            <span class="panel-btn" id="manage-playlist-btn" data-lang-key="manage">ÁÆ°ÁêÜ</span>
          </div>
          
          <span data-lang-key="playlistTitle">Êí≠ÊîæÂàóË°®</span>
          
          <div>
            <span class="panel-btn" id="cleanup-songs-btn">Ê∏ÖÁêÜ</span> 
            <span class="panel-btn" id="add-song-local-btn">Êú¨Âú∞</span> 
            <span class="panel-btn" id="add-song-url-btn">URL</span> 
            <span class="panel-btn" id="add-song-search-btn" data-lang-key="search">ÊêúÁ¥¢</span>
          </div>
        </div>
        <div class="playlist-body" id="playlist-body"></div>
       <div id="playlist-action-bar">
        <label class="select-all-label" style="display: flex; align-items: center; gap: 5px;">
            <input type="checkbox" id="select-all-playlist-checkbox"> ÂÖ®ÈÄâ
        </label>
        <button id="delete-selected-songs-btn" class="action-bar-btn" style="background-color: #ff3b30;">Âà†Èô§ (0)</button>
        <button id="upload-selected-to-catbox-btn" class="action-bar-btn" style="background-color: #007bff;">‰∏ä‰º†Catbox (0)</button>
      </div>
      </div> <input type="file" id="local-song-upload-input" accept="audio/*" multiple style="display: none;"> <input type="file" id="lrc-upload-input" accept=".lrc" style="display: none;">
    </div>
    <div id="wallpaper-screen" class="screen ios-settings-screen">
      <div class="header"> 
        <span class="back-btn" onclick="showScreen('home-screen')">‚Äπ</span> 
        <span data-lang-key="appearanceTitle">Â§ñËßÇËÆæÁΩÆ</span> 
        <!-- ‰øùÁïôÂéüÊúâ‰øùÂ≠òÊåâÈíÆÈÄªËæë -->
        <span class="save-btn" id="save-wallpaper-btn" data-lang-key="save">ÂÆåÊàê</span> 
      </div>

      <div class="settings-container ios-scroll-container">

        <!-- 1. Â£ÅÁ∫∏‰∏éËÉåÊôØ -->
        <div class="settings-header">Â£ÅÁ∫∏‰∏éËÉåÊôØ</div>
        <div class="settings-section">
            <!-- EPhone ‰∏ªÂ±èÂπï -->
            <div class="settings-item">
                <label>‰∏ªÂ±èÂπïÂ£ÅÁ∫∏</label>
                <div class="settings-right">
                    <!-- È¢ÑËßàÂõæ -->
                    <div id="wallpaper-preview" class="wallpaper-thumbnail">È¢ÑËßà</div>
                    <!-- ÊåâÈíÆÁªÑ -->
                    <div class="action-btn-group">
                        <button class="settings-mini-btn" onclick="document.getElementById('wallpaper-upload-input').click()">Êú¨Âú∞</button>
                        <button id="upload-ephone-bg-url-btn" class="settings-mini-btn">URL</button>
                        <button id="remove-ephone-bg-btn" class="settings-mini-btn" style="display:none; color:#ff3b30;">√ó</button>
                    </div>
                    <!-- ÈöêËóèÁöÑÊñá‰ª∂ËæìÂÖ• -->
                    <input type="file" id="wallpaper-upload-input" accept="image/*" class="hidden-input">
                </div>
            </div>

            <!-- CPhone ÊâãÊú∫ -->
            <div class="settings-item">
                <label>CPhone Â£ÅÁ∫∏</label>
                <div class="settings-right">
                    <div id="cphone-wallpaper-preview" class="wallpaper-thumbnail">È¢ÑËßà</div>
                    <div class="action-btn-group">
                        <button class="settings-mini-btn" onclick="document.getElementById('cphone-wallpaper-upload-input').click()">Êú¨Âú∞</button>
                        <button id="upload-cphone-bg-url-btn" class="settings-mini-btn">URL</button>
                        <button id="remove-cphone-bg-btn" class="settings-mini-btn" style="display:none; color:#ff3b30;">√ó</button>
                    </div>
                    <input type="file" id="cphone-wallpaper-upload-input" accept="image/*" class="hidden-input">
                </div>
            </div>

            <!-- ÂÖ®Â±ÄËÅäÂ§©ËÉåÊôØ -->
            <div class="settings-item">
                <label>ËÅäÂ§©ËÉåÊôØ (ÂÖ®Â±Ä)</label>
                <div class="settings-right">
                    <div id="global-bg-preview" class="wallpaper-thumbnail">È¢ÑËßà</div>
                    <div class="action-btn-group">
                        <button class="settings-mini-btn" onclick="document.getElementById('global-bg-input').click()">Êú¨Âú∞</button>
                        <button id="upload-global-bg-url-btn" class="settings-mini-btn">URL</button>
                        <button id="remove-global-bg-btn" class="settings-mini-btn" style="display:none; color:#ff3b30;">√ó</button>
                    </div>
                    <input type="file" id="global-bg-input" accept="image/*" class="hidden-input">
                </div>
            </div>
        </div>

        <!-- Êó∂Èó¥Êà≥ÊòæÁ§∫Ê†ºÂºè -->
        <div class="settings-header">Êó∂Èó¥Êà≥ÊòæÁ§∫</div>
        <div class="settings-section">
            <div class="settings-item">
                <div>
                    <div style="font-weight: 500;">ÊòæÁ§∫ÁßíÊï∞</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">ÂºÄÂêØÂêéÔºåÊ∂àÊÅØÊó∂Èó¥Êà≥Â∞ÜÊòæÁ§∫‰∏∫"Êó∂:ÂàÜ:Áßí"Ê†ºÂºè</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="global-show-seconds-switch">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <!-- 2. ÊòæÁ§∫‰∏é‰∫§‰∫í -->
        <div class="settings-header">ÊòæÁ§∫‰∏é‰∫§‰∫í</div>
        <div class="settings-section">
            <div class="settings-item">
                <label>Â§úÈó¥Ê®°Âºè</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="theme-toggle-switch">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-item">
                <label>È°∂ÈÉ®Áä∂ÊÄÅÊ†è</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="status-bar-toggle-switch">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-item">
                <div>
                    <label>ÊâãÊú∫Â§ñÊ°Ü</label>
                    <div class="settings-desc">Ê≤âÊµ∏Âºè‰ªøÁúüËæπÊ°Ü</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="phone-frame-toggle-switch">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-item">
                <div>
                    <label>ÂàÜÁ¶ªÁä∂ÊÄÅÊ†è</label>
                    <div class="settings-desc">‰∏çË¶ÜÁõñÈ°∂ÈÉ®Âå∫Âüü (ÂàòÊµ∑Â±èÈÄÇÈÖç)</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="detach-status-bar-switch">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-item">
                <div>
                    <label>Èü≥‰πêÁÅµÂä®Â≤õ</label>
                    <div class="settings-desc">Âê¨Ê≠åÊó∂ÂßãÁªàÊòæÁ§∫ÁÅµÂä®Â≤õUI</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="dynamic-island-music-toggle-switch">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-item">
                <div>
                    <label>ÁÆÄÊ¥ÅËÅäÂ§©ÁïåÈù¢</label>
                    <div class="settings-desc">ÈªòËÆ§ÊäòÂè†ËÅäÂ§©Â∑•ÂÖ∑Ê†è</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="minimal-chat-ui-switch">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <!-- 3. ÈîÅÂ±èËÆæÁΩÆ -->
        <div class="settings-header">ÈîÅÂ±èÂÆâÂÖ®</div>
        <div class="settings-section">
            <div class="settings-item">
                <label>ÂêØÁî®ÈîÅÂ±èÂØÜÁ†Å</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="lock-screen-toggle">
                    <span class="slider"></span>
                </label>
            </div>
            
            <!-- ÈîÅÂ±èËØ¶ÊÉÖ (JSÊéßÂà∂ÊòæÁ§∫ÈöêËóè) -->
            <div id="lock-screen-settings-detail" style="display: none; background-color: #f9f9f9; border-top: 0.5px solid #ebedf0;">
                <div class="settings-item">
                    <label>4‰ΩçÊï∞Â≠óÂØÜÁ†Å</label>
                    <div class="settings-right">
                        <input type="tel" id="lock-screen-password-input" maxlength="4" placeholder="1234" class="settings-num-input" style="width: 80px !important; letter-spacing: 2px;">
                    </div>
                </div>
                <div class="settings-item">
                    <label>ÈîÅÂ±èÂ£ÅÁ∫∏</label>
                    <div class="settings-right">
                         <div id="lock-wallpaper-preview" class="wallpaper-thumbnail" style="margin-right: 10px;">Êó†</div>
                         <div class="action-btn-group">
                             <button class="settings-mini-btn" onclick="document.getElementById('lock-wallpaper-input').click()">Êú¨Âú∞</button>
                             <button id="upload-lock-wallpaper-url-btn" class="settings-mini-btn">URL</button>
                         </div>
                         <input type="file" id="lock-wallpaper-input" accept="image/*" class="hidden-input">
                    </div>
                </div>
            </div>
        </div>

        <!-- 4. ÊèêÁ§∫Èü≥ -->
        <div class="settings-header">Â£∞Èü≥</div>
        <div class="settings-section">
            <div class="settings-item-block">
                <label style="display:block; margin-bottom:8px;">Ê∂àÊÅØÊèêÁ§∫Èü≥ URL</label>
                <div style="display: flex; gap: 8px;">
                    <input type="text" id="notification-sound-url-input" placeholder="ÁïôÁ©∫‰ΩøÁî®ÈªòËÆ§" class="settings-textarea" style="flex-grow:1; min-height:36px; padding:8px;">
                    <button id="test-sound-btn" class="settings-mini-btn" style="width:auto;">‚ñ∂</button>
                    <button id="reset-sound-btn" class="settings-mini-btn" style="width:auto;">ÈáçÁΩÆ</button>
                </div>
            </div>
        </div>

        <!-- 5. ÂõæÊ†áÂÆöÂà∂ -->
        <div class="settings-header">ÂõæÊ†áÂÆöÂà∂</div>
        <div class="settings-section">
            <div class="settings-item-block">
                <label style="margin-bottom: 10px; display:block; font-weight:600;">EPhone ‰∏ªÂ±èÂπïÂõæÊ†á</label>
                <div id="icon-settings-grid" class="settings-icon-grid">
                    <!-- JS Â°´ÂÖÖ -->
                </div>
            </div>
            <div class="settings-item-block" style="border-top: 0.5px solid #c6c6c8;">
                <label style="margin-bottom: 10px; display:block; font-weight:600;">CPhone Â∫îÁî®ÂõæÊ†á</label>
                <div id="cphone-icon-settings-grid" class="settings-icon-grid">
                    <!-- JS Â°´ÂÖÖ -->
                </div>
            </div>
            <div class="settings-item-block" style="border-top: 0.5px solid #c6c6c8;">
                <label style="margin-bottom: 10px; display:block; font-weight:600;">MYphone Â∫îÁî®ÂõæÊ†á</label>
                <div id="myphone-icon-settings-grid" class="settings-icon-grid">
                    <!-- JS Â°´ÂÖÖ -->
                </div>
            </div>
        </div>

        <!-- 6. Â∑•ÂÖ∑Ê†èÊéíÂ∫è -->
        <div class="settings-header">ËÅäÂ§©Â∑•ÂÖ∑Ê†è</div>
        <div class="settings-section">
            <div class="settings-item-block">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <label>ÊåâÈíÆÊéíÂ∫è</label>
                    <button id="reset-button-order-btn" class="settings-mini-btn">ÊÅ¢Â§çÈªòËÆ§</button>
                </div>
                <div class="settings-desc" style="margin: 0 0 10px 0;">ÊãñÂä®‰∏ãÊñπÊåâÈíÆË∞ÉÊï¥È°∫Â∫èÔºö</div>
                <div id="button-order-editor">
                    <!-- JS Â°´ÂÖÖ -->
                </div>
            </div>
        </div>

        <!-- 7. È¢ÑËÆæÁÆ°ÁêÜ (È´òÁ∫ß) -->
        <div class="settings-header">È¢ÑËÆæ‰∏éÈ´òÁ∫ß</div>
        <div class="settings-section">
            <!-- Â§ñËßÇÈ¢ÑËÆæ -->
            <div class="settings-item">
                 <label>Â§ñËßÇÈ¢ÑËÆæ</label>
                 <div class="settings-right">
                     <select id="appearance-preset-select" class="settings-select" style="width:auto; flex-grow:1; margin-right:5px;"></select>
                     <!-- ‰øÆÊîπÁÇπÔºöÊîπ‰∏∫ settings-mini-btn -->
                     <button id="save-appearance-preset-btn" class="settings-mini-btn">‰øùÂ≠ò</button>
                     <button id="delete-appearance-preset-btn" class="settings-mini-btn" style="color: #ff3b30;">Âà†Èô§</button>
                 </div>
            </div>
            <!-- CSS È¢ÑËÆæ -->
            <div class="settings-item">
                 <label>CSS È¢ÑËÆæ</label>
                 <div class="settings-right">
                     <select id="css-preset-select" class="settings-select" style="width:auto; flex-grow:1; margin-right:5px;"></select>
                     <!-- ‰øÆÊîπÁÇπÔºöÊîπ‰∏∫ settings-mini-btn -->
                     <button id="save-css-preset-btn" class="settings-mini-btn">‰øùÂ≠ò</button>
                     <button id="delete-css-preset-btn" class="settings-mini-btn" style="color: #ff3b30;">Âà†Èô§</button>
                 </div>
            </div>
            
            <!-- Ëá™ÂÆö‰πâ CSS -->
            <div class="settings-item-block">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                    <label>ÂÖ®Â±ÄËá™ÂÆö‰πâ CSS</label>
                    <!-- ‰øÆÊîπÁÇπÔºöÊîπ‰∏∫ settings-mini-btn -->
                    <button id="reset-global-css-btn" class="settings-mini-btn">ÈáçÁΩÆ</button>
                </div>
                <textarea id="global-css-input" class="settings-textarea" placeholder="/*Âú®Ê≠§ËæìÂÖ•CSS*/"></textarea>
            </div>
            
            <!-- ÂØºÂÖ• -->
            <button class="settings-full-btn" id="export-appearance-btn">ÂØºÂá∫Â§ñËßÇÈÖçÁΩÆ (JSON)</button>

            <button class="settings-full-btn" id="import-appearance-btn">ÂØºÂÖ•Â§ñËßÇÈÖçÁΩÆ (JSON/Word/Txt)</button>
            <input type="file" id="import-appearance-input" accept=".json,.txt,.docx" class="hidden-input">
        </div>

        <div style="height: 40px;"></div>
      </div>
    </div>
    <div id="browser-screen" class="screen">
      <div class="header"> <span class="back-btn" id="browser-back-btn">‚Äπ</span> <span id="browser-title"></span> <span style="width: 30px;"></span> </div>
      <div id="browser-content" class="list-container"> </div>
    </div>
    <div id="font-settings-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">‚Äπ</span> <span data-lang-key="fontSettingsTitle">Â≠ó‰ΩìËÆæÁΩÆ</span> <span style="width: 30px;"></span> </div>
      <div class="form-container">
        <h3 style="margin-top:0; border-bottom: 1px solid #eee; padding-bottom: 10px;"data-lang-key="fontPresetManagement">Â≠ó‰ΩìÈ¢ÑËÆæÁÆ°ÁêÜ</h3>
        <div class="form-group"> <label for="font-preset-select"data-lang-key="apiPresetSelectLabel">ÈÄâÊã©ÊàñÂàáÊç¢È¢ÑËÆæ</label>
          <div style="display: flex; gap: 10px; align-items: center;"> <select id="font-preset-select" style="flex-grow: 1;"></select> <button id="save-font-preset-btn" class="form-button-secondary" style="margin-top: 0; padding: 12px;"data-lang-key="save">‰øùÂ≠ò</button> <button id="delete-font-preset-btn"
              class="form-button-secondary" style="margin-top: 0; padding: 12px; background-color: #ffebee; color: #d32f2f; border-color: #ffcdd2;"data-lang-key="delete">Âà†Èô§</button> </div>
        </div>
        <hr style="margin: 30px 0; opacity: 0.3;">
        <div class="form-group"> <label for="font-url-input"data-lang-key="fontFileUrlLabel">Â≠ó‰ΩìÊñá‰ª∂URL (.ttf, .otf, .woffÁ≠â)</label> <input type="text" id="font-url-input" placeholder="https://..../font.ttf"> </div>
        <div class="form-group"> <label data-lang-key="fontPreviewLabel">ÂÆûÊó∂È¢ÑËßà</label>
          <div id="font-preview">
            <p style="font-size: 20px; margin: 0 0 10px 0;">‰Ω†Â•Ω‰∏ñÁïå Hello World</p>
            <p style="margin: 0;">ËøôÊòØÂ≠ó‰ΩìÈ¢ÑËßàÊïàÊûúÔºå12345„ÄÇ</p>
          </div>
        </div> <button class="form-button" id="save-font-btn"data-lang-key="fontSaveAndApply">‰øùÂ≠òÂπ∂Â∫îÁî®</button> <button class="form-button form-button-secondary" id="reset-font-btn"data-lang-key="fontResetDefault">ÊÅ¢Â§çÈªòËÆ§Â≠ó‰Ωì</button>
      </div>
    </div>
    <div id="contact-picker-screen" class="screen">
      <div class="header"> <span class="back-btn" id="cancel-contact-picker-btn"data-lang-key="cancel">ÂèñÊ∂à</span> <span>ÈÄâÊã©ËÅîÁ≥ª‰∫∫</span> <span class="save-btn" id="confirm-contact-picker-btn"data-lang-key="done">ÂÆåÊàê(0)</span> </div>
      <div class="list-container" id="contact-picker-list"> </div>
    </div>
    <div id="member-management-screen" class="screen">
      <div class="header"> <span class="back-btn" id="back-from-member-management">‚Äπ</span> <span>Áæ§ÊàêÂëòÁÆ°ÁêÜ</span> <span style="width: 30px;"></span> </div>
      <div class="list-container" id="member-management-list"> </div>
      <div id="member-management-actions"> <button id="add-existing-contact-btn">‰ªéÂ•ΩÂèãÂàóË°®Ê∑ªÂä†</button> <button id="create-new-member-btn">ÂàõÂª∫Áæ§ÂÜÖÊñ∞ÊàêÂëò</button> </div>
    </div>
    <div id="sticker-category-manager-modal" class="modal">
      <div class="modal-content" style="height: 60%;">
        <div class="modal-header"> <span>ÁÆ°ÁêÜË°®ÊÉÖÂàÜÁ±ª</span> </div>
        <div class="modal-body">
          <div class="form-group"> <label>Êñ∞Âª∫ÂàÜÁ±ª</label>
            <div style="display: flex; gap: 10px;"> <input type="text" id="new-sticker-category-name-input" placeholder="ËæìÂÖ•ÂàÜÁ±ªÂêç..." style="flex-grow: 1;"> <button id="add-new-sticker-category-btn" class="form-button" style="width: auto; margin-top: 0; padding: 0 15px;"data-lang-key="add">Ê∑ªÂä†</button> </div>
          </div>
          <hr style="opacity: 0.2;">
          <div id="existing-sticker-categories-list" style="display: flex; flex-direction: column; gap: 10px;"> </div>
        </div>
        <div class="modal-footer"> <button class="save" id="close-sticker-category-manager-btn" style="width: 100%;"data-lang-key="done">ÂÆåÊàê</button> </div>
      </div>
    </div>
    <div id="incoming-call-modal" class="modal">
      <div class="incoming-call-content"> <img id="caller-avatar" class="caller-avatar" src="">
        <div id="caller-name" class="caller-name"></div>
        <div class="caller-text">ÈÇÄËØ∑‰Ω†ËßÜÈ¢ëÈÄöËØù</div>
        <div class="incoming-call-actions">
          <div class="action-button-wrapper"> <button id="decline-call-btn" class="call-action-btn decline"></button> <span>ÊãíÁªù</span> </div>
          <div class="action-button-wrapper"> <button id="accept-call-btn" class="call-action-btn accept"></button> <span>Êé•Âê¨</span> </div>
        </div>
      </div>
    </div>
    <div id="video-call-screen" class="screen">
     
<div class="video-call-top-bar">
    <button id="minimize-call-btn" title="ÊúÄÂ∞èÂåñ">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round">
            <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
    </button>
    <span id="call-timer">00:00</span> 
</div>

      <!-- ËßÜÈ¢ëÁîªÈù¢ÊòæÁ§∫Âå∫ (‰ºòÂåñÊ®°Âºè) -->
      <div id="video-display-area" style="display: none;">
        <!-- Â§ßÂ±èÔºöÂØπÊñπÁîªÈù¢ -->
        <div id="remote-video-large" class="video-large-screen">
          <img id="remote-video-img" src="" alt="ÂØπÊñπËßÜÈ¢ë">
        </div>
        <!-- Â∞èÂ±èÔºöÊàëÊñπÁîªÈù¢ -->
        <div id="local-video-small" class="video-small-screen">
          <img id="local-video-img" src="" alt="ÊàëÁöÑËßÜÈ¢ë" style="display: block;">
          <video id="local-camera-video" autoplay playsinline muted style="display: none; width: 100%; height: 100%; object-fit: cover;"></video>
        </div>
      </div>

      <div class="video-call-avatar-area">
        <div id="participant-avatars-grid"> </div>
      </div>
      <div id="video-call-main" class="video-call-main"> </div>
      <div class="video-call-controls"> <button id="user-speak-btn" class="control-btn speak-btn"></button> <button id="hang-up-btn" class="control-btn hangup-btn"></button> <button id="regenerate-call-btn" class="control-btn regenerate-btn"></button> <button id="join-call-btn"
          class="control-btn join-btn" style="display: none;"></button> </div>
    </div>
    <div id="outgoing-call-screen" class="screen">
      <div class="outgoing-call-content"> <img id="outgoing-call-avatar" class="caller-avatar" src="">
        <div id="outgoing-call-name" class="caller-name"></div>
        <div class="caller-text">Ê≠£Âú®ÂëºÂè´...</div>
        <div class="outgoing-call-actions"> <button id="cancel-call-btn" class="call-action-btn decline"></button> <span data-lang-key="cancel">ÂèñÊ∂à</span> </div>
      </div>
    </div>
    <div id="call-history-screen" class="screen">
      <div class="header"> <span class="back-btn" id="call-history-back-btn">‚Äπ</span> <span id="call-history-title">ÈÄöËØùËÆ∞ÂΩï</span> <span style="width: 30px;"></span> </div>
      <div id="call-history-list" class="list-container" style="padding: 15px; display: flex; flex-direction: column; gap: 15px;"> </div>
    </div>
    <div id="douban-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">‚Äπ</span> <span>Ë±ÜÁì£Â∞èÁªÑ</span>
        <div class="header-actions"> <span class="action-btn" id="douban-settings-btn" title="Ë±ÜÁì£ËÆæÁΩÆ"> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path
                d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.44,0.17-0.48,0.41L9.12,4.84c-0.59,0.24-1.12,0.56-1.62,0.94L5.11,4.82c-0.22-0.08-0.47,0-0.59,0.22l-1.92,3.32 c-0.12,0.22-0.07,0.47,0.12,0.61l2.03,1.58C4.84,11.36,4.82,11.68,4.82,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.48,2.03 c0.04,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.48-0.41l0.48-2.03c0.59-0.24,1.12-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z">
              </path>
            </svg> </span> <span class="action-btn" id="douban-cast-select-btn" title="ÈÄâÊã©ÂèÇ‰∏éËßíËâ≤"> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg> </span> <span class="action-btn" id="regenerate-douban-btn" title="ÈáçÊñ∞ÁîüÊàêÂÜÖÂÆπ"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
              <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
            </svg> </span> </div>
      </div>
      <div id="douban-posts-list" class="list-container"> </div>
    </div>
    <div id="douban-post-detail-screen" class="screen">
      <div class="header"> <span class="back-btn" id="douban-detail-back-btn">‚Äπ</span> <span id="douban-post-detail-title">Â∏ñÂ≠êËØ¶ÊÉÖ</span> <span style="width: 30px;"></span> </div>
      <div id="douban-detail-content-wrapper" class="list-container">
        <div id="douban-post-detail-body">
          <div class="douban-post-header"> <img id="douban-detail-avatar" class="douban-post-avatar">
            <div class="douban-author-info">
              <div id="douban-detail-author" class="douban-author-name"></div>
              <div id="douban-detail-group" class="douban-group-name"></div>
            </div>
          </div>
          <h2 id="douban-detail-post-title" class="douban-post-title"></h2>
          <div id="douban-detail-content" class="douban-detail-content"></div>
        </div>
        <div class="douban-comments-section">
          <h4>ÂõûÂ∫î</h4>
          <div id="douban-detail-comments-list"></div>
        </div>
      </div>
      <div id="douban-comment-footer" class="post-footer">
        <div class="comment-section"> <img id="douban-my-comment-avatar" src="" class="comment-avatar"> <input type="text" id="douban-comment-input" class="comment-input" placeholder="ÂÜôÂõûÂ∫î..."> </div> <button id="douban-wait-reply-btn" class="douban-feather-btn" title="ËÆ©AIÁªßÁª≠ËÆ®ËÆ∫"> <svg
            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"></path>
            <line x1="16" y1="8" x2="2" y2="22"></line>
            <line x1="17.5" y1="15" x2="9" y2="15"></line>
          </svg> </button> <button id="douban-send-comment-btn" class="comment-send-btn">ÂèëÈÄÅ</button>
      </div>
    </div>
    <div id="werewolf-game-screen" class="screen">
      <div class="header"> <span id="werewolf-game-title">Áãº‰∫∫ÊùÄ</span>
        <div class="header-actions"><span class="action-btn" id="werewolf-retry-btn" title="ÈáçËØï‰∏ä‰∏ÄÊ≠•AIÊìç‰Ωú" style="display: none;"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
              <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
            </svg></span> <span class="action-btn" id="exit-werewolf-game-btn">ÈÄÄÂá∫</span> </div>
      </div>
      <div id="werewolf-player-grid"></div>
      <div id="werewolf-log" class="list-container"></div>
      <div id="werewolf-action-bar">
        <div id="chat-input-main-row" style="width: 100%;"> <textarea id="werewolf-user-input" rows="1" placeholder="ËΩÆÂà∞‰Ω†ÂèëË®Ä‰∫Ü..."></textarea>
          <div id="input-actions-wrapper" style="gap: 5px;"> <button id="werewolf-wait-reply-btn" class="action-button" style="display: none; background-color: #007bff; height: 40px; padding: 0 10px; font-size: 13px;">Á≠âÂæÖÂõûÂ∫î</button> <button id="werewolf-finish-speech-btn" class="action-button"
              style="display: none; background-color: var(--accent-color); height: 40px; padding: 0 10px; font-size: 13px;">ÁªìÊùüÂèëË®Ä</button> <button id="werewolf-next-step-btn" class="form-button" style="margin-top:0; display: none;">‰∏ã‰∏ÄÊ≠•</button> </div>
        </div>
      </div>
    </div>
    <div id="long-term-memory-screen" class="screen">
      <div class="header"> <span class="back-btn" id="memory-screen-back-btn">‚Äπ</span> <span data-lang-key="chatHeaderLongTermMemory">ÈïøÊúüËÆ∞ÂøÜ</span>
        <div class="header-actions"> 
            <!-- Á≤æÁÇºÊåâÈíÆ (ÊõøÊç¢‰∏∫ ÊºèÊñó/ËøáÊª§ ÂõæÊ†á) -->
            <span class="action-btn" id="refine-memory-btn-header" title="Á≤æÁÇº (Êï¥ÂêàÊóßËÆ∞ÂøÜ)"> 
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                </svg>
            </span> 
            
            <!-- ÊÄªÁªìÊåâÈíÆ (ÊõøÊç¢‰∏∫ ÊñáÊ°£/ÂàóË°® ÂõæÊ†á) -->
            <span class="action-btn" id="summarize-recent-btn-header" title="ÊÄªÁªì (ÊúÄËøëÂØπËØù)"> 
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10 9 9 9 8 9"></polyline>
                </svg>
            </span> 
            
            <!-- Ê∑ªÂä†ÊåâÈíÆ (Áªü‰∏ÄÊõøÊç¢‰∏∫ SVG Âä†Âè∑) -->
            <span class="action-btn" id="add-manual-memory-btn-header" title="ÊâãÂä®Ê∑ªÂä†">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
            </span> 
        </div>
      </div>
      <div class="list-container" id="memory-list-container" style="padding: 15px; display: flex; flex-direction: column; gap: 15px; background-color: #f0f2f5;"> </div>
    </div>
    
    <div id="chat-settings-screen" class="screen">
      <div class="header"> 
          <span class="back-btn" onclick="showScreen('chat-interface-screen')">‚Äπ</span> 
          <span>ËÅäÂ§©ËØ¶ÊÉÖ</span> 
          <span class="save-btn" id="save-chat-settings-btn" data-lang-key="save">ÂÆåÊàê</span> 
      </div>
      
      <div class="settings-container">
        
        <!-- Á¨¨‰∏ÄÁªÑÔºöÂü∫Á°Ä‰ø°ÊÅØ -->
        <div class="settings-section">
            <div class="settings-item" id="chat-name-group">
                <label>Â§áÊ≥®Âêç / Áæ§Âêç</label>
                <div class="settings-right">
                    <input type="text" id="chat-name-input" placeholder="Êú™ËÆæÁΩÆ">
                </div>
            </div>
            
            <div class="settings-item" id="ai-original-name-group">
                <label>ÂØπÊñπÊú¨Âêç (AIËØÜÂà´Áî®)</label>
                <div class="settings-right">
                    <input type="text" id="ai-original-name-input" placeholder="ÂøÖÂ°´">
                </div>
            </div>

            <div class="settings-item" id="my-nickname-group">
                <label>ÊàëÁöÑÊòµÁß∞</label>
                <div class="settings-right">
                    <input type="text" id="my-nickname-input" placeholder="Êàë">
                </div>
            </div>

            <div class="settings-item" id="character-country-group">
                <label>ËßíËâ≤ÂõΩÁ±ç (ÂΩ±ÂìçËΩ¨Ë¥¶Ë¥ßÂ∏Å)</label>
                <div class="settings-right">
                    <select id="character-country-select" class="settings-select">
                        <option value="China">‰∏≠ÂõΩ (¬• ‰∫∫Ê∞ëÂ∏Å)</option>
                        <option value="USA">ÁæéÂõΩ ($ ÁæéÂÖÉ)</option>
                        <option value="Japan">Êó•Êú¨ (¬• Êó•ÂÖÉ)</option>
                        <option value="UK">Ëã±ÂõΩ (¬£ Ëã±Èïë)</option>
                        <option value="Europe">Ê¨ßÊ¥≤ (‚Ç¨ Ê¨ßÂÖÉ)</option>
                        <option value="Austria">Â••Âú∞Âà© (‚Ç¨ Ê¨ßÂÖÉ)</option>
                        <option value="Korea">Èü©ÂõΩ (‚Ç© Èü©ÂÖÉ)</option>
                        <option value="Russia">‰øÑÁΩóÊñØ (‚ÇΩ Âç¢Â∏É)</option>
                        <option value="India">Âç∞Â∫¶ (‚Çπ Âç¢ÊØî)</option>
                        <option value="Canada">Âä†ÊãøÂ§ß (C$ Âä†ÂÖÉ)</option>
                        <option value="Australia">Êæ≥Â§ßÂà©‰∫ö (A$ Êæ≥ÂÖÉ)</option>
                        <option value="Singapore">Êñ∞Âä†Âù° (S$ Êñ∞Âä†Âù°ÂÖÉ)</option>
                        <option value="Thailand">Ê≥∞ÂõΩ (‡∏ø Ê≥∞Èì¢)</option>
                        <option value="Vietnam">Ë∂äÂçó (‚Ç´ Ë∂äÂçóÁõæ)</option>
                        <option value="None">Êó†ÂõΩÁ±ç (¬• ‰∫∫Ê∞ëÂ∏Å)</option>
                    </select>
                </div>
            </div>

            <div class="settings-item" id="my-group-nickname-group">
                <label>ÊàëÁöÑÁæ§ÊòµÁß∞</label>
                <div class="settings-right">
                    <input type="text" id="my-group-nickname-input">
                </div>
            </div>
            
            <!-- Â§¥ÂÉèÁõ∏ÂÖ≥ -->
            <div class="settings-item" id="ai-avatar-group">
                 <label>ÂØπÊñπÂ§¥ÂÉè</label>
                 <div class="settings-right full-width">
                    <div class="avatar-action-wrapper">
                         <!-- Â§¥ÂÉèÂú®Â∑¶ -->
                         <img id="ai-avatar-preview" class="settings-avatar">
                         <!-- ÊåâÈíÆÁªÑÂú®Âè≥ -->
                         <div class="avatar-btn-group">
                             <button class="settings-mini-btn" onclick="document.getElementById('ai-avatar-input').click()">Êõ¥Êç¢</button>
                             <button class="settings-mini-btn" id="manage-ai-avatar-library-btn">ÂõæÂ∫ì</button>
                             <button class="settings-mini-btn change-frame-btn" data-type="ai">ÊåÇ‰ª∂</button>
                             <input type="file" id="ai-avatar-input" accept="image/*" hidden>
                         </div>
                    </div>
                 </div>
            </div>

            <div class="settings-item" id="group-avatar-group">
                 <label>Áæ§Â§¥ÂÉè</label>
                 <div class="settings-right full-width">
                    <div class="avatar-action-wrapper">
                         <img id="group-avatar-preview" class="settings-avatar">
                         <div class="avatar-btn-group">
                             <button class="settings-mini-btn" onclick="document.getElementById('group-avatar-input').click()">Êõ¥Êç¢</button>
                             <button class="settings-mini-btn" id="manage-group-avatar-library-btn">ÂõæÂ∫ì</button>
                             <input type="file" id="group-avatar-input" accept="image/*" hidden>
                         </div>
                    </div>
                 </div>
            </div>

            <div class="settings-item" id="my-avatar-group">
                 <label>ÊàëÁöÑÂ§¥ÂÉè</label>
                 <div class="settings-right full-width">
                    <div class="avatar-action-wrapper">
                         <img id="my-avatar-preview" class="settings-avatar">
                         <div class="avatar-btn-group">
                             <button class="settings-mini-btn" onclick="document.getElementById('my-avatar-input').click()">Êõ¥Êç¢</button>
                             <button class="settings-mini-btn" id="manage-my-avatar-library-btn">ÂõæÂ∫ì</button>
                             <button class="settings-mini-btn change-frame-btn" data-type="my">ÊåÇ‰ª∂</button>
                             <button class="settings-mini-btn" id="open-persona-library-btn">È¢ÑËÆæ</button>
                             <input type="file" id="my-avatar-input" accept="image/*" hidden>
                         </div>
                    </div>
                 </div>
            </div>
            
            <div class="settings-item" id="assign-group-section" style="display: none;"> 
                <label>Â•ΩÂèãÂàÜÁªÑ</label>
                <div class="settings-right"> 
                    <select id="assign-group-select" class="settings-select"></select> 
                    <button id="manage-groups-btn" class="settings-icon-btn">‚öôÔ∏è</button> 
                </div>
            </div>
        </div>

        <!-- Á¨¨‰∫åÁªÑÔºö‰∫∫ËÆæ‰∏éÂâßÊÉÖ (Ê†∏ÂøÉ) -->
        <div class="settings-section">
            <div class="settings-item-block" id="ai-persona-group">
                <label>ÂØπÊñπ‰∫∫ËÆæ (AI Persona)</label>
                <textarea id="ai-persona" rows="3" class="settings-textarea" placeholder="ËæìÂÖ•ËØ¶ÁªÜÁöÑËßíËâ≤ËÆæÂÆö..."></textarea>
            </div>
            
            <div class="settings-item-block" id="my-persona-group">
                <label>ÊàëÁöÑ‰∫∫ËÆæ (My Persona)</label>
                <textarea id="my-persona" rows="3" class="settings-textarea" placeholder="ËæìÂÖ•‰Ω†ÁöÑËßíËâ≤ËÆæÂÆö..."></textarea>
            </div>
            
            <div class="settings-item-block" id="group-members-group">
                <label>Áæ§ÊàêÂëòÁÆ°ÁêÜ</label>
                <div id="group-members-settings" class="horizontal-scroll-list"></div> 
                <button id="manage-members-btn" class="settings-full-btn">ÁÆ°ÁêÜÊâÄÊúâÁæ§ÊàêÂëò</button>
            </div>
            
            <div class="settings-item" id="switch-greeting-group" style="display: none;">
                 <label>ÂºÄÂú∫ÁôΩ</label>
                 <div class="settings-right">
                     <!-- ÂçáÁ∫ß‰∏∫ÂÆû‰ΩìÊåâÈíÆÊ†∑Âºè -->
                     <button id="switch-greeting-btn" class="settings-mini-btn">ÂàáÊç¢ÂºÄÂú∫ÊïÖ‰∫ã</button>
                 </div>
            </div>
            
            <div class="settings-item-block" id="world-book-link-group"> 
                <label>ÂÖ≥ËÅî‰∏ñÁïå‰π¶</label>
                <div class="custom-multiselect" style="margin-top: 5px; position: relative;">
                    <div class="select-box"> <span class="selected-options-text">-- ÁÇπÂáªÈÄâÊã© --</span> <span class="arrow-down">‚ñº</span> </div>
                    <div id="world-book-checkboxes-container" class="checkboxes-container"> </div>
                </div>
            </div>
        </div>

        <!-- Á¨¨‰∏âÁªÑÔºöÊ®°Âûã‰∏éÊô∫ËÉΩËÆæÁΩÆ -->
        <div class="settings-section">
            <!-- ÂçïËÅäÁã¨Á´ãÂêéÂè∞ -->
            <div id="single-char-background-activity-group">
                
                <!-- Ê≥®ÂÖ•ÊúÄÊñ∞ÂøÉÂ£∞ -->
                <div class="settings-item" id="inject-thought-group" style="display: flex !important; justify-content: space-between !important; align-items: center !important; flex-direction: row !important;">
                    <div style="flex: 1; padding-right: 10px; display: flex; flex-direction: column; align-items: flex-start;">
                        <label style="margin-bottom: 2px;">Ê≥®ÂÖ•ÊúÄÊñ∞ÂøÉÂ£∞</label>
                        <div class="settings-desc">ÂõûÂ§çÂâçÊ≥®ÂÖ•‰∏ä‰∏ÄËΩÆÁöÑÂÜÖÂøÉÁã¨ÁôΩ</div>
                    </div>
                    <label class="toggle-switch" style="margin: 0;"> 
                        <input type="checkbox" id="inject-thought-toggle"> 
                        <span class="slider"></span> 
                    </label>
                </div>
                
                <!-- ÂêØÁî®Áã¨Á´ãÂêéÂè∞Ê¥ªÂä® -->
                <div class="settings-item" style="display: flex !important; justify-content: space-between !important; align-items: center !important; flex-direction: row !important;">
                     <div style="flex: 1; padding-right: 10px; display: flex; flex-direction: column; align-items: flex-start;">
                        <label style="margin-bottom: 2px;">ÂêØÁî®Áã¨Á´ãÂêéÂè∞Ê¥ªÂä®</label>
                        <div class="settings-desc">ÂÖÅËÆ∏ËßíËâ≤Âú®ÂêéÂè∞‰∏ªÂä®ÂèëÊ∂àÊÅØ</div>
                    </div>
                    <label class="toggle-switch" style="margin: 0;"> 
                        <input type="checkbox" id="char-background-activity-switch"> 
                        <span class="slider"></span> 
                    </label>
                </div>

            </div>

            <!-- Áæ§ËÅäÂêéÂè∞ -->
            <div class="settings-item" id="group-background-activity-group">
                 <div>
                    <label>ÂêØÁî®Áæ§ÂÜÖÂêéÂè∞Ê¥ªÂä®</label>
                    <div class="settings-desc">ÂÖÅËÆ∏AIÂú®Áæ§ÂÜÖËá™Áî±‰∫íÂä®</div>
                </div>
                <label class="toggle-switch"> <input type="checkbox" id="group-background-activity-switch"> <span class="slider"></span> </label>
            </div>

            <!-- ÂÜ∑Âç¥Êó∂Èó¥ -->
            <div class="settings-item" id="ai-cooldown-group">
                <label>Áã¨Á´ãË°åÂä®ÂÜ∑Âç¥ (ÂàÜÈíü)</label>
                <div class="settings-right">
                     <input type="number" id="ai-action-cooldown-input" class="settings-num-input">
                </div>
            </div>
            <div class="settings-item" id="group-cooldown-group">
                <label>Áæ§ËÅäË°åÂä®ÂÜ∑Âç¥ (ÂàÜÈíü)</label>
                <div class="settings-right">
                     <input type="number" id="group-action-cooldown-input" class="settings-num-input">
                </div>
            </div>

            <!-- ËÆ∞ÂøÜËÆæÁΩÆ -->
            <div class="settings-item">
                 <label>Áü≠ÊúüËÆ∞ÂøÜÊù°Êï∞</label>
                 <div class="settings-right">
                    <input type="number" id="max-memory" class="settings-num-input">
                 </div>
            </div>
            <div class="settings-item">
                 <label>ÊåÇËΩΩËÆ∞ÂøÜÊù°Êï∞</label>
                 <div class="settings-right">
                    <input type="number" id="linked-memory-count" class="settings-num-input">
                 </div>
            </div>
            
            <div class="settings-item">
                 <div>
                    <label>Ëá™Âä®ÊÄªÁªìÈïøÊúüËÆ∞ÂøÜ</label>
                    <div class="settings-desc">ÂØπËØùËææÂà∞‰∏ÄÂÆöÈïøÂ∫¶Ëá™Âä®ÊèêÁÇº</div>
                </div>
                <label class="toggle-switch"> <input type="checkbox" id="auto-memory-toggle"> <span class="slider"></span> </label>
            </div>
            <div class="settings-item">
                 <label>Ëá™Âä®ÊÄªÁªìÈó¥Èöî (Êù°)</label>
                 <div class="settings-right">
                    <input type="number" id="auto-memory-interval" class="settings-num-input">
                 </div>
            </div>
            
            <!-- ÊâãÂä®ÊÄªÁªìÊåâÈíÆ -->
            <div class="settings-item">
                 <button id="manual-summary-btn" style="width: 100%; padding: 10px; background: var(--accent-color); color: white; border: none; border-radius: 8px; font-size: 14px; cursor: pointer;">
                    ÊâãÂä®ÊÄªÁªì
                 </button>
            </div>

            <!-- ÊåÇËΩΩËÅäÂ§© -->
            <div class="settings-item-block" id="linked-memory-group"> 
                 <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; height: 30px;">
                    <label for="link-memory-toggle" style="line-height: 30px;">ÊåÇËΩΩÂÖ∂‰ªñËÅäÂ§©ËÆ∞ÂøÜ</label> 
                    <!-- ‰øÆÂ§çÔºö‰ΩøÁî®ÁæéÂåñÁöÑ toggle-switch ÁªìÊûÑÊõø‰ª£ÂéüÁîü checkbox -->
                    <label class="toggle-switch"> 
                        <input type="checkbox" id="link-memory-toggle"> 
                        <span class="slider"></span> 
                    </label>
                 </div>
                 <div id="linked-memory-selection" style="display: none; position: relative;"> 
                    <div class="custom-multiselect">
                      <div class="select-box"> <span class="selected-options-text">-- ÈÄâÊã©ËÅäÂ§© --</span> <span class="arrow-down">‚ñº</span> </div>
                      <div id="linked-chats-checkboxes-container" class="checkboxes-container" style="max-height: 150px;"> </div>
                    </div>
                 </div>
            </div>
            <div class="settings-item">
    <div>
       <label>ÊòæÁ§∫ÈöêËóèÂ±ÇÊ∂àÊÅØ (Ë∞ÉËØï)</label>
       <div class="settings-desc">ÊòæÁ§∫Á≥ªÁªüÊèêÁ§∫„ÄÅÂÜÖÂøÉÁã¨ÁôΩÁ≠âÈöêËóèÂÜÖÂÆπ‰ª•‰æøÁºñËæë</div>
   </div>
   <label class="toggle-switch"> 
       <input type="checkbox" id="show-hidden-msg-toggle"> 
       <span class="slider"></span> 
   </label>
</div>

            <!-- ËßíËâ≤Áü•ÊôìÁ™•Â±èÂºÄÂÖ≥ -->
            <div class="settings-item" id="phone-viewing-awareness-group" style="display: none;">
    <div>
       <label>ËßíËâ≤Áü•ÊôìÊâãÊú∫Á™•Â±è</label>
       <div class="settings-desc">ÊâìÂºÄÂêéÔºåÊü•ÁúãËßíËâ≤ÊâãÊú∫ÁöÑË°å‰∏∫‰ºö‰Ωú‰∏∫Á≥ªÁªüÊ∂àÊÅØËÆ∞ÂΩïÂà∞ËÅäÂ§©‰∏≠</div>
   </div>
   <label class="toggle-switch"> 
       <input type="checkbox" id="phone-viewing-awareness-toggle"> 
       <span class="slider"></span> 
   </label>
</div>

            <!-- Token ÁªüËÆ° -->
            <div class="settings-section">
                <div class="settings-item">
                    <label>ÂΩìÂâçÂØπËØùÊù°Êï∞</label>
                    <div class="settings-right">
                        <span id="message-count-value" style="color: #8a8a8a;">ËÆ°ÁÆó‰∏≠...</span>
                    </div>
                </div>
                <div class="settings-item">
                    <label>È¢Ñ‰º∞‰∏ä‰∏ãÊñá Token</label>
                    <div class="settings-right">
                        <span id="token-count-value" style="color: #8a8a8a;">ËÆ°ÁÆó‰∏≠...</span>
                    </div>
                </div>
            </div>
            
            <!-- AIË°å‰∏∫ÊéßÂà∂ (ËßíËâ≤ÂçïÁã¨ËÆæÁΩÆ) -->
            <div class="settings-item" id="ai-behavior-thoughts-item">
                <div>
                    <div style="font-weight: 500;">ÂêØÁî®ÂøÉÂ£∞ÂäüËÉΩ</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">AI‰ºöÂú®ÊØèÊ¨°ÂõûÂ§çÂêéÁîüÊàêÂÜÖÂøÉÁã¨ÁôΩ</div>
                </div>
                <select id="chat-enable-thoughts-select" style="padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background-color: var(--secondary-bg);">
                    <option value="null">‰ΩøÁî®ÂÖ®Â±ÄËÆæÁΩÆ</option>
                    <option value="true">ÂºÄÂêØ</option>
                    <option value="false">ÂÖ≥Èó≠</option>
                </select>
            </div>
            
            <div class="settings-item" id="ai-behavior-qzone-item">
                <div>
                    <div style="font-weight: 500;">ÂêØÁî®Âä®ÊÄÅÂäüËÉΩ</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">AIÂèØ‰ª•‰∏ªÂä®ÂèëÂä®ÊÄÅ„ÄÅËØÑËÆ∫„ÄÅÁÇπËµû</div>
                </div>
                <select id="chat-enable-qzone-actions-select" style="padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background-color: var(--secondary-bg);">
                    <option value="null">‰ΩøÁî®ÂÖ®Â±ÄËÆæÁΩÆ</option>
                    <option value="true">ÂºÄÂêØ</option>
                    <option value="false">ÂÖ≥Èó≠</option>
                </select>
            </div>
            
            <div class="settings-item" id="ai-behavior-view-myphone-item">
                <div>
                    <div style="font-weight: 500;">Êü•ÁúãUserÊâãÊú∫</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">AIÂèØ‰ª•‰∏ªÂä®Êü•Áúã‰Ω†ÁöÑÊâãÊú∫APPÔºåÂπ∂ÁªôÂá∫ÊÑüÊÉ≥</div>
                </div>
                <select id="chat-enable-view-myphone-select" style="padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background-color: var(--secondary-bg);">
                    <option value="null">‰ΩøÁî®ÂÖ®Â±ÄËÆæÁΩÆ</option>
                    <option value="true">ÂºÄÂêØ</option>
                    <option value="false">ÂÖ≥Èó≠</option>
                </select>
            </div>
            
            <div class="settings-item" id="ai-behavior-status-item">
                <div style="font-size: 12px; color: #666; padding: 10px; background: #f5f5f5; border-radius: 6px; width: 100%;">
                    üí° ÂΩìÂâçÂÖ®Â±ÄËÆæÁΩÆÔºöÂøÉÂ£∞ÂäüËÉΩ <span id="global-thoughts-status">ÂÖ≥Èó≠</span>ÔºåÂä®ÊÄÅÂäüËÉΩ <span id="global-qzone-status">ÂÖ≥Èó≠</span>ÔºåÊü•ÁúãÊâãÊú∫ <span id="global-view-myphone-status">ÂÖ≥Èó≠</span>
                </div>
            </div>
        </div>

<!-- Â§©Ê∞îËÆæÁΩÆ (‰ªÖÂçïËÅäÊòæÁ§∫) - UI ‰ºòÂåñÁâà -->
<div class="settings-section" id="weather-settings-section" style="display: none;">
    <!-- ÂºÄÂÖ≥Ë°å -->
    <div class="settings-item">
        <label>ÂêØÁî®ÂÆûÊó∂Â§©Ê∞îÂêåÊ≠•</label>
        <label class="toggle-switch">
            <input type="checkbox" id="enable-weather-switch">
            <span class="slider"></span>
        </label>
    </div>
    
    <!-- ËØ¶ÊÉÖÈÖçÁΩÆÂå∫Âüü (Áî±JSÊéßÂà∂ÊòæÁ§∫/ÈöêËóè) -->
    <div id="weather-config-container" style="display: none;">
        
        <!-- ÊàëÁöÑ‰ΩçÁΩÆ -->
        <div class="settings-item-block">
            <label style="font-weight: 500;">ÊàëÁöÑ‰ΩçÁΩÆ (User)</label>
            <div class="weather-input-group">
                <input type="text" id="user-virtual-city" placeholder="ËôöÊãüÂêç (Â¶Ç: ÈæôÂüé)" class="weather-input">
                <input type="text" id="user-real-city-search" placeholder="ÁúüÂÆûÂüéÂ∏Ç (ÊãºÈü≥/Ëã±Êñá)" class="weather-input">
                <button id="user-city-search-btn" class="settings-mini-btn" style="margin-left: 0;">ÊêúÁ¥¢</button>
            </div>
            <!-- ÈöêËóèÂüü -->
            <input type="hidden" id="user-city-lat">
            <input type="hidden" id="user-city-lon">
            <!-- ÁªìÊûúÂ±ïÁ§∫ -->
            <div id="user-city-result" class="weather-result-text">Êú™ËÆæÁΩÆÊò†Â∞Ñ</div>
        </div>

        <!-- ÂØπÊñπ‰ΩçÁΩÆ -->
        <div class="settings-item-block" style="border-bottom: none;">
            <label style="font-weight: 500;">ÂØπÊñπ‰ΩçÁΩÆ (Char)</label>
            <div class="weather-input-group">
                <input type="text" id="char-virtual-city" placeholder="ËôöÊãüÂêç (Â¶Ç: Âì•Ë∞≠)" class="weather-input">
                <input type="text" id="char-real-city-search" placeholder="ÁúüÂÆûÂüéÂ∏Ç (ÊãºÈü≥/Ëã±Êñá)" class="weather-input">
                <button id="char-city-search-btn" class="settings-mini-btn" style="margin-left: 0;">ÊêúÁ¥¢</button>
            </div>
            <!-- ÈöêËóèÂüü -->
            <input type="hidden" id="char-city-lat">
            <input type="hidden" id="char-city-lon">
            <!-- ÁªìÊûúÂ±ïÁ§∫ -->
            <div id="char-city-result" class="weather-result-text">Êú™ËÆæÁΩÆÊò†Â∞Ñ</div>
        </div>

    </div>
</div>

        <!-- ËßÜÈ¢ëÈÄöËØù‰ºòÂåñËÆæÁΩÆ -->
        <div class="settings-section" id="video-call-optimization-section">
            <!-- ÂºÄÂÖ≥Ë°å -->
            <div class="settings-item">
                <label>ËßÜÈ¢ëÈÄöËØù‰ºòÂåñ</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="enable-video-optimization-switch">
                    <span class="slider"></span>
                </label>
            </div>
            
            <!-- ËØ¶ÊÉÖÈÖçÁΩÆÂå∫Âüü (Áî±JSÊéßÂà∂ÊòæÁ§∫/ÈöêËóè) -->
            <div id="video-optimization-config-container" style="display: none;">
                
                <!-- ÂØπÊñπËßÜÈ¢ëÂõæÁâá -->
                <div class="settings-item-block">
                    <label style="font-weight: 500;">ÂØπÊñπËßÜÈ¢ëÁîªÈù¢</label>
                    <div style="display: flex; align-items: center; gap: 10px; margin-top: 8px;">
                        <img id="remote-video-preview" src="" 
                             style="width: 80px; height: 80px; border-radius: 8px; object-fit: cover; border: 2px solid #ddd; display: none;">
                        <div id="remote-video-placeholder" style="width: 80px; height: 80px; border-radius: 8px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #999;">Êú™ËÆæÁΩÆ</div>
                    </div>
                    <div style="display: flex; gap: 8px; margin-top: 10px;">
                        <button class="settings-mini-btn" onclick="document.getElementById('remote-video-input').click()">Êú¨Âú∞‰∏ä‰º†</button>
                        <button class="settings-mini-btn" id="remote-video-url-btn">URL‰∏ä‰º†</button>
                        <button class="settings-mini-btn" id="remote-video-reset-btn" style="background: #ff3b30; color: white;">ÈáçÁΩÆ</button>
                        <input type="file" id="remote-video-input" accept="image/*" hidden>
                    </div>
                    <input type="text" id="remote-video-url-input" placeholder="ÊàñËæìÂÖ•ÂõæÁâáURL" 
                           style="width: 100%; padding: 8px; margin-top: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px;">
                </div>

                <!-- ÊàëÊñπËßÜÈ¢ëÂõæÁâá -->
                <div class="settings-item-block" style="border-bottom: none;">
                    <label style="font-weight: 500;">ÊàëÊñπËßÜÈ¢ëÁîªÈù¢</label>
                    <div style="display: flex; align-items: center; gap: 10px; margin-top: 8px;">
                        <img id="local-video-preview" src="" 
                             style="width: 80px; height: 80px; border-radius: 8px; object-fit: cover; border: 2px solid #ddd; display: none;">
                        <div id="local-video-placeholder" style="width: 80px; height: 80px; border-radius: 8px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #999;">Êú™ËÆæÁΩÆ</div>
                    </div>
                    <div style="display: flex; gap: 8px; margin-top: 10px;">
                        <button class="settings-mini-btn" onclick="document.getElementById('local-video-input').click()">Êú¨Âú∞‰∏ä‰º†</button>
                        <button class="settings-mini-btn" id="local-video-url-btn">URL‰∏ä‰º†</button>
                        <button class="settings-mini-btn" id="local-video-reset-btn" style="background: #ff3b30; color: white;">ÈáçÁΩÆ</button>
                        <input type="file" id="local-video-input" accept="image/*" hidden>
                    </div>
                    <input type="text" id="local-video-url-input" placeholder="ÊàñËæìÂÖ•ÂõæÁâáURL" 
                           style="width: 100%; padding: 8px; margin-top: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px;">
                </div>

                <!-- ÁúüÂÆûÊëÑÂÉèÂ§¥ËÆæÁΩÆ -->
                <div class="settings-item-block" style="border-bottom: none; padding-top: 15px; border-top: 1px solid #e0e0e0; margin-top: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <label style="font-weight: 500;">‰ΩøÁî®ÁúüÂÆûÊëÑÂÉèÂ§¥</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="enable-real-camera-switch">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        ÂêØÁî®ÂêéÔºåÊàëÊñπÁîªÈù¢Â∞Ü‰ΩøÁî®ËÆæÂ§áÊëÑÂÉèÂ§¥ÔºåAIÂèØ‰ª•ÁúüÊ≠£"ÁúãÂà∞"‰Ω†
                    </div>
                    
                    <!-- Êà™ÂõæÈó¥ÈöîËÆæÁΩÆ -->
                    <div id="camera-interval-setting" style="display: none;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                            <label style="font-size: 13px; white-space: nowrap;">Êà™ÂõæÈó¥Èöî</label>
                            <input type="number" id="camera-capture-interval" 
                                   min="1" max="60" value="5" 
                                   style="width: 60px; padding: 6px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px;">
                            <span style="font-size: 13px; color: #666;">Áßí</span>
                        </div>
                        <div style="font-size: 11px; color: #999; margin-top: 5px;">
                            ÂÆöÊó∂Êà™ÂèñÊëÑÂÉèÂ§¥ÁîªÈù¢ÂèëÈÄÅÁªôAIÔºåÈªòËÆ§5Áßí
                        </div>
                        
                        <!-- ÊëÑÂÉèÂ§¥Áä∂ÊÄÅ -->
                        <div id="camera-status" style="margin-top: 10px; padding: 8px; background: #f9f9f9; border-radius: 6px; font-size: 12px; display: none;">
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <span id="camera-status-icon" style="width: 8px; height: 8px; border-radius: 50%; background: #ccc;"></span>
                                <span id="camera-status-text" style="color: #666;">ÊëÑÂÉèÂ§¥Êú™ÊøÄÊ¥ª</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ‰ªÖËØªÂèñÂØπËØùÂºÄÂÖ≥ -->
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <label style="font-weight: 500; font-size: 13px;">‰ªÖËØªÂèñÂØπËØùÂÜÖÂÆπ</label>
                            <label class="toggle-switch" style="transform: scale(0.9);">
                                <input type="checkbox" id="tts-dialogue-only-switch">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div style="font-size: 11px; color: #666; line-height: 1.5;">
                            ÂêØÁî®ÂêéÔºåËØ≠Èü≥Êí≠Êä•Âè™ËØªÂèñÂºïÂè∑ÂÜÖÁöÑÂØπËØùÔºå‰∏çËØªÂèñÂä®‰ΩúÊèèÂÜôÁ≠âÊóÅÁôΩÂÜÖÂÆπ
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- ËÆ∞ÂøÜÂ∫ìÂå∫Âüü -->
        <div class="settings-section" id="memory-archive-section">
            <div class="settings-item">
                <label style="font-weight: 600; font-size: 16px;">ËÆ∞ÂøÜÂ∫ì</label>
            </div>
            
            <div id="memory-archive-container" style="padding: 0 15px;">
                <div style="margin-bottom: 15px; color: var(--text-secondary); font-size: 13px;">
                    ‰øùÂ≠òÂΩìÂâçËÅäÂ§©ÁöÑÊâÄÊúâËÆ∞ÂΩïÂíåËÆæÁΩÆÔºà‰∫∫ËÆæ„ÄÅÂ§¥ÂÉè„ÄÅÈïøÊúüËÆ∞ÂøÜ„ÄÅËØ≠Èü≥„ÄÅÈ¢ÑËÆæÁ≠âÔºâÔºåÊñπ‰æøÂ§öË∑ØÁ∫øÁÆ°ÁêÜ
                </div>
                
                <button id="save-memory-archive-btn" class="form-button" style="margin-bottom: 15px;">
                    ‰øùÂ≠òÂΩìÂâçÁä∂ÊÄÅ
                </button>
                
                <div id="memory-archive-list" style="display: flex; flex-direction: column; gap: 10px;">
                    <!-- Â≠òÊ°£ÂàóË°®Â∞ÜÂä®ÊÄÅÁîüÊàê -->
                </div>
            </div>
        </div>

        <!-- APIË∞ÉÁî®ÂéÜÂè≤Âå∫Âüü -->
        <div class="settings-section" id="api-history-section">
            <div class="settings-item">
                <label style="font-weight: 600; font-size: 16px;">APIË∞ÉÁî®ÂéÜÂè≤</label>
            </div>
            
            <div style="padding: 0 15px;">
                <div style="margin-bottom: 15px; color: var(--text-secondary); font-size: 13px;">
                    Êü•ÁúãÊØèÊ¨°ÂèëÈÄÅÁªôAIÁöÑÂéüÂßãÊèêÁ§∫ËØç„ÄÅË∞ÉÁî®‰ø°ÊÅØÂíåËøîÂõûÁöÑÂéüÂßãÊï∞ÊçÆ
                </div>
                
                <button id="view-api-history-btn" class="form-button" style="margin-bottom: 15px;">
                    Êü•ÁúãËøîÂõûÁöÑÊèêÁ§∫ËØç
                </button>
            </div>
        </div>

        <!-- Á¨¨ÂõõÁªÑÔºöÈ´òÁ∫ßÂäüËÉΩ (TTS, NAI, Á∫ø‰∏ãÊ®°Âºè) -->
        <div class="settings-section">
             <!-- Êó∂Èó¥Êà≥ÊòæÁ§∫Ê†ºÂºè -->
             <div class="settings-item">
                 <div>
                     <div style="font-weight: 500;">ÊòæÁ§∫ÁßíÊï∞</div>
                     <div style="font-size: 12px; color: var(--text-secondary);">ÂºÄÂêØÂêéÔºåÊ≠§ËÅäÂ§©ÁöÑÊó∂Èó¥Êà≥Â∞ÜÊòæÁ§∫‰∏∫"Êó∂:ÂàÜ:Áßí"Ê†ºÂºèÔºàË¶ÜÁõñÂÖ®Â±ÄËÆæÁΩÆÔºâ</div>
                 </div>
                 <label class="toggle-switch">
                     <input type="checkbox" id="chat-show-seconds-switch">
                     <span class="slider"></span>
                 </label>
             </div>
             
             <!-- ËØ≠Èü≥ -->
             <div class="settings-item" id="tts-enable-group">
                 <label>ÂêØÁî®ËØ≠Èü≥ÂêàÊàê (TTS)</label>
                 <label class="toggle-switch"> <input type="checkbox" id="enable-tts-switch"> <span class="slider"></span> </label>
             </div>
             <div class="settings-item" id="ai-voice-id-group">
                 <label>ËØ≠Èü≥ ID</label>
                 <div class="settings-right">
                    <input type="text" id="ai-voice-id-input" placeholder="minimax voice_id">
                 </div>
             </div>
             <div class="settings-item" id="ai-voice-lang-group">
                <label>ËØ≠Èü≥ËØ≠Ë®Ä/ÊñπË®Ä</label>
                <div class="settings-right">
                  <select id="ai-voice-lang-select" class="settings-select" style="width: 100%; text-align: right;">
                    <option value=""> Ëá™Âä®ËØÜÂà´ (Auto)</option>
                    <hr disabled>
                    <option value="zh-CN">üá®üá≥ ÂõΩËØ≠/ÊôÆÈÄöËØù (Chinese)</option>
                    <option value="zh-HK">üá≠üá∞ Á≤§ËØ≠/Âπø‰∏úËØù (Cantonese)</option>
                    <option value="en-US">üá∫üá∏ Ëã±ËØ≠ (English)</option>
                    <option value="ja-JP">üáØüáµ Êó•ËØ≠ (Japanese)</option>
                    <option value="ko-KR">üá∞üá∑ Èü©ËØ≠ (Korean)</option>
                    <hr disabled>
                    <option value="de-DE">üá©üá™ Âæ∑ËØ≠ (German)</option>
                    <option value="fr-FR">üá´üá∑ Ê≥ïËØ≠ (French)</option>
                    <option value="es-ES">üá™üá∏ Ë•øÁè≠ÁâôËØ≠ (Spanish)</option>
                    <option value="it-IT">üáÆüáπ ÊÑèÂ§ßÂà©ËØ≠ (Italian)</option>
                    <option value="ru-RU">üá∑üá∫ ‰øÑËØ≠ (Russian)</option>
                    <option value="pt-BR">üáßüá∑ Ëë°ËêÑÁâôËØ≠ (Portuguese)</option>
                    <option value="nl-NL">üá≥üá± Ëç∑ÂÖ∞ËØ≠ (Dutch)</option>
                    <option value="pl-PL">üáµüá± Ê≥¢ÂÖ∞ËØ≠ (Polish)</option>
                    <option value="sv-SE">üá∏üá™ ÁëûÂÖ∏ËØ≠ (Swedish)</option>
                    <hr disabled>
                    <option value="tr-TR">üáπüá∑ ÂúüËÄ≥ÂÖ∂ËØ≠ (Turkish)</option>
                    <option value="id-ID">üáÆüá© Âç∞Â∞ºËØ≠ (Indonesian)</option>
                    <option value="ms-MY">üá≤üáæ È©¨Êù•ËØ≠ (Malay)</option>
                    <option value="vi-VN">üáªüá≥ Ë∂äÂçóËØ≠ (Vietnamese)</option>
                    <option value="th-TH">üáπüá≠ Ê≥∞ËØ≠ (Thai)</option>
                    <option value="hi-IN">üáÆüá≥ Âç∞Âú∞ËØ≠ (Hindi)</option>
                   <option value="ar-SA">üá∏üá¶ ÈòøÊãâ‰ºØËØ≠ (Arabic)</option>
                 </select>
               </div>
            </div>
            <div class="settings-item" id="ai-voice-speed-group">
               <label>ËØ≠Èü≥ÈÄüÂ∫¶</label>
               <div class="settings-right">
                 <input type="number" id="ai-voice-speed-input" min="0.5" max="2.0" step="0.1" value="1.0" style="width: 80px; text-align: right; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--secondary-bg); color: var(--text-color);">
                 <span style="margin-left: 5px; color: var(--text-secondary); font-size: 12px;">x</span>
               </div>
            </div>
 <div class="settings-item" id="synth-music-group">
    <div>
        <label>ÂêØÁî®‰πêË∞±ÂêàÊàê</label>
        <div class="settings-desc">ÂÖÅËÆ∏ËßíËâ≤ÂèëÈÄÅ‰πêË∞±Âπ∂Ëá™Âä®ÊºîÂ•è</div>
    </div>
    <label class="toggle-switch">
        <input type="checkbox" id="enable-synth-music-switch">
        <span class="slider"></span>
    </label>
</div>
<div class="settings-item" id="narrator-mode-group" style="display: flex; justify-content: space-between; align-items: center;">
    <div style="flex: 1; padding-right: 10px;">
        <label style="margin-bottom: 2px;">ÂêØÁî®ÊóÅÁôΩÊ®°Âºè</label>
        <div class="settings-desc">AIÊØèËΩÆÂõûÂ§çÈÉΩ‰ºöÈôÑÂ∏¶ÁéØÂ¢ÉÊàñÂøÉÁêÜÊèèÂÜô (ÁÅ∞Ëâ≤Á≥ªÁªüÂ≠ó)</div>
    </div>
    <label class="toggle-switch" style="margin: 0;"> 
        <input type="checkbox" id="narrator-mode-toggle"> 
        <span class="slider"></span> 
    </label>
</div>
<div class="settings-item" id="todo-list-setting-group">
    <div style="flex: 1; padding-right: 10px;">
        <label style="margin-bottom: 2px;">ÂêØÁî®ÂæÖÂäû‰∫ãÈ°πÂêåÊ≠•</label>
        <div class="settings-desc">ÂºÄÂêØÂêéÔºåAIÂ∞ÜËØªÂèñ„Äê‰ªäÊó•„ÄëÂèä„ÄêÊú™ÂÆåÊàê„ÄëÁöÑÂæÖÂäû‰∫ãÈ°π„ÄÇ</div>
    </div>
    <label class="toggle-switch" style="margin: 0;"> 
        <input type="checkbox" id="enable-todo-list-switch"> 
        <span class="slider"></span> 
    </label>
</div>
             <!-- Ë°®ÊÉÖÂåÖËØÜÂõæ -->
             <div class="settings-item" id="sticker-vision-group">
                 <div>
                    <label>ÂêØÁî®Ë°®ÊÉÖÂåÖËØÜÂõæ</label>
                    <div class="settings-desc">CHARÂèØ‰ª•ÁúãÂà∞USERË°®ÊÉÖÂåÖÁöÑÂÜÖÂÆπ</div>
                 </div>
                 <label class="toggle-switch"> 
                    <input type="checkbox" id="enable-sticker-vision-checkbox"> 
                    <span class="slider"></span> 
                 </label>
             </div>
             
             <!-- Á∫ø‰∏ãÊ®°Âºè -->
             <div id="offline-mode-group">
                 <div class="settings-item">
                     <div>
                        <label>Á∫ø‰∏ãÊ®°Âºè (ÊèèÂÜôÊ®°Âºè)</label>
                        <div class="settings-desc">AIÂ∞ÜËæìÂá∫ÂåÖÂê´Âä®‰Ωú/ÂøÉÁêÜÁöÑÊèèÂÜôÊñáÊú¨</div>
                     </div>
                     <label class="toggle-switch"> <input type="checkbox" id="offline-mode-toggle"> <span class="slider"></span> </label>
                 </div>
                 <div id="offline-mode-options" style="display: none; padding: 0 16px 16px 16px;">
                     <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
                        <span style="font-size:13px; color:#666;">Â≠óÊï∞ËåÉÂõ¥:</span>
                        <input type="number" id="offline-min-length-input" class="settings-num-input" value="100">
                        <span>-</span>
                        <input type="number" id="offline-max-length-input" class="settings-num-input" value="300">
                     </div>
                     <label style="font-size:13px; color:#666;">ÊñáÈ£éÈ¢ÑËÆæ:</label>
                     <select id="offline-preset-select" class="settings-select" style="width:100%; margin-top:5px;"></select>
                 </div>
             </div>

             <!-- Êó∂Èó¥ÊÑüÁü• -->
             <div class="settings-item" id="time-perception-group">
                 <label>Êó∂Èó¥ÊÑüÁü•</label>
                 <label class="toggle-switch"> <input type="checkbox" id="time-perception-toggle"> <span class="slider"></span> </label>
             </div>
             <div class="settings-item-block" id="time-zone-group" style="display: none;">
                 <label>Êó∂Âå∫ËÆæÁΩÆ</label>
                 <div style="margin-top: 10px; width: 100%;">
                     <input type="search" id="time-zone-search-input" placeholder="ÊêúÁ¥¢Êó∂Âå∫..." class="settings-textarea" style="height: 36px; padding: 8px; margin-bottom: 8px;">
                     <select id="time-zone-select" class="settings-select" style="width: 100%; padding: 10px; background-color: #f5f5f7;"></select>
                 </div>
             </div>
             
             <!-- NAIËÆæÁΩÆ (ÂçïËÅä/Áæ§ËÅäÂ§çÁî®IDÔºåJSÊéßÂà∂) -->
             <div class="settings-item-block" id="nai-character-settings-group" style="display: none;">
                <label>NAI Âá∫ÂõæËÆæÁΩÆ (ËßíËâ≤‰∏ìÂ±û)</label>
                <div style="margin-top: 10px;">
                    <button id="character-nai-prompts-btn" class="settings-full-btn">ÈÖçÁΩÆ‰∏ìÂ±ûÊèêÁ§∫ËØç</button>
                </div>
             </div>
             <div class="settings-item-block" id="group-nai-settings-group" style="display: none;">
                <label>NAI Âá∫ÂõæËÆæÁΩÆ (Áæ§ËÅä‰∏ìÂ±û)</label>
                <div style="margin-top: 10px;">
                    <button id="group-character-nai-prompts-btn" class="settings-full-btn">ÈÖçÁΩÆ‰∏ìÂ±ûÊèêÁ§∫ËØç</button>
                </div>
             </div>
        </div>

        <!-- Á¨¨‰∫îÁªÑÔºöÂ§ñËßÇ‰∏éËßÜËßâ -->
        <div class="settings-section">
            <div class="settings-item">
                 <label>ËÅäÂ§©ËÉåÊôØ</label>
                 <!-- Â¢ûÂä† full-width Á±ª‰ª•‰øùÊåÅÂè≥ÂØπÈΩêÔºåÂÜÖÈÉ®‰ΩøÁî® avatar-btn-group ‰øùÊåÅÈó¥Ë∑ù‰∏ÄËá¥ -->
                 <div class="settings-right full-width">
                     <div class="avatar-btn-group" style="justify-content: flex-end; width: 100%;">
                         <!-- ÂçáÁ∫ß‰∏∫ÂÆû‰ΩìÂ∞èÊåâÈíÆ -->
                         <button class="settings-mini-btn" onclick="document.getElementById('bg-input').click()">‰∏ä‰º†</button>
                         <button class="settings-mini-btn" id="remove-bg-btn">ÁßªÈô§</button>
                         
                         <!-- ‰øùÊåÅÂéüÊúâÁöÑÈöêËóè input ÂíåÈ¢ÑËßàÂõæÈÄªËæë -->
                         <input type="file" id="bg-input" accept="image/*" hidden>
                         <img id="bg-preview" class="settings-bg-preview">
                     </div>
                 </div>
            </div>
            
            <div class="settings-item-block">
                <label>Ê∞îÊ≥°‰∏ªÈ¢ò</label>
                 <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <select id="theme-preset-select" class="settings-select" style="flex:1; margin-right:10px;"></select>
                    <div style="display:flex; gap:5px;">
                        <button id="save-theme-preset-btn" class="settings-icon-btn">üíæ</button>
                        <button id="delete-theme-preset-btn" class="settings-icon-btn" style="color:#ff3b30;">üóëÔ∏è</button>
                    </div>
                 </div>
                 <!-- Ë°•ÂÖ®ÊâÄÊúâ‰∏ªÈ¢òÈÄâÈ°π -->
                 <div class="theme-selector" style="max-height: 120px; overflow-y: auto; display: flex; flex-wrap: wrap; gap: 12px; padding: 5px 0;">
                      <label><input type="radio" name="theme-select" value="default" id="theme-default"> ÈªòËÆ§</label>
                      <label><input type="radio" name="theme-select" value="pink_blue"> Á≤âËìù</label> 
                      <label><input type="radio" name="theme-select" value="blue_white"> ËìùÁôΩ</label>
                      <label><input type="radio" name="theme-select" value="purple_yellow"> Á¥´ÈªÑ</label>
                      <label><input type="radio" name="theme-select" value="black_white"> ÈªëÁôΩ</label>
                      <label><input type="radio" name="theme-select" value="yellow_white"> ÈªÑÁôΩ</label>
                      <label><input type="radio" name="theme-select" value="red_black"> Á∫¢Èªë</label>
                      <label><input type="radio" name="theme-select" value="blue_yellow"> ËìùÈªÑ</label>
                      <label><input type="radio" name="theme-select" value="pink_yellow"> Á≤âÈªÑ</label>
                      <label><input type="radio" name="theme-select" value="pink_purple"> Á≤âÁ¥´</label>
                      <label><input type="radio" name="theme-select" value="gray_white"> ÁÅ∞ÁôΩ</label>
                      <label><input type="radio" name="theme-select" value="blue_green"> ËìùÁªø</label>
                      <label><input type="radio" name="theme-select" value="pink_white"> Á≤âÁôΩ</label>
                      <label><input type="radio" name="theme-select" value="pink_black"> Á≤âÈªë</label>
                      <label><input type="radio" name="theme-select" value="pink_green"> Á≤âÁªø</label>
                      <label><input type="radio" name="theme-select" value="green_black"> ÁªøÈªë</label>
                      
                      <button id="reset-theme-btn" class="settings-text-btn" style="margin-left: auto;">ÈáçÁΩÆÈªòËÆ§</button>
                 </div>
            </div>

            <div class="settings-item">
                 <label>Â≠ó‰ΩìÂ§ßÂ∞è <span id="font-size-value" style="color:#888; font-size:12px;">13px</span></label>
                 <div class="settings-right" style="width: 50%;">
                    <input type="range" id="font-size-slider" min="12" max="20" step="1" style="width:100%;">
                 </div>
            </div>
            
            <div class="settings-item-block">
                 <label>Ëá™ÂÆö‰πâ CSS <button id="reset-custom-css-btn" style="float:right; font-size:12px;">ÈáçÁΩÆ</button></label>
                 <textarea id="custom-css-input" rows="3" class="settings-textarea" placeholder="/* ÈíàÂØπÂΩìÂâçËÅäÂ§©ÁöÑCSS */"></textarea>
            </div>

            <div class="settings-item-block">
                <label>ÊïàÊûúÈ¢ÑËßà</label>
                <div id="settings-preview-area" style="margin-top:10px;"></div>
            </div>
            
            <div class="settings-item-block" id="lyrics-position-group" style="display: none;">
                 <label>Ê≠åËØçÊ†èËÆæÁΩÆ</label>
                 <div style="display:flex; gap:10px; margin-top:10px;">
                     <select id="lyrics-vertical-pos" class="settings-select"><option value="top">È°∂ÈÉ®</option><option value="bottom">Â∫ïÈÉ®</option></select>
                     <select id="lyrics-horizontal-pos" class="settings-select"><option value="center">Â±Ö‰∏≠</option><option value="left">Â±ÖÂ∑¶</option><option value="right">Â±ÖÂè≥</option></select>
                     <input type="number" id="lyrics-offset-input" class="settings-num-input" value="10" placeholder="ÂÅèÁßª">
                 </div>
            </div>
        </div>

        <!-- Á¨¨ÂÖ≠ÁªÑÔºöÊï∞ÊçÆ‰∏éÊìç‰Ωú (Â∫ïÈÉ®) -->
        <div class="settings-section">
             <div class="settings-item clickable" id="search-history-btn">
                 <label>Êü•ÊâæËÅäÂ§©ËÆ∞ÂΩï</label>
                 <div class="settings-right">‚Ä∫</div>
             </div>
             
             <div class="settings-item clickable" id="export-single-chat-btn">
                 <label>ÂØºÂá∫ËÅäÂ§©ËÆ∞ÂΩï</label>
                 <div class="settings-right">‚Ä∫</div>
             </div>
             
             <div class="settings-item clickable" id="import-single-chat-btn">
                 <label>ÂØºÂÖ•ËÅäÂ§©ËÆ∞ÂΩï</label>
                 <div class="settings-right">
                     ‚Ä∫
                     <input type="file" id="import-single-chat-input" accept="application/json" hidden>
                 </div>
             </div>

             <div class="settings-item clickable" id="clear-chat-btn">
                 <label style="color: #ff3b30;">Ê∏ÖÁ©∫ËÅäÂ§©ËÆ∞ÂΩï</label>
                 <div class="settings-right">‚Ä∫</div>
             </div>
             
             <div class="settings-item clickable" id="block-chat-btn">
                 <label style="color: #ff3b30;">ÊãâÈªëÂØπÊñπ / ÁßªÂá∫Áæ§ËÅä</label>
                 <div class="settings-right">‚Ä∫</div>
             </div>
        </div>
        
        <div style="height: 40px;"></div> <!-- Â∫ïÈÉ®Âû´È´ò -->
      </div>
    </div>
    <div id="rendering-rules-screen" class="screen">
      <div class="header"> 
        <span class="back-btn" onclick="showScreen('home-screen')">‚Äπ</span> 
        <span data-lang-key="homeAppRenderer">Ê∏≤ÊüìËßÑÂàô</span> 
        <div class="header-actions">
            <span class="action-btn" id="import-rules-btn" title="ÂØºÂÖ•ËßÑÂàô">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
            </span>
            <span class="action-btn" id="manage-rules-btn" title="ÁÆ°ÁêÜ/Â§öÈÄâ">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
        <polyline points="9 11 12 14 22 4"></polyline>
    </svg>
</span>
            <span class="action-btn" id="add-new-rule-btn">+</span> 
        </div>
      </div>
      <div id="rules-tabs"> </div>
      <div id="rules-content-container" class="list-container"> </div>
      
      <div id="rules-action-bar" style="display: none; position: absolute; bottom: 0; left: 0; width: 100%; padding: 15px 20px; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); border-top: 1px solid #eee; box-sizing: border-box; justify-content: space-between; align-items: center; z-index: 10;">
          <label style="display:flex; align-items:center; gap:5px; font-size:16px;">
              <input type="checkbox" id="select-all-rules-checkbox"> ÂÖ®ÈÄâ
          </label>
          <div style="display:flex; gap:10px;">
              <button id="export-selected-rules-btn" class="settings-mini-btn" style="background-color: #007aff; color: white; border: none;">ÂØºÂá∫ (0)</button>
              <button id="delete-selected-rules-btn" class="settings-mini-btn" style="color: #ff3b30;">Âà†Èô§ (0)</button>
          </div>
      </div>
    </div>
    <input type="file" id="import-rules-input" accept=".json" style="display: none;">
    <div id="rule-editor-modal" class="modal">
      <div class="modal-content" style="height: 85%;">
        <div class="modal-header"> <span id="rule-editor-title">ÂàõÂª∫Êñ∞ËßÑÂàô</span> </div>
        <div class="modal-body" style="display: flex; flex-direction: column; gap: 15px;">
          <div class="form-group" style="flex-shrink: 0;"> <label for="rule-name-input">ËßÑÂàôÂêçÁß∞</label> <input type="text" id="rule-name-input" placeholder="‰æãÂ¶ÇÔºöÁæéÂõ¢Â§ñÂçñÂç°Áâá"> </div>
          <div class="form-group" style="flex-shrink: 0;"> <label for="rule-chat-id-select">ÁªëÂÆöËåÉÂõ¥</label> <select id="rule-chat-id-select">
              <option value="global">ÂÖ¨Áî® (ÊâÄÊúâËßíËâ≤)</option>
            </select> </div>
          <div class="form-group" style="flex-grow: 1; display: flex; flex-direction: column;"> <label for="rule-regex-input">Ê≠£ÂàôË°®ËææÂºè (‰ΩøÁî®g‰Ωú‰∏∫Ê†áÂøó)</label> <textarea id="rule-regex-input" rows="3" style="font-family: monospace; resize: vertical;" placeholder="‰æãÂ¶ÇÔºöMTR\[(.*?)\]\[(.*?)\|(.*?)\]"></textarea>
          </div>
          <div class="form-group" style="flex-grow: 2; display: flex; flex-direction: column;"> <label for="rule-template-input">HTML Ê®°Êùø (Áî® $1, $2 ÂºïÁî®)</label> <textarea id="rule-template-input" rows="6" style="font-family: monospace; resize: vertical;"
              placeholder="‰æãÂ¶ÇÔºö<div class=`waimai-card`>...<span>$2</span>...</div>"></textarea> </div>
          <div class="form-group" style="display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;"> <label for="rule-enabled-switch" style="margin-bottom: 0;">ÂêØÁî®ËßÑÂàô</label> <label class="toggle-switch"> <input type="checkbox" id="rule-enabled-switch" checked>
              <span class="slider"></span> </label> </div>
<div class="form-group" style="display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;">
    <label for="rule-do-not-send-switch" style="margin-bottom: 0;">
        Ê∏≤ÊüìÊó∂‰ªé‰∏ä‰∏ãÊñá‰∏≠Âà†Èô§
        <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;">
            ÂºÄÂêØÂêéÔºåÂåπÈÖçÊ≠§ËßÑÂàôÁöÑÊ∂àÊÅØÂ∞Ü‰∏ç‰ºöË¢´ÂèëÈÄÅÁªôAIÔºå‰ªÖÁî®‰∫éÂâçÁ´ØÊòæÁ§∫„ÄÇ
        </p>
    </label>
    <label class="toggle-switch">
        <input type="checkbox" id="rule-do-not-send-switch">
        <span class="slider"></span>
    </label>
</div>
        </div>
        <div class="modal-footer"> <button class="cancel" id="cancel-rule-editor-btn" data-lang-key="cancel">ÂèñÊ∂à</button> <button class="save" id="save-rule-btn"data-lang-key="save">‰øùÂ≠òËßÑÂàô</button> </div>
      </div>
    </div>
    <div id="search-history-screen" class="screen">
      <div class="header"> <span class="back-btn" id="search-history-back-btn">‚Äπ</span> <span>ÊêúÁ¥¢ËÅäÂ§©ËÆ∞ÂΩï</span> <span style="width: 30px;"></span> </div>
      <div id="search-bar" style="padding: 10px 15px; border-bottom: 1px solid var(--border-color); background-color: var(--secondary-bg); flex-shrink: 0;">
        <div style="display: flex; gap: 10px; margin-bottom: 10px;"> <input type="search" id="keyword-search-input" placeholder="ËæìÂÖ•ÂÖ≥ÈîÆËØç..." style="flex-grow: 1; padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 16px;"> <input type="date" id="date-search-input"
            style="padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 16px;"> </div>
        <div style="display: flex; gap: 10px;"> <button id="execute-search-btn" class="form-button" style="margin-top: 0; flex-grow: 1;">ÊêúÁ¥¢</button> <button id="clear-search-btn" class="form-button form-button-secondary" style="margin-top: 0; flex-grow: 1;">ÈáçÁΩÆ</button> </div>
      </div>
      <div id="chat-search-results-list" class="list-container" style="padding: 15px; display: flex; flex-direction: column; gap: 15px;"> </div>
    </div>
<!-- ÊîØ‰ªòÂÆùÂ±èÂπï -->
<div id="alipay-screen" class="screen">
    <div class="alipay-header-area">
        <div class="alipay-nav">
            <span class="back-btn" onclick="showScreen('home-screen')">‚Äπ</span>
            <span class="alipay-title">ÊîØ‰ªòÂÆù</span>
            <span class="alipay-action" onclick="handleUserTopUp()">ÂÖÖÂÄº</span>
        </div>
    </div>
    
    <div class="alipay-card-container">
        <div class="alipay-balance-card">
            <div class="balance-label">
                <span>ÊÄªËµÑ‰∫ß(CNY)</span>
                </div>
            <div class="balance-amount" id="alipay-balance-display">0.00</div>
            <div class="balance-status-tag" id="alipay-status-tag">Ê†áÂáÜ‰ºöÂëò</div>
        </div>

        <div class="alipay-grid-menu">
            <div class="alipay-menu-item" onclick="openFundScreen()">
                <div class="menu-icon">üìà</div>
                <div class="menu-info">
                    <div class="menu-title">Âü∫ÈáëÁêÜË¥¢</div>
                    <div class="menu-trend" id="fund-market-trend-preview" style="font-size:12px;">+2.35%</div>
                </div>
                <div class="menu-arrow">‚Ä∫</div>
            </div>
            </div>
        
        </div>

    <div class="alipay-bill-container" style="margin: 0 12px; border-radius: 16px;">
        <div id="alipay-transaction-list">
            </div>
    </div>
</div>
<!-- Âü∫ÈáëÁêÜË¥¢Â±èÂπï (Â∑≤ÂéªÊéâ‰∫ÜÂÜÖËÅîÈ¢úËâ≤ÔºåÊîπ‰∏∫ class ÊéßÂà∂) -->
<div id="fund-screen" class="screen" style="background-color: #f5f5f5;">
    <!-- Â§¥ÈÉ®ÔºöÊ∑ªÂä†‰∫Ü class="fund-header-area" -->
    <div class="header fund-header-area">
        <span class="back-btn" onclick="showScreen('alipay-screen')" style="color: white;">‚Äπ</span>
        <span>ÁêÜË¥¢Â∏ÇÂú∫</span>
        <span class="action-btn" onclick="refreshFundMarket()" style="font-size: 14px; color: white;">Âà∑Êñ∞</span>
    </div>
    
    <!-- ËµÑ‰∫ßÂç°ÁâáÔºöÊ∑ªÂä†‰∫Ü class="fund-asset-card" -->
    <div class="fund-asset-card">
        <div style="font-size: 13px; opacity: 0.8;">ÊåÅÊúâÊÄªËµÑ‰∫ß (CNY)</div>
        <div style="font-size: 32px; font-weight: 700; margin: 5px 0;" id="fund-total-assets">0.00</div>
        <div style="font-size: 13px; display: flex; gap: 15px;">
            <span>Êò®Êó•Êî∂Áõä <span id="fund-yesterday-profit">0.00</span></span>
            <span>ÊåÅÊúâÊî∂Áõä <span id="fund-total-profit">0.00</span></span>
        </div>
    </div>

    <div class="list-container" style="padding: 20px 15px; padding-bottom: 80px; background-color: #f5f5f5; border-radius: 20px 20px 0 0; overflow-y: auto; margin-top: -20px;">
        <div class="frame-tabs" style="background: white; border-radius: 12px; padding: 5px; margin-bottom: 15px; border: none; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
            <div id="tab-fund-market" class="frame-tab active" onclick="switchFundTab('market')" style="border-radius: 8px;">Â∏ÇÂú∫ÁÉ≠Èó®</div>
            <div id="tab-fund-my" class="frame-tab" onclick="switchFundTab('my')" style="border-radius: 8px;">ÊàëÁöÑÊåÅ‰ªì</div>
        </div>

        <div id="fund-market-list" style="display: block;"></div>
        <div id="fund-my-list" style="display: none;"></div>
        
        <p style="font-size: 12px; color: #999; text-align: center; margin-top: 20px;">
            Â∏ÇÂú∫ÊúâÈ£éÈô©ÔºåÊäïËµÑÈúÄË∞®ÊÖé<br>Ê®°ÊãüÊï∞ÊçÆ‰ªÖ‰æõÂ®±‰πê
        </p>
    </div>
</div>

<!-- Âü∫Èáë‰∫§ÊòìÂºπÁ™ó -->
<div id="fund-trade-modal" class="modal">
    <div class="modal-content" style="width: 300px; height: auto;">
        <div class="modal-header">
            <span id="fund-trade-title">Âü∫Èáë‰∫§Êòì</span>
        </div>
        <div class="modal-body">
            <div style="margin-bottom: 15px; padding: 10px; background: #f9f9f9; border-radius: 8px;">
                <div id="fund-trade-name" style="font-weight: bold; font-size: 16px;"></div>
                <div id="fund-trade-code" style="font-size: 12px; color: #999;"></div>
                <div style="display: flex; justify-content: space-between; margin-top: 8px;">
                    <span style="font-size: 13px;">ÂΩìÂâçÂáÄÂÄº: <span id="fund-trade-nav" style="color: #1677ff; font-weight: bold;"></span></span>
                    <span style="font-size: 13px;">Êó•Ê∂®Ë∑å: <span id="fund-trade-change"></span></span>
                </div>
            </div>
            
            <div class="form-group">
                <label id="fund-trade-label">‰π∞ÂÖ•ÈáëÈ¢ù (‰ΩôÈ¢ù: ¬•<span id="fund-wallet-balance"></span>)</label>
                <!-- ‰øÆÂ§çÔºöÂº∫Âà∂ type="number" -->
                <input type="number" id="fund-trade-amount" placeholder="ËØ∑ËæìÂÖ•ÈáëÈ¢ù" style="font-size: 24px; font-weight: bold; color: #1677ff; border-bottom: 2px solid #eee; padding: 10px 0;">
            </div>
            <p id="fund-trade-info" style="font-size: 12px; color: #666; margin-top: 5px;"></p>
        </div>
        <div class="modal-footer">
            <button class="cancel" onclick="document.getElementById('fund-trade-modal').classList.remove('visible')">ÂèñÊ∂à</button>
            <!-- ‰øÆÂ§çÔºöÁõ¥Êé•ÁªëÂÆö onclick ÂáΩÊï∞Ôºå‰∏çÂÜç‰æùËµñ addEventListener -->
            <button class="save" id="fund-confirm-btn" onclick="handleFundTradeConfirm()">Á°ÆËÆ§</button>
        </div>
    </div>
</div>
<div id="auction-screen" class="screen" style="background-color: #121212; color: #e0e0e0;">
    <div class="header" style="background-color: #1c1c1e; color: #d4af37; border-bottom: 1px solid #333;">
    <span class="back-btn" onclick="showScreen('home-screen')" style="color: #d4af37;">‚Äπ</span>
    <span>ÈªëÂ∏ÇÊãçÂçñ</span>
    <div class="header-actions">
        <span class="action-btn" onclick="generateNewAuctionItem()">Êñ∞ÊãçÂìÅ</span>
        <span class="action-btn" onclick="openInventoryModal()">üì¶ ‰ªìÂ∫ì</span>
        
    </div>
   </div>
    
    <!-- ÊãçÂìÅÂ±ïÁ§∫Âå∫ -->
    <div id="auction-main-display" style="padding: 20px; text-align: center; height: 45%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
        <div id="auction-item-image-container" style="width: 200px; height: 200px; border: 2px solid #d4af37; border-radius: 10px; overflow: hidden; box-shadow: 0 0 20px rgba(212, 175, 55, 0.3); background: #000; margin-bottom: 15px; position: relative;">
            <img id="auction-item-img" src="" style="width: 100%; height: 100%; object-fit: cover; display: none;">
            <div id="auction-loading" style="color: #666; margin-top: 90px;">Á≠âÂæÖÊãçÂìÅ...</div>
        </div>
        <h2 id="auction-item-name" style="margin: 5px 0; font-size: 20px; color: #fff;">---</h2>
        <p id="auction-item-desc" style="font-size: 12px; color: #888; margin: 0; max-height: 40px; overflow: hidden;">---</p>
    </div>

    <!-- Á´û‰ª∑‰ø°ÊÅØÂå∫ -->
    <div style="background-color: #1c1c1e; padding: 15px; border-radius: 20px 20px 0 0; flex-grow: 1; display: flex; flex-direction: column; box-shadow: 0 -4px 20px rgba(0,0,0,0.5);">
        
        <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #333;">
            <div>
                <div style="font-size: 12px; color: #888;">ÂΩìÂâçÊúÄÈ´ò‰ª∑</div>
                <div id="auction-current-price" style="font-size: 32px; font-weight: bold; color: #ff4d4f; font-family: monospace;">¬• 0</div>
            </div>
            <div style="text-align: right;">
                <div style="font-size: 12px; color: #888;">ÂÄíËÆ°Êó∂</div>
                <div id="auction-timer" style="font-size: 24px; font-weight: bold; color: #d4af37;">--</div>
            </div>
        </div>

        <!-- ÂÆûÊó∂Âá∫‰ª∑ËÆ∞ÂΩï -->
        <div id="auction-log" style="flex-grow: 1; overflow-y: auto; font-size: 13px; margin-bottom: 15px; height: 100px;">
            <div style="color: #666; text-align: center;">Á≠âÂæÖÂºÄÊãç...</div>
        </div>

        <!-- Êìç‰ΩúÊåâÈíÆ -->
        <div id="auction-controls" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
            <button class="form-button-secondary" onclick="placeBid(1.1)" style="background: #333; color: white; border: 1px solid #555;">+10%</button>
            <button class="form-button-secondary" onclick="placeBid(1.5)" style="background: #333; color: white; border: 1px solid #555;">+50%</button>
            <button class="form-button" onclick="placeBid('custom')" style="background: linear-gradient(135deg, #d4af37, #f2d06b); color: black; font-weight: bold; border: none;">Âá∫‰ª∑</button>
        </div>
    </div>
</div>
<div id="todo-list-screen" class="screen" style="background-color: #f2f2f7;">
    <div class="header">
        <span class="back-btn" id="todo-list-back-btn">‚Äπ</span>
        <span>ÂæÖÂäû‰∫ãÈ°π</span>
        <span class="action-btn" id="add-todo-btn" style="font-size: 24px;">+</span>
    </div>
    
    <div class="todo-date-navigator">
        <button id="todo-prev-day-btn">‚Äπ</button>
        <div id="todo-current-date-display">‰ªäÂ§©</div>
        <button id="todo-next-day-btn">‚Ä∫</button>
    </div>

    <div id="todo-list-container" class="list-container" style="padding: 15px;">
        </div>
</div>
<div id="green-river-screen" class="screen gr-theme">
    <div class="gr-header">
    <button class="gr-icon-btn" onclick="showScreen('home-screen')">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
    </button>
    
    <span class="gr-title">Green River</span>
    
    <div class="gr-header-actions">
        <button class="gr-icon-btn" onclick="openAuthorManager()" title="‰ΩúËÄÖÁÆ°ÁêÜ">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
        </button>
        <button class="gr-icon-btn" onclick="createNewStory()" title="Êñ∞Âª∫‰ΩúÂìÅ">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
        </button>
    </div>
</div>
    
    <div class="gr-content-area">
        <div class="gr-section-header">
            <span class="gr-section-title">‰π¶Êû∂ Library</span>
        </div>
        <div id="gr-book-list" class="gr-grid-list">
            </div>
    </div>
</div>

<div id="gr-author-screen" class="screen gr-theme">
    <div class="gr-header">
        <button class="gr-icon-btn" onclick="showScreen('green-river-screen')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
        </button>
        <span class="gr-title">Authors</span>
        <div class="gr-header-actions">
            <button class="gr-icon-btn" onclick="addAuthor()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
            </button>
        </div>
    </div>
    <div class="gr-content-area" id="gr-author-list"></div>
</div>

<div id="gr-reader-screen" class="screen gr-theme">
    <div class="gr-header">
        <button class="gr-icon-btn" onclick="showScreen('green-river-screen')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
        </button>
        <div style="display:flex; flex-direction:column; align-items:center;">
             <span class="gr-title" id="gr-book-name-display" style="font-size:14px; opacity:0.7;">‰π¶Âêç</span>
             <span class="gr-title" id="gr-chapter-title-display" style="font-size:16px; font-weight:bold;">Á¨¨‰∏ÄÁ´†</span>
        </div>
        <button class="gr-icon-btn" onclick="openStorySettings()" title="ËÆæÂÆö">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
        </button>
    </div>

    <div id="gr-sidebar-overlay" onclick="closeChapterList()"></div>
    <div id="gr-chapter-sidebar">
        <div class="gr-sidebar-header">
            <span>ÁõÆÂΩï Contents</span>
            <span id="gr-total-chapters" style="font-size:12px; color:#888;">ÂÖ± 0 Á´†</span>
        </div>
        <div id="gr-chapter-list-content">
            </div>
    </div>
    
    <div class="gr-reader-content" id="gr-reader-content">
        </div>

    <div class="gr-control-panel">
        <div id="gr-pagination-controls" style="display:flex; justify-content:space-between; align-items:center; width:100%;">
            <button class="gr-text-btn" id="gr-prev-chapter-btn">‰∏ä‰∏ÄÁ´†</button>
            <button class="gr-icon-btn" id="gr-menu-btn" onclick="openChapterList()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>
            </button>
            <button class="gr-text-btn" id="gr-next-chapter-btn">‰∏ã‰∏ÄÁ´†</button>
        </div>

        <div id="gr-writing-controls" style="display:none; gap:10px; align-items:center; width:100%; margin-top:10px;">
             <div class="gr-input-group" style="flex-grow:1;">
                <input type="text" id="gr-direction-input" class="gr-input" placeholder="ËæìÂÖ•Êú¨Á´†ÂâßÊÉÖËµ∞Âêë (‰æãÂ¶ÇÔºö‰∏§‰∫∫ÂèëÁîü‰∫âÂêµ)...">
            </div>
            <button id="gr-reroll-btn" class="gr-main-btn" style="background-color:#F4F4F5; color:#666; border:1px solid #ddd; padding: 10px;" title="ÈáçÂÜôÊú¨Á´†">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 4v6h-6"></path><path d="M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
            </button>
            <button id="gr-generate-btn" class="gr-main-btn">
                
                <svg id="gr-gen-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                </svg>
            </button>
        </div>
    </div>
</div>
<!-- ÈÇÆÁÆ±‰∏ªÁïåÈù¢ -->
<div id="email-screen" class="screen mail-theme">
    <div class="mail-header">
    <button class="mail-icon-btn" onclick="showScreen('home-screen')">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
        <span style="font-size: 16px; margin-left: -2px;">ËøîÂõû</span>
    </button>
    
    <div class="mail-header-actions">
        <button class="mail-icon-btn" onclick="openEmailSettings()" title="ÈÇÆÁÆ±ÈÖçÁΩÆ">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path>
                <circle cx="12" cy="12" r="3"></circle>
            </svg>
        </button>

        <button class="mail-icon-btn" onclick="handleQuickReceiveMail()" title="‰∏ÄÈîÆÊé•Êî∂Êñ∞ÈÇÆ‰ª∂">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                <path d="M22 7l-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
                <line x1="12" y1="19" x2="12" y2="15"></line>
                <line x1="10" y1="17" x2="14" y2="17"></line>
            </svg>
        </button>

        <button id="mail-edit-btn" class="mail-icon-btn" onclick="toggleEmailEditMode()" title="ÁºñËæëÂàóË°®">
        ÁºñËæë
    </button>
    </div>
</div>

    <div style="flex-shrink: 0;">
        <h1 class="mail-large-title">Êî∂‰ª∂ÁÆ±</h1>
        <div class="mail-search-bar">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#8E8E93" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
            <input type="text" placeholder="ÊêúÁ¥¢" id="mail-search-input">
        </div>
    </div>

    <div id="email-list" class="mail-list-container">
        </div>
     <div id="mail-action-bar" style="display: none;">
        <div class="select-all-btn" id="mail-select-all-btn">ÂÖ®ÈÄâ</div>
        <button id="mail-delete-selected-btn" class="mail-delete-action-btn">Âà†Èô§ (0)</button>
    </div>
</div>

<div id="email-detail-screen" class="screen mail-theme" style="background-color: #fff; display: flex; flex-direction: column;">
    <div class="mail-detail-header">
        <button class="mail-icon-btn" onclick="closeEmailDetail()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#007AFF" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
            <span style="color: #007AFF; font-size: 16px; margin-left: -2px;">Êî∂‰ª∂ÁÆ±</span>
        </button>
        
        <div class="mail-header-actions">
            <button class="mail-icon-btn" id="forward-email-btn" title="ËΩ¨ÂèëÂà∞ËÅäÂ§©">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#007AFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
            </button>
            <button class="mail-icon-btn" id="delete-email-btn" title="Âà†Èô§ÈÇÆ‰ª∂" style="color: #ff3b30;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
            </button>
        </div>
    </div>
    
    <div class="mail-detail-content">
        <div class="mail-meta-header">
            <div class="mail-subject-line" id="mail-detail-subject">Subject</div>
            <div class="mail-meta-row">
                <div class="mail-sender-avatar" id="mail-detail-avatar"></div>
                <div class="mail-meta-info">
                    <div class="mail-from-row">
                        <span class="mail-from-name" id="mail-detail-from">Sender Name</span>
                        <span class="mail-time" id="mail-detail-time">Today</span>
                    </div>
                    <div class="mail-to-row">To: <span id="mail-detail-to">Me</span></div>
                </div>
            </div>
        </div>
        <div class="mail-body-text" id="mail-detail-body">
            </div>
    </div>
    </div>
    
</div>

<!-- ÈÇÆ‰ª∂ÁîüÊàêÂô®ÈÖçÁΩÆÂºπÁ™ó -->
<div id="email-generator-modal" class="modal">
    <div class="modal-content" style="height: 85%; background-color: #FAFAF9; border-radius: 20px;">
        <div class="mail-modal-header">
            <span>Êî∂‰ª∂ÁÆ±ÈÖçÁΩÆ</span>
        </div>
        <div class="modal-body" style="padding: 20px;">
            
            <!-- 1. Ë∫´‰ªΩËÆæÂÆö -->
            <div class="gr-form-group">
                <label>Êî∂‰ª∂‰∫∫Ë∫´‰ªΩ (User Persona)</label>
                
                <select id="mail-user-persona-select" class="gr-input" style="margin-bottom: 8px; padding: 8px; border:1px solid #ddd;">
                    <option value="">-- ‰ªÖ‰ΩøÁî®‰∏ãÊñπÂÖ≥ÈîÆËØç --</option>
                </select>

                <input type="text" id="mail-user-mask" class="gr-input" placeholder="‰æãÂ¶ÇÔºö‰æ¶Êé¢„ÄÅÂÖ¨Âè∏È´òÁÆ°„ÄÅÁ•ûÁßò‰∫∫..." value="ÊôÆÈÄöÁî®Êà∑">
                <p style="font-size:11px; color:#999; margin-top:5px;">ÈÄâÊã©È¢ÑËÆæÂèØÊèê‰æõËØ¶ÁªÜËÉåÊôØÔºå‰∏ãÊñπËæìÂÖ•Ê°ÜÁî®‰∫éÂÆö‰πâÂΩìÂâçÂÖ∑‰ΩìÁöÑÁ§æ‰ºöË∫´‰ªΩ„ÄÇ</p>
            </div>

            <!-- 2. ‰∏ñÁïåËßÇËÆæÂÆö -->
            <div class="gr-form-group">
                <label>ÈÇÆ‰ª∂Á≥ªÁªüËÉåÊôØ (World Context)</label>
                <textarea id="mail-world-context" class="gr-input" rows="3" placeholder="‰æãÂ¶ÇÔºöËµõÂçöÊúãÂÖãÈªëÂÆ¢ËÆ∫ÂùõÈÄöÁü•„ÄÅÁª¥Â§öÂà©‰∫öÊó∂ÊúüÁöÑ‰ø°‰ª∂„ÄÅÁé∞‰ª£ËÅåÂú∫ÂûÉÂúæÈÇÆ‰ª∂..."></textarea>
            </div>

            <!-- 3. Âèë‰ª∂‰∫∫Êù•Ê∫ê -->
            <div class="gr-form-group">
                <label>Âèë‰ª∂‰∫∫Êù•Ê∫ê (Â§öÈÄâ)</label>
                <div class="gr-checkbox-list" id="mail-sender-list">
                    <!-- JS Âä®ÊÄÅÂ°´ÂÖÖËßíËâ≤Âíå NPC -->
                </div>
                <label style="margin-top:10px; display:flex; align-items:center;">
                    <input type="checkbox" id="mail-allow-random-npc" checked> ÂÖÅËÆ∏ÁîüÊàêÈöèÊú∫ÈôåÁîü‰∫∫/ÂûÉÂúæÈÇÆ‰ª∂
                </label>
            </div>

            <!-- 4. ÂÖ≥ËÅî‰∏ä‰∏ãÊñá -->
            <div class="gr-form-group">
                <label>ÂÖ≥ËÅîËÆ∞ÂøÜ‰∏é‰∏ñÁïå‰π¶</label>
                <div class="gr-checkbox-list" id="mail-context-list">
                    <!-- JS Âä®ÊÄÅÂ°´ÂÖÖ‰∏ñÁïå‰π¶ -->
                </div>
            </div>
          <div class="gr-form-group">
                <label>ÁîüÊàêÊï∞Èáè</label>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <input type="number" id="mail-gen-count" class="gr-input" value="3" min="1" max="10" style="flex:1;">
                    <span style="font-size: 13px; color: #888;">Â∞Å</span>
                </div>
            </div>
        </div>
        <div class="modal-footer" style="border-top: 1px solid #E5E5E5; display:flex; gap:15px;">
            <button class="cancel" style="background:#F5F5F7; color:#000; border:none;" onclick="document.getElementById('email-generator-modal').classList.remove('visible')">ÂèñÊ∂à</button>
            <button class="save" style="background:#007AFF; color:#fff; border:none;" id="start-generate-email-btn">Êé•Êî∂ÈÇÆ‰ª∂</button>
        </div>
    </div>
</div>

    <div id="shopping-screen" class="screen">
      <div class="header">
        <div class="header-left-actions"> <span class="back-btn" id="shopping-back-btn">‚Äπ</span> <span class="action-btn" id="generate-shopping-items-btn" title="AIÁîüÊàêÂïÜÂìÅ"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
              <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
            </svg> </span> <span class="action-btn" id="shopping-settings-btn" title="ÁîüÊàêËÆæÁΩÆ"> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path
                d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.44,0.17-0.48,0.41L9.12,4.84c-0.59,0.24-1.12,0.56-1.62,0.94L5.11,4.82c-0.22-0.08-0.47,0-0.59,0.22l-1.92,3.32 c-0.12,0.22-0.07,0.47,0.12,0.61l2.03,1.58C4.84,11.36,4.82,11.68,4.82,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.48,2.03 c0.04,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.48-0.41l0.48-2.03c0.59-0.24,1.12-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z">
              </path>
            </svg> </span> <span class="action-btn" id="delete-current-category-btn" title="Âà†Èô§ÂΩìÂâçÂàÜÁ±ª" style="display: none; color: rgb(255, 59, 48);"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 4H8l-7 8 7 8h13a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"></path>
              <line x1="18" y1="9" x2="12" y2="15"></line>
              <line x1="12" y1="9" x2="18" y2="15"></line>
            </svg> </span> </div> <span>Ë¥≠Áâ©‰∏≠ÂøÉ</span>
        <div class="header-actions"> <span class="action-btn" id="manage-products-btn" title="ÁÆ°ÁêÜÂïÜÂìÅ" style="color: var(--text-primary);"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
            </svg> </span> <span class="action-btn" id="add-new-product-btn" title="Ê∑ªÂä†Êñ∞ÂïÜÂìÅ"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="16"></line>
              <line x1="8" y1="12" x2="16" y2="12"></line>
            </svg> </span> <span class="action-btn" id="go-to-cart-btn" title="Êü•ÁúãË¥≠Áâ©ËΩ¶"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg> <span id="cart-count">0</span> </span> </div>
      </div>
      <div id="product-category-tabs"></div>
      <div id="product-grid" class="list-container"> </div>
      <div id="shopping-action-bar"> <label class="select-all-label"> <input type="checkbox" id="select-all-products-checkbox"> ÂÖ®ÈÄâ </label> <button id="delete-selected-products-btn" class="action-bar-btn">Âà†Èô§ (0)</button> </div>
    </div>
    <div id="product-detail-screen" class="screen">
      <div class="header"> <span class="back-btn" id="product-detail-back-btn">‚Äπ</span> <span>ÂïÜÂìÅËØ¶ÊÉÖ</span> <span style="width: 30px;"></span> </div>
      <div id="product-detail-content" class="list-container"> </div>
      <div id="product-detail-footer"> <button class="footer-btn add-to-cart-detail-btn">Âä†ÂÖ•Ë¥≠Áâ©ËΩ¶</button> <button class="footer-btn buy-now-btn">Á´ãÂç≥Ë¥≠‰π∞</button> </div>
    </div>
    <div id="cart-screen" class="screen">
      <div class="header"> <span class="back-btn" id="cart-back-btn">‚Äπ</span> <span id="cart-title">Ë¥≠Áâ©ËΩ¶(0)</span> <span class="action-btn" id="clear-cart-btn">Ê∏ÖÁ©∫</span> </div>
      <div id="cart-items-list" class="list-container"> </div>
      <div id="cart-footer"> <label class="select-all-label"><input type="checkbox" id="select-all-cart-items"> ÂÖ®ÈÄâ</label>
        <div class="cart-summary">
          <div id="cart-total">ÂêàËÆ°: ¬•0.00</div> <span class="cart-subtext">‰∏çÂê´ËøêË¥π</span>
        </div> <button id="checkout-btn">ÁªìÁÆó(0)</button>
      </div>
    </div>
    <div id="product-editor-modal" class="modal">
      <div class="modal-content" style="height: 85%;">
        <div class="modal-header"> <span id="product-editor-title">Ê∑ªÂä†ÂïÜÂìÅ</span> </div>
        <div class="modal-body">
          <div class="form-group"> <label>ÂïÜÂìÅÂõæÁâá</label>
            <div class="avatar-upload"> <img id="product-image-preview" src="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1756206115802_qdqqd_0c99bh.jpeg"> <button onclick="document.getElementById('product-image-input').click()">‰∏ä‰º†ÂõæÁâá</button> <input type="file" id="product-image-input"
                accept="image/*" hidden> </div>
          </div>
          <div class="form-group"> <label for="product-name-input">ÂïÜÂìÅÂêçÁß∞</label> <input type="text" id="product-name-input"> </div>
          <div class="form-group"> <label for="product-category-select">ÂïÜÂìÅÂàÜÁ±ª</label>
            <div style="display: flex; align-items: center; gap: 10px;"> <select id="product-category-select" style="flex-grow: 1;"></select> <button id="manage-product-categories-btn" class="form-button-secondary" style="margin-top: 0; padding: 12px;">ÁÆ°ÁêÜ</button> </div>
          </div>
          <div class="form-group"> <label for="product-price-input">ÈªòËÆ§‰ª∑Ê†º (ÂÖÉ)</label> <input type="number" id="product-price-input" min="0" step="0.01"> </div>
          <div class="form-group"> <label for="product-description-input">ÂïÜÂìÅÊèèËø∞</label> <textarea id="product-description-input" rows="3" placeholder="ËØ¶ÁªÜ‰ªãÁªç‰∏Ä‰∏ãËøô‰∏™ÂïÜÂìÅ..."></textarea> </div>
          <hr style="opacity: 0.2; margin: 20px 0;">
          <div class="form-group"> <label>ÂïÜÂìÅÊ¨æÂºè</label>
            <p style="font-size: 12px; color: #888; margin-top: -5px; margin-bottom: 10px;">Â¶ÇÊûúÊ≤°ÊúâÊ∑ªÂä†‰ªª‰ΩïÊ¨æÂºèÔºåÂ∞Ü‰ΩøÁî®‰∏äÈù¢ÁöÑÈªòËÆ§‰ª∑Ê†º„ÄÇ</p>
            <div id="product-variations-container" style="display: flex; flex-direction: column; gap: 15px;"> </div> <button id="add-product-variation-btn" class="form-button form-button-secondary" style="margin-top: 15px;">+ Ê∑ªÂä†Êñ∞ÁöÑ‰∏ÄÊ¨æ</button>
          </div>
        </div>
        <div class="modal-footer"> <button class="cancel" id="cancel-product-editor-btn"data-lang-key="cancel">ÂèñÊ∂à</button> <button class="save" id="save-product-btn"data-lang-key="save">‰øùÂ≠ò</button> </div>
      </div>
    </div>
    <div id="gift-receipt-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header"> <span>Ë¥≠Áâ©Â∞èÁ•®</span> </div>
        <div class="modal-body" id="gift-receipt-body"> </div>
        <div class="modal-footer"> <button class="save" id="close-receipt-btn" style="width:100%;">ÂÖ≥Èó≠</button> </div>
      </div>
    </div>
  </div>
  </div> <input type="file" id="import-card-input" accept=".json,.png" multiple style="display: none;"> <input type="file" id="import-world-book-input" accept=".json,.txt" multiple style="display: none;">
  <div id="persona-library-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span>ÊàëÁöÑ‰∫∫ËÆæÂ∫ì</span>
        <div style="display: flex; gap: 10px;">
          <button id="import-tavern-persona-btn" class="action-button">ÂØºÂÖ•</button>
          <button id="add-persona-preset-btn" class="action-button" data-lang-key="add">Ê∑ªÂä†</button>
          <button id="manage-persona-preset-btn" class="action-button" data-lang-key="manage">ÁÆ°ÁêÜ</button>
        </div>
      </div>
      <div class="modal-body">
        <div id="persona-library-grid"></div>
      </div>
      <div class="modal-footer">
        <button class="cancel" id="close-persona-library-btn">ÂÖ≥Èó≠</button>
        <div id="persona-manage-actions" style="display: none; gap: 10px;">
          <button class="action-button" id="select-all-persona-btn">ÂÖ®ÈÄâ</button>
          <button class="action-button" id="delete-selected-persona-btn" style="background-color: #ff3b30;">Âà†Èô§</button>
          <button class="cancel" id="cancel-manage-persona-btn">ÂèñÊ∂à</button>
        </div>
      </div>
    </div>
  </div>
  <input type="file" id="import-tavern-persona-input" accept=".json" style="display: none;">
  
  <!-- ‰∫∫ËÆæÊìç‰ΩúÈÄâÊã©ÂºπÁ™ó -->
  <div id="persona-action-modal" class="modal">
    <div class="modal-content" style="width: 350px; height: auto;">
      <div class="modal-header">
        <span id="persona-action-title">‰∫∫ËÆæÊìç‰Ωú</span>
      </div>
      <div class="modal-body" style="padding: 20px;">
        <button class="form-button" id="apply-persona-direct-btn" style="width: 100%; margin-bottom: 15px; padding: 15px; font-size: 16px; background: #007AFF; color: white; border: none;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 8px;">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          Áõ¥Êé•Â∫îÁî®
        </button>
        <button class="form-button" id="edit-persona-first-btn" style="width: 100%; padding: 15px; font-size: 16px; background: #f0f0f0; color: #333; border: none;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 8px;">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
          </svg>
          ÁºñËæëÂêéÂ∫îÁî®
        </button>
      </div>
      <div class="modal-footer">
        <button class="cancel" id="cancel-persona-action-btn">ÂèñÊ∂à</button>
      </div>
    </div>
  </div>
  
  <!-- ÊâπÈáèÂØºÂÖ•ËßíËâ≤Âç°È¢ÑËßàÊ®°ÊÄÅÊ°Ü -->
  <div id="batch-import-preview-modal" class="modal">
    <div class="modal-content" style="height: 80%; max-width: 900px;">
      <div class="modal-header">
        <span>ÊâπÈáèÂØºÂÖ•ËßíËâ≤Âç°È¢ÑËßà</span>
        <label style="font-size: 14px; font-weight: normal; display: flex; align-items: center; gap: 5px;">
          <input type="checkbox" id="select-all-import-cards" checked> ÂÖ®ÈÄâ
        </label>
      </div>
      <div class="modal-body" id="batch-import-preview-list" style="padding: 0; overflow-y: auto;">
        <!-- ËßíËâ≤Âç°È¢ÑËßàÂàóË°®Â∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
      </div>
      <div class="modal-footer">
        <button class="cancel" id="cancel-batch-import-btn">ÂèñÊ∂à</button>
        <button class="save" id="confirm-batch-import-btn">Á°ÆËÆ§ÂØºÂÖ•</button>
      </div>
    </div>
  </div>
  
  <div id="tavern-persona-selector-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header">
        <span>ÈÄâÊã©Ë¶ÅÂØºÂÖ•ÁöÑÈ¢ÑËÆæ</span>
      </div>
      <div class="modal-body" style="padding: 0;">
        <div id="tavern-persona-selector-list" style="overflow-y: auto; height: 100%;"></div>
      </div>
      <div class="modal-footer">
        <button class="cancel" id="cancel-tavern-import-btn">ÂèñÊ∂à</button>
        <button class="save" id="confirm-tavern-import-btn">Á°ÆËÆ§ÂØºÂÖ•</button>
      </div>
    </div>
  </div>
  <div id="persona-editor-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header"><span id="persona-editor-title">Ê∑ªÂä†‰∫∫ËÆæÈ¢ÑËÆæ</span></div>
      <div class="modal-body">
        <div class="form-group"><label>È¢ÑËÆæÂ§¥ÂÉè</label>
          <div class="avatar-upload"><img id="preset-avatar-preview"><button onclick="document.getElementById('preset-avatar-input').click()">‰∏ä‰º†Â§¥ÂÉè</button><input type="file" id="preset-avatar-input" accept="image/*"></div>
        </div>
        <div class="form-group"><label for="preset-persona-input">È¢ÑËÆæ‰∫∫ËÆæ</label><textarea id="preset-persona-input" rows="4" placeholder="Âú®Ê≠§ËæìÂÖ•Ëøô‰∏™‰∫∫ËÆæÁöÑËØ¶ÁªÜËÆæÂÆö..."></textarea></div>
      </div>
      <div class="modal-footer"><button class="cancel" id="cancel-persona-editor-btn"data-lang-key="cancel">ÂèñÊ∂à</button><button class="save" id="save-persona-preset-btn"data-lang-key="save">‰øùÂ≠ò</button></div>
    </div>
  </div>
  <div id="member-settings-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header"><span data-lang-key="edit">ÁºñËæëÁæ§ÊàêÂëò</span></div>
      <div class="modal-body">
        <div class="form-group"><label for="member-name-input">ÂêçÂ≠ó</label><input type="text" id="member-name-input"></div>
        <div class="form-group"><label for="member-persona-input">‰∫∫ËÆæ</label><textarea id="member-persona-input" rows="4"></textarea></div>
        <div class="form-group"><label>Â§¥ÂÉè</label>
          <div class="avatar-upload"><img id="member-avatar-preview"><button onclick="document.getElementById('member-avatar-input').click()">‰∏ä‰º†Â§¥ÂÉè</button><button class="change-frame-btn" data-type="member">Êõ¥Êç¢Â§¥ÂÉèÊ°Ü</button><input type="file" id="member-avatar-input" accept="image/*"></div>
        </div>
      </div>
      <div class="modal-footer"><button class="cancel" id="cancel-member-settings-btn"data-lang-key="cancel">ÂèñÊ∂à</button><button class="save" id="save-member-settings-btn"data-lang-key="save">‰øùÂ≠ò</button></div>
    </div>
  </div>
  <div id="custom-modal-overlay">
    <div id="custom-modal">
      <div class="custom-modal-header" id="custom-modal-title"></div>
      <div class="custom-modal-body" id="custom-modal-body"></div>
      <div class="custom-modal-footer"> <button id="custom-modal-cancel"data-lang-key="cancel">ÂèñÊ∂à</button> <button id="custom-modal-confirm" class="confirm-btn"data-lang-key="confirm">Á°ÆÂÆö</button> </div>
    </div>
  </div>
  
  <!-- ÊâãÂä®ÊÄªÁªìÂºπÁ™ó -->
  <div id="manual-summary-modal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 400px; width: 90%;">
      <div class="modal-header">
        <span>ÊâãÂä®ÊÄªÁªìÈïøÊúüËÆ∞ÂøÜ</span>
        <span class="close-btn" id="manual-summary-close-btn" style="cursor: pointer; font-size: 24px;">&times;</span>
      </div>
      <div class="modal-body" style="padding: 20px;">
        <div class="form-group" style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 8px; color: #333;">ÈÄâÊã©Ê∂àÊÅØËåÉÂõ¥</label>
          <div style="display: flex; gap: 10px; align-items: center;">
            <div style="flex: 1;">
              <label style="font-size: 12px; color: #666;">‰ªéÁ¨¨</label>
              <input type="number" id="manual-summary-start" min="1" value="1" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-top: 4px;">
            </div>
            <span style="color: #666;">Âà∞</span>
            <div style="flex: 1;">
              <label style="font-size: 12px; color: #666;">Á¨¨</label>
              <input type="number" id="manual-summary-end" min="1" value="20" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-top: 4px;">
            </div>
            <span style="color: #666;">Êù°</span>
          </div>
          <div style="margin-top: 8px; font-size: 12px; color: #999;">
            ÂΩìÂâçËÅäÂ§©ÂÖ±Êúâ <span id="manual-summary-total-count">0</span> Êù°Ê∂àÊÅØ
          </div>
        </div>
      </div>
      <div class="modal-footer" style="padding: 15px; display: flex; gap: 10px; justify-content: flex-end;">
        <button id="manual-summary-cancel-btn" style="padding: 8px 20px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;">ÂèñÊ∂à</button>
        <button id="manual-summary-confirm-btn" style="padding: 8px 20px; border: none; background: var(--accent-color); color: white; border-radius: 4px; cursor: pointer;">ÂºÄÂßãÊÄªÁªì</button>
      </div>
    </div>
  </div>
  
  <div id="preset-actions-modal" class="modal">
    <div id="custom-modal" style="width: 250px;">
      <div class="custom-modal-footer"> <button id="preset-action-edit" data-lang-key="edit">ÁºñËæëÈ¢ÑËÆæ</button> <button id="preset-action-delete" class="btn-danger">Âà†Èô§È¢ÑËÆæ</button> <button id="preset-action-cancel" style="margin-top: 8px; border-radius: 8px; background-color: #f0f0f0;"data-lang-key="cancel">ÂèñÊ∂à</button> </div>
    </div>
  </div>
  <div id="transfer-modal">
    <div class="transfer-content">
      <div class="transfer-header">ÁªôTa‰∏Ä‰∏™ÊÉäÂñúÔºÅ</div>
      <div class="transfer-input-group"> <label for="transfer-amount">ËΩ¨Ë¥¶ÈáëÈ¢ù</label> <input type="number" id="transfer-amount" placeholder="0.00" min="0" step="0.01"> </div>
      <div class="transfer-input-group"> <label for="transfer-note">Â§áÊ≥® (ÂèØÈÄâ)</label> <input type="text" id="transfer-note" placeholder="Áïô‰∏ã‰Ω†ÁöÑÂ∞èÂøÉÊÄù~" maxlength="20"> </div>
      <div class="transfer-actions"> <button id="transfer-cancel-btn" data-lang-key="cancel">ÂèñÊ∂à</button> <button id="transfer-confirm-btn">Á°ÆËÆ§ËΩ¨Ë¥¶</button> </div>
    </div>
  </div>
  <div id="battery-alert-modal">
    <div class="battery-alert-content"> <img id="battery-alert-image" src="">
      <p id="battery-alert-text"></p>
    </div>
  </div>
  <div id="waimai-request-modal" class="modal">
    <div class="modal-content" style="width: 290px;">
      <div class="modal-header"> <span>ÂèëËµ∑Â§ñÂçñËÆ¢Âçï</span> </div>
      <div class="modal-body">
        <div class="form-group"> <label for="waimai-product-info">ÂïÜÂìÅ‰ø°ÊÅØ</label> <input type="text" id="waimai-product-info" placeholder="‰æãÂ¶ÇÔºö‰∏ÄÊùØÊù®ÊûùÁîòÈú≤"> </div>
        <div class="form-group"> <label for="waimai-amount">ËÆ¢ÂçïÈáëÈ¢ù (ÂÖÉ)</label> <input type="number" id="waimai-amount" placeholder="‰æãÂ¶ÇÔºö21" min="0" step="0.01"> </div>
      </div>
      <div class="modal-footer"> <button class="save" id="waimai-order-for-ai-btn">‰∏∫TAÁÇπÂçï</button> <button class="save" id="waimai-confirm-btn">ÂèëËµ∑ËØ∑Ê±Ç</button> </div>
    </div>
  </div>
  <div id="create-countdown-modal" class="modal">
    <div class="modal-content" style="height: auto;">
      <div class="modal-header"> <span>Êñ∞Âª∫Á∫¶ÂÆö</span> </div>
      <div class="modal-body">
        <div class="form-group"> <label for="countdown-title-input">Á∫¶ÂÆöÊ†áÈ¢ò</label> <input type="text" id="countdown-title-input" placeholder="‰æãÂ¶ÇÔºöÊàëÁöÑÁîüÊó•"> </div>
        <div class="form-group"> <label for="countdown-date-input">Á∫¶ÂÆöÊó•Êúü‰∏éÊó∂Èó¥</label> <input type="datetime-local" id="countdown-date-input"> </div>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-create-countdown-btn"data-lang-key="cancel">ÂèñÊ∂à</button> <button class="save" id="confirm-create-countdown-btn"data-lang-key="save">‰øùÂ≠òÁ∫¶ÂÆö</button> </div>
    </div>
  </div>
  <div id="red-packet-modal" class="modal">
    <div class="modal-content" style="width: 300px; height: auto;">
      <div class="modal-header"> <span>ÂèëÁ∫¢ÂåÖ</span> </div>
      <div class="modal-body" style="padding: 0;">
        <div class="frame-tabs">
          <div id="rp-tab-group" class="frame-tab active">ÊãºÊâãÊ∞îÁ∫¢ÂåÖ</div>
          <div id="rp-tab-direct" class="frame-tab">‰∏ìÂ±ûÁ∫¢ÂåÖ</div>
        </div>
        <div id="rp-content-group" class="frame-content" style="padding: 20px 15px;">
          <div class="form-group"> <label>ÊÄªÈáëÈ¢ù (ÂÖÉ)</label> <input type="number" id="rp-group-amount" placeholder="0.00"> </div>
          <div class="form-group"> <label>Á∫¢ÂåÖ‰∏™Êï∞</label> <input type="number" id="rp-group-count" placeholder="Â°´ÂÜôÁ∫¢ÂåÖ‰∏™Êï∞"> </div>
          <div class="form-group"> <label>Á•ùÁ¶èËØ≠</label> <input type="text" id="rp-group-greeting" placeholder="ÊÅ≠ÂñúÂèëË¥¢ÔºåÂ§ßÂêâÂ§ßÂà©ÔºÅ"> </div>
          <p id="rp-group-total" style="text-align: center; font-size: 24px; font-weight: bold; margin: 10px 0;">¬• 0.00</p> <button id="send-group-packet-btn" class="form-button">Â°ûÈí±ËøõÁ∫¢ÂåÖ</button>
        </div>
        <div id="rp-content-direct" class="frame-content" style="display: none; padding: 20px 15px;">
          <div class="form-group"> <label>ÂèëÈÄÅÁªô</label> <select id="rp-direct-receiver"></select> </div>
          <div class="form-group"> <label>ÈáëÈ¢ù (ÂÖÉ)</label> <input type="number" id="rp-direct-amount" placeholder="0.00"> </div>
          <div class="form-group"> <label>Á•ùÁ¶èËØ≠</label> <input type="text" id="rp-direct-greeting" placeholder="ÊÅ≠ÂñúÂèëË¥¢ÔºåÂ§ßÂêâÂ§ßÂà©ÔºÅ"> </div>
          <p id="rp-direct-total" style="text-align: center; font-size: 24px; font-weight: bold; margin: 10px 0;">¬• 0.00</p> <button id="send-direct-packet-btn" class="form-button">Â°ûÈí±ËøõÁ∫¢ÂåÖ</button>
        </div>
      </div>
      <div class="modal-footer" style="justify-content: center;"> <button class="cancel" id="cancel-red-packet-btn" style="width: 100%;"data-lang-key="cancel">ÂèñÊ∂à</button> </div>
    </div>
  </div>
  <div id="red-packet-details-modal" class="modal">
    <div class="modal-content" style="width: 280px; height: auto; background-color: #f7f7f7;">
      <div class="modal-header" style="background-color: #F96259; color: white; border-bottom: none; padding-bottom: 5px;">
        <div style="text-align: center; width: 100%;">
          <div id="rp-details-sender" style="font-size: 16px;"></div>
          <div style="font-size: 13px; opacity: 0.8;">ÁöÑÁ∫¢ÂåÖ</div>
        </div>
      </div>
      <div class="modal-body" style="padding: 15px;">
        <p id="rp-details-greeting" style="text-align: center; font-size: 20px; color: #333; margin: 0 0 20px 0;"></p>
        <div id="rp-details-my-amount" style="text-align: center; display: none; margin-bottom: 20px;"> <span style="font-size: 40px; font-weight: bold; color: #E44D44;">0.00</span> <span style="font-size: 18px; color: #E44D44;">ÂÖÉ</span> </div>
        <div id="rp-details-summary" style="font-size: 13px; color: #8a8a8a; border-top: 1px solid #e0e0e0; padding-top: 10px;"></div>
        <div id="rp-details-list" style="max-height: 150px; overflow-y: auto; margin-top: 10px;"> </div>
      </div>
      <div class="modal-footer"> <button class="save" id="close-rp-details-btn" style="width: 100%;">ÂÖ≥Èó≠</button> </div>
    </div>
  </div>
  <div id="create-poll-modal" class="modal">
    <div class="modal-content" style="width: 300px; height: auto;">
      <div class="modal-header"> <span>ÂèëËµ∑ÊäïÁ•®</span> </div>
      <div class="modal-body">
        <div class="form-group"> <label for="poll-question-input">ÊäïÁ•®ÈóÆÈ¢ò</label> <textarea id="poll-question-input" rows="2" placeholder="‰æãÂ¶ÇÔºö‰ªäÊôöÊàë‰ª¨Áúã‰ªÄ‰πàÁîµÂΩ±Ôºü"></textarea> </div>
        <div class="form-group"> <label>ÊäïÁ•®ÈÄâÈ°π (Ëá≥Â∞ë2È°π)</label>
          <div id="poll-options-container" style="display: flex; flex-direction: column; gap: 8px;"> </div> <button id="add-poll-option-btn" class="form-button form-button-secondary" style="margin-top: 12px;">+ Ê∑ªÂä†ÈÄâÈ°π</button>
        </div>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-create-poll-btn" data-lang-key="cancel">ÂèñÊ∂à</button> <button class="save" id="confirm-create-poll-btn">ÂèëËµ∑ÊäïÁ•®</button> </div>
    </div>
  </div>
  <div id="ai-avatar-library-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span id="ai-avatar-library-title">ÂØπÊñπÁöÑÂ§¥ÂÉèÂ∫ì</span>
        <div class="header-actions"> <button id="add-ai-avatar-batch-btn" class="action-button">ÊâπÈáè</button> <button id="add-ai-avatar-url-btn" class="action-button">URL</button> <button id="add-ai-avatar-upload-btn" class="action-button">‰∏ä‰º†</button> </div>
      </div>
      <div class="modal-body" style="padding: 15px;">
        <div id="ai-avatar-library-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 15px;"> </div>
      </div>
      <div class="modal-footer"> <button class="save" id="close-ai-avatar-library-btn" style="width: 100%;">ÂÖ≥Èó≠</button> </div>
    </div>
  </div>
  <div id="my-avatar-library-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span id="my-avatar-library-title">ÊàëÁöÑÂ§¥ÂÉèÂ∫ì</span>
        <div class="header-actions"> <button id="add-my-avatar-batch-btn" class="action-button">ÊâπÈáè</button> <button id="add-my-avatar-url-btn" class="action-button">URL</button> <button id="add-my-avatar-upload-btn" class="action-button">‰∏ä‰º†</button> </div>
      </div>
      <div class="modal-body" style="padding: 15px;">
        <div id="my-avatar-library-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 15px;"> </div>
      </div>
      <div class="modal-footer"> <button class="save" id="close-my-avatar-library-btn" style="width: 100%;">ÂÖ≥Èó≠</button> </div>
    </div>
  </div>
  <div id="group-avatar-library-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span id="group-avatar-library-title">Áæ§Â§¥ÂÉèÂ∫ì</span>
        <div class="header-actions"> <button id="add-group-avatar-batch-btn" class="action-button">ÊâπÈáè</button> <button id="add-group-avatar-url-btn" class="action-button">URL</button> <button id="add-group-avatar-upload-btn" class="action-button">‰∏ä‰º†</button> </div>
      </div>
      <div class="modal-body" style="padding: 15px;">
        <div id="group-avatar-library-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 15px;"> </div>
      </div>
      <div class="modal-footer"> <button class="save" id="close-group-avatar-library-btn" style="width: 100%;">ÂÖ≥Èó≠</button> </div>
    </div>
  </div>
  <div id="chat-list-actions-modal" class="modal">
    <div id="custom-modal" style="width: 250px;">
      <div class="custom-modal-footer"> <button id="chat-list-action-pin"></button> <button id="chat-list-action-delete" class="btn-danger">Âà†Èô§ËÅäÂ§©</button> <button id="chat-list-action-cancel" style="margin-top: 8px; border-radius: 8px; background-color: #f0f0f0;"data-lang-key="cancel">ÂèñÊ∂à</button> </div>
    </div>
  </div>
  <div id="share-link-modal" class="modal">
    <div class="modal-content" style="width: 300px; height: auto;">
      <div class="modal-header"> <span>ÂàÜ‰∫´ÈìæÊé•</span> </div>
      <div class="modal-body">
        <div class="form-group"> <label for="link-title-input">Ê†áÈ¢ò</label> <input type="text" id="link-title-input" placeholder="ËæìÂÖ•ÊñáÁ´†ÊàñÈìæÊé•ÁöÑÊ†áÈ¢ò"> </div>
        <div class="form-group"> <label for="link-description-input">ÊëòË¶Å (ÂèØÈÄâ)</label> <textarea id="link-description-input" rows="2" placeholder="ÁÆÄÂçïÊèèËø∞‰∏Ä‰∏ãÈìæÊé•ÂÜÖÂÆπ"></textarea> </div>
        <div class="form-group"> <label for="link-source-input">Êù•Ê∫êÂêçÁß∞ (ÂèØÈÄâ)</label> <input type="text" id="link-source-input" placeholder="‰æãÂ¶ÇÔºöÁü•‰πéÊó•Êä•„ÄÅBÁ´ô"> </div>
        <div class="form-group"> <label for="link-content-input">ÂÆåÊï¥ÂÜÖÂÆπ (ÂèØÈÄâÔºåÁî®‰∫éÊµèËßàÂô®ÂÜÖÊòæÁ§∫)</label> <textarea id="link-content-input" rows="4" placeholder="Á≤òË¥¥ÊàñËæìÂÖ•ÂÆåÊï¥ÁöÑÊñáÁ´†ÂÜÖÂÆπ"></textarea> </div>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-share-link-btn"data-lang-key="cancel">ÂèñÊ∂à</button> <button class="save" id="confirm-share-link-btn">ÂàÜ‰∫´</button> </div>
    </div>
  </div>
  <div id="transfer-actions-modal" class="modal">
    <div class="transfer-actions-content">
      <div class="transfer-actions-header">ËØ∑ÈÄâÊã©Êìç‰Ωú</div>
      <div class="transfer-actions-body">
        <p>‰Ω†Êî∂Âà∞‰∫ÜÊù•Ëá™ <strong id="transfer-sender-name"></strong> ÁöÑ‰∏ÄÁ¨îËΩ¨Ë¥¶„ÄÇ</p>
      </div>
      <div class="transfer-actions-footer"> <button id="transfer-action-decline" class="action-btn decline">ÊÆãÂøçÊãíÁªù</button> <button id="transfer-action-accept" class="action-btn accept">ÂºÄÂøÉÊî∂‰∏ã</button> </div> <button id="transfer-action-cancel" class="cancel-btn">√ó</button>
    </div>
  </div>
  <div id="call-transcript-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span id="transcript-modal-title">ÈÄöËØùËØ¶ÊÉÖ</span> </div>
      <div class="modal-body" id="call-transcript-modal-body" style="background-color: #f0f2f5;"> </div>
      <div class="modal-footer"> <button class="cancel" id="delete-transcript-btn" style="background-color: #ff3b30; color: white; border-color: #ff3b30;">Âà†Èô§ËÆ∞ÂΩï</button> <button class="save" id="manual-summarize-btn" style="background-color: #ffc107; border-color: #ffc107;">ÊâãÂä®ÊÄªÁªì</button>
        <button class="save" id="close-call-transcript-btn" style="width: 100%;">ÂÖ≥Èó≠</button>
      </div>
    </div>
  </div>
  <div id="share-target-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span>ÂàÜ‰∫´Âà∞...</span> </div>
      <div class="modal-body" id="share-target-list" style="padding: 0;"> </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-share-target-btn"data-lang-key="cancel">ÂèñÊ∂à</button> <button class="save" id="confirm-share-target-btn">Á°ÆËÆ§ÂàÜ‰∫´</button> </div>
    </div>
  </div>
  <div id="forward-target-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span>ËΩ¨ÂèëÂà∞...</span> </div>
      <div class="modal-body" id="forward-target-list" style="padding: 0;"> </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-forward-target-btn"data-lang-key="cancel">ÂèñÊ∂à</button> <button class="save" id="confirm-forward-target-btn">Á°ÆËÆ§ËΩ¨Âèë</button> </div>
    </div>
  </div>
  <div id="shared-history-viewer-modal" class="modal">
    <div class="modal-content" style="height: 80%;">
      <div class="modal-header"> <span id="shared-history-viewer-title">ËÅäÂ§©ËÆ∞ÂΩï</span> </div>
      <div class="modal-body" id="shared-history-viewer-content" style="background-color: #f0f2f5;"> </div>
      <div class="modal-footer"> <button class="save" id="close-shared-history-viewer-btn" style="width:100%;">ÂÖ≥Èó≠</button> </div>
    </div>
  </div>
  <div id="world-book-category-manager-modal" class="modal">
    <div class="modal-content" style="height: 60%;">
      <div class="modal-header"> <span>ÁÆ°ÁêÜ‰∏ñÁïå‰π¶ÂàÜÁ±ª</span> </div>
      <div class="modal-body">
        <div class="form-group"> <label>Êñ∞Âª∫ÂàÜÁ±ª</label>
          <div style="display: flex; gap: 10px;"> <input type="text" id="new-category-name-input" placeholder="ËæìÂÖ•ÂàÜÁ±ªÂêç..." style="flex-grow: 1;"> <button id="add-new-category-btn" class="form-button" style="width: auto; margin-top: 0; padding: 0 15px;"data-lang-key="add">Ê∑ªÂä†</button> </div>
        </div>
        <hr style="opacity: 0.2;">
        <div id="existing-categories-list" style="display: flex; flex-direction: column; gap: 10px;"> </div>
      </div>
      <div class="modal-footer"> <button class="save" id="close-category-manager-btn" style="width: 100%;"data-lang-key="done">ÂÆåÊàê</button> </div>
    </div>
  </div>
  <div id="announcement-board-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header"> <span>Áæ§ÂÖ¨ÂëäÊùø</span> </div>
      <div id="announcement-board-content"> </div>
      <div class="modal-footer"> <button class="save" id="close-announcement-board-btn" style="width: 100%;">ÂÖ≥Èó≠</button> </div>
    </div>
  </div>
  <div id="announcement-actions-modal" class="modal">
    <div id="custom-modal" style="width: 250px;">
      <div class="custom-modal-footer"> <button id="announcement-action-pin">ÁΩÆÈ°∂ÂÖ¨Âëä</button> <button id="announcement-action-delete" class="btn-danger">Âà†Èô§ÂÖ¨Âëä</button> <button id="announcement-action-cancel" style="margin-top: 8px; border-radius: 8px; background-color: #f0f0f0;"data-lang-key="cancel">ÂèñÊ∂à</button> </div>
    </div>
  </div>
  <div id="truth-game-modal" class="modal">
    <div class="modal-content" style="height: 85%; max-width: 600px; display: flex; flex-direction: column;">
      <div class="modal-header" style="position: relative; border-bottom: 1px solid #e0e0e0; padding: 15px 20px; display: flex; align-items: center; justify-content: space-between;">
        <span style="font-size: 16px; font-weight: 500;">ÁúüÂøÉËØù</span>
        <div style="display: flex; gap: 10px; align-items: center;">
          <button id="truth-game-settings-btn" style="background: none; border: none; font-size: 20px; cursor: pointer; color: #999; line-height: 1; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">‚öô</button>
          <button id="minimize-truth-game-btn" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999; line-height: 1; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">‚àí</button>
          <button id="close-truth-game-btn" style="background: none; border: none; font-size: 28px; cursor: pointer; color: #999; line-height: 1; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">√ó</button>
        </div>
      </div>
      <div class="modal-body" style="flex: 1; overflow-y: auto; background-color: #f5f5f5; padding: 0; display: flex; flex-direction: column;">
        <div id="truth-game-messages" style="flex: 1; overflow-y: auto; padding: 15px;"></div>
      </div>
      <div id="truth-game-input-area" style="background: #fff; border-top: 1px solid #e0e0e0; padding: 10px 15px;">
        <div id="truth-rps-selector" style="display: none; gap: 8px; margin-bottom: 10px;">
          <button class="truth-rps-btn" data-choice="rock" style="flex: 1; padding: 10px; background: #fff; border: 1px solid #d0d0d0; border-radius: 4px; cursor: pointer; font-size: 14px; color: #333;">Áü≥Â§¥</button>
          <button class="truth-rps-btn" data-choice="scissors" style="flex: 1; padding: 10px; background: #fff; border: 1px solid #d0d0d0; border-radius: 4px; cursor: pointer; font-size: 14px; color: #333;">Ââ™ÂàÄ</button>
          <button class="truth-rps-btn" data-choice="paper" style="flex: 1; padding: 10px; background: #fff; border: 1px solid #d0d0d0; border-radius: 4px; cursor: pointer; font-size: 14px; color: #333;">Â∏É</button>
        </div>
        <div style="display: flex; gap: 10px; align-items: flex-end; flex-wrap: wrap;">
          <textarea id="truth-input" rows="1" placeholder="ËæìÂÖ•Ê∂àÊÅØ..." style="flex: 1 1 100%; padding: 10px; border: 1px solid #d0d0d0; border-radius: 4px; resize: none; font-size: 14px; min-height: 40px; max-height: 100px; min-width: 0;"></textarea>
          <div id="truth-game-buttons" style="display: flex; gap: 8px; flex: 1 1 100%;">
            <button id="truth-start-game-btn" style="flex: 1; padding: 10px 12px; background: #ff9500; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; color: white; white-space: nowrap;">ÂºÄÂßãÊ∏∏Êàè</button>
            <button id="truth-call-api-btn" style="flex: 1; padding: 10px 12px; background: #fff; border: 1px solid #d0d0d0; border-radius: 4px; cursor: pointer; font-size: 14px; color: #333; white-space: nowrap;">Ë∞ÉÁî®API</button>
            <button id="truth-send-btn" style="flex: 1; padding: 10px 12px; background: #07c160; border: none; border-radius: 4px; cursor: pointer; color: white; font-size: 14px; white-space: nowrap;">ÂèëÈÄÅ</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="truth-game-settings-modal" class="modal">
    <div class="modal-content" style="width: 350px; height: auto;">
      <div class="modal-header">
        <span>ÁúüÂøÉËØùËÆæÁΩÆ</span>
      </div>
      <div class="modal-body" style="padding: 20px;">
        <div class="form-group">
          <label>AIÂèÇËÄÉÂéÜÂè≤ËΩÆÊï∞</label>
          <input type="number" id="truth-history-limit-input" min="1" value="5" style="width: 100%; padding: 8px; border: 1px solid #d0d0d0; border-radius: 4px;">
          <p style="font-size: 12px; color: #999; margin-top: 5px;">ÈôêÂà∂AIÂèÇËÄÉÁöÑÂéÜÂè≤ËΩÆÊï∞ÔºåÈÅøÂÖçtokenËøáÂ§ß„ÄÇÂª∫ËÆÆËÆæÁΩÆ‰∏∫5-20ËΩÆÔºåËÆæÁΩÆËøáÂ§ß‰ºöÊ∂àËÄóÊõ¥Â§ötoken„ÄÇÂÆåÊï¥ËÆ∞ÂΩï‰ªç‰ºö‰øùÂ≠òÂà∞ËÅäÂ§©ÂéÜÂè≤„ÄÇ</p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel" id="cancel-truth-settings-btn">ÂèñÊ∂à</button>
        <button class="save" id="save-truth-settings-btn">‰øùÂ≠ò</button>
      </div>
    </div>
  </div>
  <div id="truth-game-float-ball" style="display: none;">
    <img id="truth-game-float-avatar" src="" alt="ËßíËâ≤Â§¥ÂÉè">
    <div id="truth-game-float-indicator"></div>
  </div>
  <div id="watch-together-modal" class="modal">
    <div id="watch-together-container">
      <div id="watch-together-header">
        <span style="font-size: 16px; font-weight: 500;">‰∏ÄËµ∑ÁúãÁîµÂΩ±</span>
        <div style="display: flex; gap: 10px; align-items: center;">
          <button id="watch-together-playlist-btn" style="font-size: 16px;">Êí≠ÊîæÂàóË°®</button>
          <button id="watch-together-settings-btn" style="font-size: 16px;">ËÆæÁΩÆ</button>
          <button id="watch-together-upload-btn" style="font-size: 20px; font-weight: bold;">+</button>
          <button id="close-watch-together-btn" style="font-size: 24px;">√ó</button>
        </div>
      </div>
      <div id="watch-together-main">
        <div id="watch-together-video-container">
          <video id="watch-together-video" controls></video>
          <div id="watch-together-placeholder">
            <p>ÁÇπÂáªÂè≥‰∏äËßí"+"‰∏ä‰º†ËßÜÈ¢ëÂºÄÂßãËßÇÁúã</p>
          </div>
        </div>
        <div id="watch-together-chat-float">
          <div id="watch-together-chat-header">
            <span id="watch-together-chat-name"></span>
            <button id="watch-together-chat-toggle">-</button>
          </div>
          <div id="watch-together-chat-messages"></div>
          <div id="watch-together-chat-input-area">
            <textarea id="watch-together-chat-input" rows="1" placeholder="ËæìÂÖ•Ê∂àÊÅØ..."></textarea>
            <button id="watch-together-call-api-btn">Ë∞ÉÁî®API</button>
            <button id="watch-together-chat-send">ÂèëÈÄÅ</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="watch-together-upload-modal" class="modal" style="z-index: 10001;">
    <div class="modal-content" style="width: 400px; height: auto;">
      <div class="modal-header">
        <span>‰∏ä‰º†ËßÜÈ¢ë</span>
      </div>
      <div class="modal-body" style="padding: 20px;">
        <div style="display: flex; flex-direction: column; gap: 15px;">
          <button id="watch-together-upload-local" style="padding: 15px; background: #fff; border: 1px solid #d0d0d0; border-radius: 4px; cursor: pointer; font-size: 14px;">Êú¨Âú∞‰∏ä‰º†</button>
          <button id="watch-together-upload-url" style="padding: 15px; background: #fff; border: 1px solid #d0d0d0; border-radius: 4px; cursor: pointer; font-size: 14px;">URL‰∏ä‰º†</button>
          <button id="watch-together-search-online" style="padding: 15px; background: #fff; border: 1px solid #d0d0d0; border-radius: 4px; cursor: pointer; font-size: 14px;">Âú®Á∫øÊêúÁ¥¢ÂΩ±ËßÜ</button>
        </div>
        <input type="file" id="watch-together-file-input" accept="video/*" style="display: none;">
      </div>
      <div class="modal-footer">
        <button class="cancel" id="cancel-watch-together-upload-btn">ÂèñÊ∂à</button>
      </div>
    </div>
  </div>
  <div id="watch-together-url-modal" class="modal" style="z-index: 10001;">
    <div class="modal-content" style="width: 450px; height: auto;">
      <div class="modal-header">
        <span>ËæìÂÖ•ËßÜÈ¢ëURL</span>
      </div>
      <div class="modal-body" style="padding: 20px;">
        <input type="text" id="watch-together-url-input" placeholder="ËæìÂÖ•ËßÜÈ¢ëURL..." style="width: 100%; padding: 10px; border: 1px solid #d0d0d0; border-radius: 4px; font-size: 14px;">
      </div>
      <div class="modal-footer">
        <button class="cancel" id="cancel-watch-together-url-btn">ÂèñÊ∂à</button>
        <button class="save" id="confirm-watch-together-url-btn">Á°ÆÂÆö</button>
      </div>
    </div>
  </div>
  <div id="watch-together-search-modal" class="modal" style="z-index: 10002;">
    <div class="modal-content" style="width: 800px; height: 600px; max-width: 90vw; max-height: 90vh;">
      <div class="modal-header">
        <span>Âú®Á∫øÊêúÁ¥¢ÂΩ±ËßÜ</span>
      </div>
      <div class="modal-body" style="padding: 20px; display: flex; flex-direction: column; height: calc(100% - 100px);">
        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
          <input type="text" id="watch-together-search-input" placeholder="ËæìÂÖ•ÂΩ±ÁâáÂêçÁß∞ÊêúÁ¥¢..." style="flex: 1; padding: 10px; border: 1px solid #d0d0d0; border-radius: 4px; font-size: 14px;">
          <button id="watch-together-search-btn" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: 500;">ÊêúÁ¥¢</button>
        </div>
        <div id="watch-together-search-status" style="margin-bottom: 10px; color: #666; font-size: 13px; min-height: 20px;"></div>
        <div id="watch-together-search-results" style="flex: 1; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 4px; padding: 10px;">
          <div style="text-align: center; color: #999; padding: 40px;">Âú®‰∏äÊñπËæìÂÖ•ÂΩ±ÁâáÂêçÁß∞ÂºÄÂßãÊêúÁ¥¢</div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel" id="cancel-watch-together-search-btn">ÂèñÊ∂à</button>
      </div>
    </div>
  </div>
  <div id="watch-together-playlist-modal" class="modal" style="z-index: 10001;">
    <div class="modal-content" style="width: 600px; max-width: 90vw; height: 70vh;">
      <div class="modal-header">
        <span>Êí≠ÊîæÂàóË°®</span>
        <button id="close-watch-together-playlist-btn" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">√ó</button>
      </div>
      <div class="modal-body" style="padding: 15px; overflow-y: auto;">
        <div id="watch-together-playlist-list" style="display: flex; flex-direction: column; gap: 10px;">
          <p style="text-align: center; color: #999; padding: 40px;">ÊöÇÊó†ËßÜÈ¢ëÔºå‰∏ä‰º†ËßÜÈ¢ëÂêéÂèØ‰øùÂ≠òÂà∞ÂàóË°®</p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel" id="cancel-watch-together-playlist-btn">ÂÖ≥Èó≠</button>
      </div>
    </div>
  </div>
  <div id="watch-together-save-video-modal" class="modal" style="z-index: 10002;">
    <div class="modal-content" style="width: 400px; height: auto;">
      <div class="modal-header">
        <span>‰øùÂ≠òËßÜÈ¢ëÂà∞Êí≠ÊîæÂàóË°®</span>
      </div>
      <div class="modal-body" style="padding: 20px;">
        <div class="form-group">
          <label style="display: block; margin-bottom: 8px; font-size: 14px; color: #333;">ËßÜÈ¢ëÂêçÁß∞</label>
          <input type="text" id="watch-together-video-name-input" placeholder="ËæìÂÖ•ËßÜÈ¢ëÂêçÁß∞..." style="width: 100%; padding: 10px; border: 1px solid #d0d0d0; border-radius: 4px; font-size: 14px;">
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel" id="cancel-save-video-btn">ÂèñÊ∂à</button>
        <button class="save" id="confirm-save-video-btn">‰øùÂ≠ò</button>
      </div>
    </div>
  </div>
  <div id="watch-together-settings-modal" class="modal" style="z-index: 10001;">
    <div class="modal-content" style="width: 450px; height: auto;">
      <div class="modal-header">
        <span>ËßÇÂΩ±ËÆæÁΩÆ</span>
      </div>
      <div class="modal-body" style="padding: 20px;">
        <div class="form-group" style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 8px; font-size: 14px; color: #333;">ËÅäÂ§©Ê®°Âºè</label>
          <select id="watch-together-mode-select" style="width: 100%; padding: 8px; border: 1px solid #d0d0d0; border-radius: 4px;">
            <option value="online">Á∫ø‰∏äÊ®°ÂºèÔºàAIÂèØÂèëÈÄÅÂ§öÊù°Ê∂àÊÅØÔºâ</option>
            <option value="offline">Á∫ø‰∏ãÊ®°ÂºèÔºàÂçïÊù°ÈïøÊñáÊú¨Ôºâ</option>
          </select>
          <p style="font-size: 12px; color: #999; margin-top: 5px;">Á∫ø‰∏äÊ®°ÂºèÁ±ª‰ººÊôÆÈÄöËÅäÂ§©ÔºåAIÂèØ‰ª•ÂèëÈÄÅÂ§öÊù°Ê∂àÊÅØÔºõÁ∫ø‰∏ãÊ®°ÂºèAIÂè™ÂèëÈÄÅ‰∏ÄÊù°ÂÆåÊï¥ÂõûÂ§ç</p>
        </div>
        <div class="form-group" style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 8px; font-size: 14px; color: #333;">Êà™ÂõæÈó¥Èöî (Áßí)</label>
          <input type="number" id="watch-together-interval-input" min="1" max="60" value="5" style="width: 100%; padding: 8px; border: 1px solid #d0d0d0; border-radius: 4px;">
          <p style="font-size: 12px; color: #999; margin-top: 5px;">ÂÆöÊó∂Êà™ÂèñËßÜÈ¢ëÁîªÈù¢ÂèëÈÄÅÁªôAIÔºåÂ∏ÆÂä©AIÁêÜËß£ËßÜÈ¢ëÂÜÖÂÆπ</p>
        </div>
        <div class="form-group" style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 8px; font-size: 14px; color: #333;">ËØ≠Èü≥ËØÜÂà´</label>
          <select id="watch-together-speech-api-select" style="width: 100%; padding: 8px; border: 1px solid #d0d0d0; border-radius: 4px;">
            <option value="none">‰∏çËØÜÂà´ËßÜÈ¢ëÈü≥È¢ë</option>
            <option value="whisper">Whisper API</option>
          </select>
        </div>
        <div id="watch-together-whisper-config" style="display: none;">
          <div class="form-group" style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-size: 14px; color: #333;">Whisper API Key</label>
            <input type="text" id="watch-together-whisper-key" placeholder="sk-..." style="width: 100%; padding: 8px; border: 1px solid #d0d0d0; border-radius: 4px;">
          </div>
          <div class="form-group" style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-size: 14px; color: #333;">Whisper API URL</label>
            <input type="text" id="watch-together-whisper-url" placeholder="https://api.openai.com/v1/audio/transcriptions" style="width: 100%; padding: 8px; border: 1px solid #d0d0d0; border-radius: 4px;">
          </div>
        </div>
        <div class="form-group" style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 8px; font-size: 14px; color: #333;">ËÆ∞‰ΩèÂéÜÂè≤Êà™ÂõæÊï∞Èáè</label>
          <input type="number" id="watch-together-max-screenshots" min="1" max="50" value="10" style="width: 100%; padding: 8px; border: 1px solid #d0d0d0; border-radius: 4px;">
          <p style="font-size: 12px; color: #999; margin-top: 5px;">AIËÉΩËÆ∞‰ΩèÁöÑÂéÜÂè≤Êà™ÂõæÊï∞ÈáèÔºåË∂ÖÂá∫ÈÉ®ÂàÜÂ∞ÜË¢´Âà†Èô§</p>
        </div>
        <div class="form-group" style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 8px; font-size: 14px; color: #333;">ËÆ∞‰ΩèÂéÜÂè≤Â£∞Èü≥Êï∞Èáè</label>
          <input type="number" id="watch-together-max-audios" min="1" max="50" value="10" style="width: 100%; padding: 8px; border: 1px solid #d0d0d0; border-radius: 4px;">
          <p style="font-size: 12px; color: #999; margin-top: 5px;">AIËÉΩËÆ∞‰ΩèÁöÑÂéÜÂè≤ËØ≠Èü≥ËØÜÂà´Êï∞ÈáèÔºåË∂ÖÂá∫ÈÉ®ÂàÜÂ∞ÜË¢´Âà†Èô§</p>
        </div>
        <div class="form-group" style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 8px; font-size: 14px; color: #333;">ËÆ∞‰ΩèÊúÄËøëÂØπËØùÊù°Êï∞</label>
          <input type="number" id="watch-together-max-messages" min="5" max="100" value="20" style="width: 100%; padding: 8px; border: 1px solid #d0d0d0; border-radius: 4px;">
          <p style="font-size: 12px; color: #999; margin-top: 5px;">AIËÉΩËÆ∞‰ΩèÁöÑÊúÄËøëÂØπËØùËÆ∞ÂΩïÊï∞ÈáèÔºåË∂ÖÂá∫ÈÉ®ÂàÜÂ∞ÜË¢´Âà†Èô§</p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel" id="cancel-watch-together-settings-btn">ÂèñÊ∂à</button>
        <button class="save" id="save-watch-together-settings-btn">‰øùÂ≠ò</button>
      </div>
    </div>
  </div>
  <div id="group-management-modal" class="modal">
    <div class="modal-content" style="height: 60%;">
      <div class="modal-header"> <span>ÁÆ°ÁêÜÂ•ΩÂèãÂàÜÁªÑ</span> </div>
      <div class="modal-body">
        <div class="form-group"> <label>Êñ∞Âª∫ÂàÜÁªÑ</label>
          <div style="display: flex; gap: 10px;"> <input type="text" id="new-group-name-input" placeholder="ËæìÂÖ•ÂàÜÁªÑÂêç..." style="flex-grow: 1;"> <button id="add-new-group-btn" class="form-button" style="width: auto; margin-top: 0; padding: 0 15px;"data-lang-key="add">Ê∑ªÂä†</button> </div>
        </div>
        <hr style="opacity: 0.2;">
        <div id="existing-groups-list" style="display: flex; flex-direction: column; gap: 10px;"> </div>
      </div>
      <div class="modal-footer"> <button class="save" id="close-group-manager-btn" style="width: 100%;"data-lang-key="done">ÂÆåÊàê</button> </div>
    </div>
  </div>
  <div id="message-actions-modal" class="modal">
    <div id="custom-modal" style="width: 250px;">
      <div class="custom-modal-footer"> <button id="edit-message-btn" data-lang-key="edit">ÁºñËæëÊ∂àÊÅØ</button> <button id="copy-message-btn">Â§çÂà∂ÊñáÊú¨</button> <button id="copy-timestamp-btn">Â§çÂà∂Êó∂Èó¥Êà≥</button> <button id="recall-message-btn">Êí§Âõû</button> <button id="publish-to-announcement-btn" style="display: none;">ÂèëÂ∏ÉÂà∞ÂÖ¨ÂëäÊùø</button>
        <button id="translate-message-btn">ÁøªËØë</button> <button id="quote-message-btn">ÂºïÁî®</button> <button id="forward-message-btn">ËΩ¨Âèë</button> <button id="select-message-btn">ËøõÂÖ•Â§öÈÄâ</button> <button id="cancel-message-action-btn" style="margin-top: 8px; border-radius: 8px; background-color: #f0f0f0;"data-lang-key="cancel">ÂèñÊ∂à</button> </div>
    </div>
  </div>
  <div id="post-actions-modal" class="modal">
    <div id="custom-modal" style="width: 250px;">
      <div class="custom-modal-footer"> <button id="edit-post-btn" data-lang-key="edit">ÁºñËæëÂä®ÊÄÅ</button> <button id="copy-post-btn">Â§çÂà∂ÂÜÖÂÆπ</button> <button id="cancel-post-action-btn"data-lang-key="cancel">ÂèñÊ∂à</button> </div>
    </div>
  </div>
  <div id="message-editor-modal" class="modal">
    <div class="modal-content" style="height: 75%;">
      <div class="modal-header"> <span data-lang-key="edit">ÁºñËæë‰∏éÊãÜÂàÜÊ∂àÊÅØ</span> </div>
      <div class="modal-body" id="message-editor-body">
        <div id="message-editor-container"></div> <button id="add-message-editor-block-btn" class="form-button form-button-secondary" style="margin-top: 15px;"> [+] Ê∑ªÂä†‰∏ã‰∏ÄÊù°Ê∂àÊÅØ </button>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-advanced-editor-btn"data-lang-key="cancel">ÂèñÊ∂à</button> <button class="save" id="save-advanced-editor-btn"data-lang-key="save">‰øùÂ≠òÊõ¥Êîπ</button> </div>
    </div>
  </div>
  <div id="ai-response-editor-modal" class="modal">
    <div class="modal-content" style="height: 80%;">
      <div class="modal-header"> <span>ÂØºÊºîÂâ™ËæëÂÆ§ (AI‰∏ä‰∏ÄËΩÆÂìçÂ∫î)</span> </div>
      <div class="modal-body" id="ai-response-editor-body">
        <div id="ai-response-editor-container" style="display: flex; flex-direction: column; gap: 15px;"></div> <button id="add-ai-response-block-btn" class="form-button form-button-secondary" style="margin-top: 15px;"> [+] Ê∑ªÂä†‰∏Ä‰∏™Êñ∞Âä®‰Ωú </button>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-ai-response-editor-btn"data-lang-key="cancel">ÂèñÊ∂à</button> <button class="save" id="save-ai-response-editor-btn">Â∫îÁî®‰øÆÊîπ</button> </div>
    </div>
  </div>
  <div id="repost-modal" class="modal">
    <div id="custom-modal" style="width: 280px;">
      <div class="custom-modal-header">ËΩ¨ÂèëÂä®ÊÄÅ</div>
      <div class="custom-modal-body"> <textarea id="repost-comment-input" placeholder="ËØ∑ËæìÂÖ•ËΩ¨ÂèëËØÑËÆ∫ (ÂèØÈÄâ)" style="width: 100%; min-height: 60px; resize: vertical; border: 1px solid #ccc; border-radius: 6px; padding: 8px; font-size: 16px; box-sizing: border-box;"></textarea> </div>
      <div class="custom-modal-footer"> <button id="repost-cancel-btn"data-lang-key="cancel">ÂèñÊ∂à</button> <button id="repost-confirm-btn" class="confirm-btn"data-lang-key="confirm">Á°ÆÂÆö</button> </div>
    </div>
  </div>
  <div id="call-message-actions-modal" class="modal">
    <div id="custom-modal" style="width: 250px;">
      <div class="custom-modal-footer"> <button id="edit-call-message-btn"data-lang-key="edit">ÁºñËæë</button> <button id="delete-call-message-btn" class="btn-danger">Âà†Èô§</button> <button id="cancel-call-message-action-btn" style="margin-top: 8px; border-radius: 8px; background-color: #f0f0f0;"data-lang-key="cancel">ÂèñÊ∂à</button> </div>
    </div>
  </div> <audio id="audio-player" style="display:none;"></audio>
  <div id="create-post-modal" class="modal">
    <div class="modal-content" style="height: auto; max-height: 90%;">
      <div class="modal-header"> <span>ÂèëÂ∏ÉÂä®ÊÄÅ</span> </div>
      <div class="modal-body">
        <div class="form-group"> <textarea id="post-public-text" rows="3" placeholder="ÂàÜ‰∫´Êñ∞È≤ú‰∫ã...ÔºàÈùûÂøÖÂ°´ÁöÑÂÖ¨ÂºÄÊñáÂ≠óÔºâ"></textarea> </div>
        <div class="post-mode-switcher"> <button id="switch-to-image-mode" class="mode-btn active">‰∏ä‰º†ÂõæÁâá</button> <button id="switch-to-text-image-mode" class="mode-btn">‰ΩøÁî®ÊñáÂ≠óÂõæ</button> </div>
        <div class="form-group"> <label>ÂèØËßÅËåÉÂõ¥</label>
          <div id="post-visibility-options" style="display: flex; gap: 15px; margin-bottom: 10px;"> <label><input type="radio" name="visibility" value="public" checked> ÂÖ¨ÂºÄ</label> <label><input type="radio" name="visibility" value="include"> ÊåáÂÆöÂàÜÁªÑÂèØËßÅ</label> </div>
          <div id="post-visibility-groups" style="display: none; max-height: 120px; overflow-y: auto; background: #f9f9f9; padding: 10px; border-radius: 8px;"> </div>
        </div>
        <div id="image-mode-content" class="post-mode-content active">
          <div class="form-group">
            <div id="post-image-preview-container" class="post-image-preview-container"> <img id="post-image-preview" src="" alt="ÂõæÁâáÈ¢ÑËßà"> <button id="post-remove-image-btn">√ó</button> </div>
            <div class="post-image-upload-options"> <button id="post-upload-local-btn" class="form-button-secondary">Êú¨Âú∞‰∏ä‰º†</button> <button id="post-use-url-btn" class="form-button-secondary">ÁΩëÁªúURL</button> <input type="file" id="post-local-image-input" accept="image/*" hidden> </div>
          </div>
          <div id="post-image-desc-group" class="form-group" style="display: none;"> <label>ÂõæÁâáÊèèËø∞ (ÂøÖÂ°´ÔºåÁªôAIÁúã)</label> <input type="text" id="post-image-description" placeholder="ÁÆÄÂçïÊèèËø∞ÂõæÁâáÂÜÖÂÆπÔºåÂ∏ÆÂä©AIÁêÜËß£"> </div>
        </div>
        <div id="text-image-mode-content" class="post-mode-content">
          <div class="form-group"> <label>ÊñáÂ≠óÂõæ (ÁªôAIÁêÜËß£Áî®ÁöÑÊèèËø∞ÔºåÁÇπÂáªÂõæÁâáÂêéÂèØËßÅ)</label> <textarea id="post-hidden-text" rows="4" placeholder="Âú®ËøôÈáåÂÜô‰∏ãÂõæÁâáÊèèËø∞..."></textarea> </div>
        </div>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-create-post-btn"data-lang-key="cancel">ÂèñÊ∂à</button> <button class="save" id="confirm-create-post-btn">ÂèëÂ∏É</button> </div>
    </div>
  </div> <input type="file" id="ai-avatar-upload-input" accept="image/*" hidden> <input type="file" id="group-avatar-upload-input" accept="image/*" hidden>
  <div id="qzone-sticker-panel">
    <div id="qzone-sticker-grid"></div>
  </div>
  <div id="avatar-frame-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header"> <span>ÈÄâÊã©Â§¥ÂÉèÊ°Ü</span>
        <div class="header-actions"> <button id="manage-frames-btn" class="action-button">ÁÆ°ÁêÜ</button> <button id="upload-custom-frame-btn" class="action-button">‰∏ä‰º†</button> <button id="batch-import-frames-btn" class="action-button">ÊâπÈáè</button> </div>
      </div>
      <div class="modal-body">
        <div class="frame-tabs">
          <div id="ai-frame-tab" class="frame-tab active">ÂØπÊñπÁöÑ</div>
          <div id="my-frame-tab" class="frame-tab">ÊàëÁöÑ</div>
        </div>
        <div id="ai-frame-content" class="frame-content">
          <div id="ai-frame-grid" class="frame-grid"> </div>
        </div>
        <div id="my-frame-content" class="frame-content" style="display: none;">
          <div id="my-frame-grid" class="frame-grid"> </div>
        </div>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-frame-settings-btn"data-lang-key="cancel">ÂèñÊ∂à</button> <button class="save" id="save-frame-settings-btn"data-lang-key="save">‰øùÂ≠ò</button> </div>
      <div id="frame-action-bar" style="display: none;"> <label class="select-all-label" style="display: flex; align-items: center; gap: 5px;"> <input type="checkbox" id="select-all-frames-checkbox"> ÂÖ®ÈÄâ </label> <button id="delete-selected-frames-btn" class="action-bar-btn">Âà†Èô§ (0)</button>
      </div>
    </div>
  </div><input type="file" id="custom-frame-upload-input" accept="image/*" hidden>
  <div id="character-profile-modal" class="modal">
    <div class="character-profile-content"> <div style="position: absolute; top: 20px; right: 20px; display: flex; gap: 10px; z-index: 10;">
        <button id="profile-edit-btn" title="ÁºñËæëÂΩìÂâçÂøÉÂ£∞" class="profile-history-icon-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
          </svg>
        </button>
        <button id="profile-history-icon-btn" title="Êü•ÁúãÂéÜÂè≤ÂøÉÂ£∞" class="profile-history-icon-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
          </svg>
        </button>
      </div>
      <div id="profile-main-content">
        <div id="profile-timestamp" class="thought-header"></div>
        <div class="thought-content">
          <div class="voice">
            <div class="label"> <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
              </svg> ÂøÉÂ£∞ </div>
            <p id="profile-heartfelt-voice" class="text"></p>
          </div>
          <div class="jottings">
            <div class="label"> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 19l7-7 3 3-7 7-3-3z"></path>
                <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>
                <path d="M2 2l7.586 7.586"></path>
              </svg> Êï£ËÆ∞ </div>
            <p id="profile-random-jottings" class="text"></p>
          </div>
        </div>
      </div>
      <div id="profile-thoughts-history-view">
        <div class="profile-header"> <span>ÂøÉÂ£∞ËÆ∞ÂΩï</span> <button id="history-back-btn" title="ËøîÂõû"> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg> </button> </div>
        <div id="thoughts-history-list"></div>
      </div>
    </div>
  </div> <input type="file" id="my-avatar-upload-input" accept="image/*" hidden>
  <div id="gift-recipient-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span>ÈÄâÊã©Êî∂Á§º‰∫∫</span> <label style="font-size: 14px; font-weight: normal; display: flex; align-items: center; gap: 5px;"> <input type="checkbox" id="select-all-recipients"> ÂÖ®ÈÄâ </label> </div>
      <div class="modal-body" id="gift-recipient-list" style="padding: 0;"> </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-gift-recipient-btn"data-lang-key="cancel">ÂèñÊ∂à</button> <button class="save" id="confirm-gift-recipient-btn">Á°ÆËÆ§ÈÄÅÂá∫</button> </div>
    </div>
  </div> <audio id="notification-sound-player" preload="auto"></audio>
  <div id="music-search-results-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span>ÊêúÁ¥¢ÁªìÊûú</span> <label style="font-size: 14px; font-weight: normal; display: flex; align-items: center; gap: 5px;"> <input type="checkbox" id="select-all-music-search"> ÂÖ®ÈÄâ </label> </div>
      <div class="modal-body" id="search-results-list" style="padding: 0;"> </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-music-search-btn"data-lang-key="cancel">ÂèñÊ∂à</button> <button class="save" id="add-selected-music-btn"data-lang-key="add">Ê∑ªÂä†ÈÄâ‰∏≠</button> </div>
    </div>
  </div>
  <div id="cleaned-songs-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span>Ë¢´Ê∏ÖÁêÜÁöÑÊ≠åÊõ≤</span> <label style="font-size: 14px; font-weight: normal; display: flex; align-items: center; gap: 5px;"> <input type="checkbox" id="select-all-cleaned-songs"> ÂÖ®ÈÄâ </label> </div>
      <div class="modal-body" id="cleaned-songs-list" style="padding: 0;"> </div>
      <div class="modal-footer"> <button class="cancel" id="close-cleaned-songs-btn">ÂÖ≥Èó≠</button> <button class="save" id="research-selected-songs-btn">ÈáçÊñ∞ÊêúÁ¥¢ÈÄâ‰∏≠</button> </div>
    </div>
  </div>
  <div id="douban-settings-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header"> <span>Ë±ÜÁì£ËÆæÁΩÆ</span> </div>
      <div class="modal-body">
        <div class="form-group douban-settings-item"> <label for="douban-min-posts-input"> ÊØèÊ¨°ÁîüÊàêÂ∏ñÂ≠êÊï∞ËåÉÂõ¥ <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> ËÆæÁΩÆAIÂú®Ë±ÜÁì£È°µÈù¢‰∏ÄÊ¨°ÊÄßÁîüÊàêÂ∏ñÂ≠êÁöÑÊúÄÂ∞èÂíåÊúÄÂ§ßÊï∞Èáè„ÄÇ </p> </label>
          <div class="douban-settings-controls"> <input type="number" id="douban-min-posts-input" min="1" value="12"> <span>Âà∞</span> <input type="number" id="douban-max-posts-input" min="1" value="20"> <span>ÁØá</span> </div>
        </div>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-douban-settings-btn"data-lang-key="cancel">ÂèñÊ∂à</button> <button class="save" id="save-douban-settings-btn"data-lang-key="save">‰øùÂ≠ò</button> </div>
    </div>
  </div><audio id="char-audio-player" preload="auto"></audio>
  <div id="douban-cast-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span>ÈÄâÊã©ÂèÇ‰∏éË±ÜÁì£ÁöÑËßíËâ≤</span> </div>
      <div class="modal-body" id="douban-cast-list" style="padding: 0;"> </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-douban-cast-btn"data-lang-key="cancel">ÂèñÊ∂à</button> <button class="save" id="save-douban-cast-btn"data-lang-key="save">‰øùÂ≠òÂπ∂Âà∑Êñ∞</button> </div>
    </div>
  </div><input type="file" id="import-preset-input" accept=".json" hidden>
  <div id="update-notice-modal">
    <div class="update-notice-content">
      <div class="update-notice-body" id="update-notice-body"> </div>
      <div class="update-notice-footer"> <button id="update-notice-confirm-btn">ÊàëÁü•ÈÅì‰∫Ü</button> <button id="update-notice-dismiss-btn">‰∏çÂÜçÊèêÁ§∫</button> </div>
    </div>
  </div>
  <div id="delete-world-books-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span>ÈÄâÊã©Ë¶ÅÂà†Èô§ÁöÑ‰∏ñÁïå‰π¶</span> <label style="font-size: 14px; font-weight: normal; display: flex; align-items: center; gap: 5px;"> <input type="checkbox" id="select-all-world-books-for-clear"> ÂÖ®ÈÄâ </label> </div>
      <div class="modal-body" id="delete-world-books-list" style="padding: 0;"> </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-delete-world-books-btn"data-lang-key="cancel">ÂèñÊ∂à</button> <button class="save btn-danger" id="confirm-delete-world-books-btn">Á°ÆËÆ§Âà†Èô§</button> </div>
    </div>
  </div>
  <div id="werewolf-kill-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"><span>Áãº‰∫∫ËØ∑ÈÄâÊã©ÂàÄ‰∫∫ÂØπË±°</span></div>
      <div class="modal-body" id="werewolf-kill-selection-list" style="padding: 0;"></div>
      <div class="modal-footer"> <button class="cancel" id="cancel-wolf-kill-btn">ÊîæÂºÉ</button> <button class="save btn-danger" id="confirm-wolf-kill-btn">Á°ÆËÆ§ÂàÄ‰∫∫</button> </div>
    </div>
  </div>
  <div id="werewolf-lobby-modal" class="modal">
    <div class="modal-content" style="height: 80%;">
      <div class="modal-header"> <span>ÈÄâÊã©Áé©ÂÆ∂ÂºÄÂßãÁãº‰∫∫ÊùÄ</span> </div>
      <div class="modal-body" id="werewolf-player-selection-list" style="padding: 0;"> </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-werewolf-lobby-btn"data-lang-key="cancel">ÂèñÊ∂à</button> <button class="save" id="start-werewolf-game-btn">ÂºÄÂßãÊ∏∏Êàè</button> </div>
    </div>
  </div>
  <div id="werewolf-role-modal" class="modal">
    <div class="modal-content" style="width: 280px; height: auto; text-align: center; padding: 20px;">
      <h3 id="werewolf-role-title" style="margin-top: 0;">‰Ω†ÁöÑË∫´‰ªΩÊòØ</h3>
      <div id="werewolf-role-card" style="margin: 15px 0;">
        <h2 id="werewolf-role-name" style="margin: 0 0 10px 0;"></h2>
        <p id="werewolf-role-description" style="font-size: 14px; line-height: 1.6; color: #555; margin: 0;"></p>
      </div> <button id="werewolf-role-confirm-btn" class="form-button">ÊàëÂáÜÂ§áÂ•Ω‰∫Ü</button>
    </div>
  </div>
  <div id="werewolf-prophet-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"><span>È¢ÑË®ÄÂÆ∂ËØ∑ÈÄâÊã©Êü•È™åÂØπË±°</span></div>
      <div class="modal-body" id="werewolf-prophet-selection-list" style="padding: 0;"></div>
      <div class="modal-footer"> <button class="save" id="confirm-prophet-check-btn">Á°ÆËÆ§Êü•È™å</button> </div>
    </div>
  </div>
  <div id="werewolf-hunter-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"><span>Áåé‰∫∫ËØ∑ÈÄâÊã©ÂºÄÊû™ÂØπË±°</span></div>
      <div class="modal-body" id="werewolf-hunter-selection-list" style="padding: 0;"></div>
      <div class="modal-footer"> <button class="save btn-danger" id="confirm-hunter-shot-btn">Á°ÆËÆ§ÂºÄÊû™</button> </div>
    </div>
  </div>
  <div id="werewolf-vote-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"><span>ËØ∑ÊäïÁ•®ÊîæÈÄê‰∏ÄÂêçÁé©ÂÆ∂</span></div>
      <div class="modal-body" id="werewolf-vote-selection-list" style="padding: 0;"></div>
      <div class="modal-footer"> <button class="save" id="confirm-vote-btn">Á°ÆËÆ§ÊäïÁ•®</button> </div>
    </div>
  </div>
  <div id="werewolf-guard-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"><span>ÂÆàÂç´ËØ∑ÈÄâÊã©‰ªäÊôöË¶ÅÂÆàÊä§ÁöÑÁé©ÂÆ∂</span></div>
      <div class="modal-body" id="werewolf-guard-selection-list" style="padding: 0;"></div>
      <div class="modal-footer"> <button class="save" id="confirm-guard-selection-btn">Á°ÆËÆ§ÂÆàÊä§</button> </div>
    </div>
  </div>
  <div id="werewolf-witch-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"><span id="witch-modal-title">Â•≥Â∑´ËØ∑ÁùÅÁúº</span></div>
      <div class="modal-body" id="werewolf-witch-selection-list" style="padding: 0;"> </div>
      <div class="modal-footer"> <button class="cancel" id="witch-do-nothing-btn">‰ªÄ‰πàÈÉΩ‰∏çÂÅö</button> <button class="save btn-danger" id="confirm-witch-poison-btn" style="display: none;">Á°ÆËÆ§Áî®ÊØí</button> </div>
    </div>
  </div>
  <div id="werewolf-hunter-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"><span>Áåé‰∫∫ËØ∑ÈÄâÊã©ÂºÄÊû™ÂØπË±°</span></div>
      <div class="modal-body" id="werewolf-hunter-selection-list" style="padding: 0;"></div>
      <div class="modal-footer"> <button class="save btn-danger" id="confirm-hunter-shot-btn">Á°ÆËÆ§ÂºÄÊû™</button> </div>
    </div>
  </div>
  <div id="werewolf-vote-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"><span>ËØ∑ÊäïÁ•®ÊîæÈÄê‰∏ÄÂêçÁé©ÂÆ∂</span></div>
      <div class="modal-body" id="werewolf-vote-selection-list" style="padding: 0;"></div>
      <div class="modal-footer"> <button class="save" id="confirm-vote-btn">Á°ÆËÆ§ÊäïÁ•®</button> </div>
    </div>
  </div>
  <div id="werewolf-game-over-modal" class="modal">
    <div class="modal-content" style="width: 300px; height: auto; text-align: center; padding: 20px;">
      <h2 id="werewolf-game-over-title">Ê∏∏ÊàèÁªìÊùü</h2>
      <p id="werewolf-game-over-reason" style="font-size: 16px; margin: 20px 0;"></p>
      <div id="werewolf-role-reveal-list" style="max-height: 250px; overflow-y: auto; margin: 20px 0; border-top: 1px solid #444; padding-top: 10px;"> </div> <button id="werewolf-game-over-close-btn" class="form-button">ËøîÂõûÂ§ßÂéÖ</button> <button id="manual-werewolf-summary-btn"
        class="form-button form-button-secondary" style="margin-top: 10px;">ÊâãÂä®ÊÄªÁªìËÆ∞ÂøÜ</button>
    </div>
  </div>
  <div id="reading-library-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span>ÊàëÁöÑ‰π¶Â∫ì</span>
        <div class="header-actions"> <span class="action-btn" id="import-new-book-btn-header" title="ÂØºÂÖ•Êñ∞‰π¶"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg> </span> <span class="action-btn" id="close-reading-library-btn-header" title="ÂÖ≥Èó≠"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg> </span> </div>
      </div>
      <div id="reading-library-search-container"> <input type="search" id="reading-library-search-input" placeholder="ÊêúÁ¥¢‰π¶Âêç..."> </div>
      <div class="modal-body" style="padding: 0; flex-grow: 1; overflow-y: auto;">
        <div id="reading-library-list"> </div>
      </div>
    </div>
  </div>
  <div id="product-category-manager-modal" class="modal">
    <div class="modal-content" style="height: 60%;">
      <div class="modal-header"> <span>ÁÆ°ÁêÜÂïÜÂìÅÂàÜÁ±ª</span> </div>
      <div class="modal-body">
        <div class="form-group"> <label>Êñ∞Âª∫ÂàÜÁ±ª</label>
          <div style="display: flex; gap: 10px;"> <input type="text" id="new-product-category-name-input" placeholder="ËæìÂÖ•ÂàÜÁ±ªÂêç..." style="flex-grow: 1;"> <button id="add-new-product-category-btn" class="form-button" style="width: auto; margin-top: 0; padding: 0 15px;"data-lang-key="add">Ê∑ªÂä†</button> </div>
        </div>
        <hr style="opacity: 0.2;">
        <div id="existing-product-categories-list" style="display: flex; flex-direction: column; gap: 10px;"> </div>
      </div>
      <div class="modal-footer"> <button class="save" id="close-product-category-manager-btn" style="width: 100%;"data-lang-key="done">ÂÆåÊàê</button> </div>
    </div>
  </div>
  <div id="variation-selection-modal" class="modal">
    <div class="modal-content" style="width: 320px; height: auto;">
      <div class="modal-header" style="padding-bottom: 0;"> </div>
      <div class="modal-body">
        <div id="variation-product-info" style="display: flex; align-items: flex-start; gap: 12px; margin-bottom: 15px;"> <img id="variation-product-image" style="width: 80px; height: 80px; border-radius: 6px; object-fit: cover;">
          <div>
            <p id="variation-product-name" style="font-weight: 500; margin: 0;"></p>
            <p id="variation-selected-price" style="color: #ff5722; font-weight: bold; font-size: 18px; margin: 8px 0 0;"></p>
          </div>
        </div>
        <div class="form-group"> <label>ÈÄâÊã©Ê¨æÂºè</label>
          <div id="variation-options-container" style="display: flex; flex-wrap: wrap; gap: 8px;"> </div>
        </div>
        <div class="form-group"> <label>Ë¥≠‰π∞Êï∞Èáè</label>
          <div class="quantity-control" style="justify-content: flex-start;"> <button class="quantity-btn" id="variation-decrease-qty">-</button> <span class="quantity-display" id="variation-quantity-display">1</span> <button class="quantity-btn" id="variation-increase-qty">+</button>
          </div>
        </div>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-variation-selection-btn"data-lang-key="cancel">ÂèñÊ∂à</button> <button class="save" id="confirm-variation-selection-btn">Âä†ÂÖ•Ë¥≠Áâ©ËΩ¶</button> </div>
    </div>
  </div>
  <div id="shopping-settings-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header"> <span>Ë¥≠Áâ©‰∏≠ÂøÉÁîüÊàêËÆæÁΩÆ</span> </div>
      <div class="modal-body">
        <div class="form-group douban-settings-item"> <label for="shopping-category-count-input"> ÁîüÊàêÂàÜÁ±ªÊï∞Èáè <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> ËÆæÁΩÆAI‰∏ÄÊ¨°ÊÄßÁîüÊàêÂ§öÂ∞ë‰∏™ÂïÜÂìÅÂàÜÁ±ª„ÄÇ </p> </label>
          <div class="douban-settings-controls"> <input type="number" id="shopping-category-count-input" min="1" max="10" value="3"> <span>‰∏™</span> </div>
        </div>
        <div class="form-group douban-settings-item"> <label for="shopping-product-count-input"> ÊØè‰∏™ÂàÜÁ±ªÂïÜÂìÅÊï∞Èáè <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> ËÆæÁΩÆÊØè‰∏™ÂàÜÁ±ª‰∏ãÁîüÊàêÂ§öÂ∞ë‰∏™ÂïÜÂìÅ„ÄÇ </p> </label>
          <div class="douban-settings-controls"> <input type="number" id="shopping-product-count-input" min="2" max="10" value="8"> <span>‰∏™</span> </div>
        </div>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-shopping-settings-btn"data-lang-key="cancel">ÂèñÊ∂à</button> <button class="save" id="save-shopping-settings-btn"data-lang-key="save">‰øùÂ≠ò</button> </div>
    </div>
  </div>
  <div id="sticker-binding-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header">
        <span>ÁªëÂÆöÂàÜÁ±ªÂà∞ËÅäÂ§©</span>
      </div>
      <div class="modal-body" id="sticker-binding-chat-list" style="padding: 0;">
        <!-- ËÅäÂ§©ÂàóË°®Â∞ÜÂú®Ê≠§Â§ÑÂä®ÊÄÅÊ∏≤Êüì -->
      </div>
      <div class="modal-footer">
        <button class="cancel" id="cancel-sticker-binding-btn"data-lang-key="cancel">ÂèñÊ∂à</button>
        <button class="save" id="save-sticker-binding-btn"data-lang-key="save">‰øùÂ≠ò</button>
      </div>
    </div>
  </div>
<!-- ‚ñº‚ñº‚ñº NovelAI ÁîüÊàêËÆæÁΩÆÂºπÁ™ó ‚ñº‚ñº‚ñº -->
<div id="novelai-settings-modal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px; width: 90%; max-height: 85vh; overflow-y: auto;">
        <div class="modal-header">
            <span>NovelAI ÁîüÊàêËÆæÁΩÆ</span>
            <span class="close" id="close-novelai-settings" style="cursor: pointer; float: right; font-size: 28px; font-weight: bold;">&times;</span>
        </div>
        <div class="modal-body" style="padding: 20px;">
           <div class="settings-section" style="background-color: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
    <div style="font-weight: 600; margin-bottom: 10px; color: #333;">üé® È£éÊ†ºÈ¢ÑËÆæ‰∏éÁªëÂÆö</div>
    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
        <select id="nai-preset-select" class="settings-select" style="flex-grow: 1; border: 1px solid #ccc; padding: 8px; border-radius: 6px;">
            <option value="">-- ÂΩìÂâç‰∏¥Êó∂ËÆæÁΩÆ --</option>
        </select>
    </div>
    
    <div style="display: flex; gap: 8px; align-items: center; justify-content: flex-end;">
    <button id="save-nai-preset-btn" class="settings-mini-btn">Êñ∞Â¢û</button>
    
    <button id="update-nai-preset-btn" class="settings-mini-btn" style="display:none;">Êõ¥Êñ∞</button>
    
    <button id="bind-nai-preset-btn" class="settings-mini-btn" style="display:none; background-color: #e3f2fd; color: #1976d2; border-color: #bbdefb;">üîóÁªëÂÆö</button>
    
    <button id="delete-nai-preset-btn" class="settings-mini-btn" style="color: #ff3b30; border-color: #ff3b30; display:none;">Âà†Èô§</button>
</div>
    
    <p style="font-size: 12px; color: #888; margin-top: 8px; margin-bottom: 0;">* ÁªëÂÆöÂêéÔºåËØ•ËßíËâ≤ÁîüÂõæÊó∂Â∞ÜÂº∫Âà∂‰ΩøÁî®Ê≠§È¢ÑËÆæ„ÄÇ</p>
</div>
            <div class="form-group">
                <label style="color: #333;">ÂõæÂÉèÂ∞∫ÂØ∏ÔºàoplusÂèØÊó†ÈôêÂá∫Â∞èÂõæÔºâ</label>
                <select id="nai-resolution" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px;">
                    <optgroup label="Â∞è">
                        <option value="512x768">Á∫µÂêë (512x768)</option>
                        <option value="768x512">Ê®™Âêë (768x512)</option>
                        <option value="640x640">Ê≠£ÊñπÂΩ¢ (640x640)</option>
                    </optgroup>
                    <optgroup label="Ê≠£Â∏∏">
                        <option value="832x1216">Á´ñÂõæ (832x1216)</option>
                        <option value="1216x832">Ê®™Âõæ (1216x832)</option>
                        <option value="1024x1024" selected>ÊñπÂõæ (1024x1024)</option>
                    </optgroup>
                    <optgroup label="Â£ÅÁ∫∏">
                        <option value="1088x1920">Á∫µÂêë (1088x1920)</option>
                        <option value="1920x1088">È£éÊôØ (1920x1088)</option>
                    </optgroup>
                </select>
                <small style="color: #666;">Âª∫ËÆÆ‰ΩøÁî®ÂÆòÊñπÊîØÊåÅÁöÑÊ†áÂáÜÂ∞∫ÂØ∏‰ª•Ëé∑ÂæóÊúÄ‰Ω≥ÊïàÊûú</small>
            </div>

            <div class="form-group">
                <label style="color: #333;">ÈááÊ†∑Ê≠•Êï∞ (Steps)</label>
                <input type="number" id="nai-steps" value="28" min="1" max="50" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px;">
                <small style="color: #666;">Êé®ËçêÂÄº: 28 (ÂÄºË∂äÈ´òË¥®ÈáèË∂äÂ•Ω‰ΩÜËÄóÊó∂Ë∂äÈïø)</small>
            </div>

            <div class="form-group">
                <label style="color: #333;">ÊèêÁ§∫ËØçÁõ∏ÂÖ≥ÊÄß (CFG Scale)</label>
                <input type="number" id="nai-cfg-scale" value="5" min="1" max="20" step="0.5" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px;">
                <small style="color: #666;">Êé®ËçêÂÄº: 5 (ÊéßÂà∂ÂõæÂÉè‰∏éÊèêÁ§∫ËØçÁöÑÁõ∏ÂÖ≥Á®ãÂ∫¶)</small>
            </div>

            <div class="form-group">
                <label style="color: #333;">ÈááÊ†∑Âô® (Sampler)</label>
                <select id="nai-sampler" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px;">
                    <option value="k_euler">Euler</option>
                    <option value="k_euler_ancestral" selected>Euler Ancestral</option>
                    <option value="k_dpmpp_2s_ancestral">DPM++ 2S Ancestral</option>
                    <option value="k_dpmpp_2m">DPM++ 2M</option>
                    <option value="k_dpmpp_sde">DPM++ SDE</option>
                    <option value="ddim">DDIM</option>
                </select>
            </div>

            <div class="form-group">
                <label style="color: #333;">ÈöèÊú∫ÁßçÂ≠ê (Seed)</label>
                <input type="number" id="nai-seed" value="-1" min="-1" max="9999999999" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px;">
                <small style="color: #666;">-1 Ë°®Á§∫ÈöèÊú∫ÔºåÂõ∫ÂÆöÁßçÂ≠êÂèØÂ§çÁé∞Áõ∏ÂêåÂõæÂÉè</small>
            </div>

            <div class="form-group">
                <label style="color: #333;">Ë¥üÈù¢ÊèêÁ§∫ËØçÈ¢ÑËÆæ (UC Preset)</label>
                <select id="nai-uc-preset" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px;">
                    <option value="0">Preset 0 - Heavy</option>
                    <option value="1" selected>Preset 1 - Light</option>
                    <option value="2">Preset 2 - Human Focus</option>
                    <option value="3">Preset 3 - None</option>
                </select>
            </div>

            <div class="form-group">
                <label style="color: #333;">Ë¥®ÈáèÊ†áÁ≠æ</label>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="nai-quality-toggle" checked style="width: auto;">
                    <span style="color: #666; font-size: 14px;">Ëá™Âä®Ê∑ªÂä†Ë¥®ÈáèÊèêÂçáÊ†áÁ≠æ</span>
                </div>
            </div>

            <div class="form-group">
                <label style="color: #333;">SMEA (ÊèêÂçáÁªÜËäÇ)</label>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="nai-smea" checked style="width: auto;">
                    <span style="color: #666; font-size: 14px;">ÂêØÁî®SMEAÂ¢ûÂº∫</span>
                </div>
            </div>

            <div class="form-group">
                <label style="color: #333;">SMEA DYN (Âä®ÊÄÅ‰ºòÂåñ)</label>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="nai-smea-dyn" style="width: auto;">
                    <span style="color: #666; font-size: 14px;">ÂêØÁî®Âä®ÊÄÅSMEA</span>
                </div>
            </div>

            <div class="form-group">
                <label style="color: #333;">ÈªòËÆ§Ê≠£Èù¢ÊèêÁ§∫ËØç</label>
                <textarea id="nai-default-positive" rows="3" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px; resize: vertical;" placeholder="masterpiece, best quality, 1girl, beautiful...">masterpiece, best quality, 1girl, beautiful, detailed face, detailed eyes, long hair, anime style</textarea>
                <small style="color: #666;">Ê≠§ÊèêÁ§∫ËØçÂ∞ÜÂú®ÁîüÊàêÊó∂Ëá™Âä®‰ΩøÁî®ÔºàÂ¶ÇÊûúÊµãËØïÂºπÁ™ó‰∏≠Êú™Â°´ÂÜôÔºâ</small>
            </div>

            <div class="form-group">
                <label style="color: #333;">ÈªòËÆ§Ë¥üÈù¢ÊèêÁ§∫ËØç</label>
                <textarea id="nai-default-negative" rows="3" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px; resize: vertical;" placeholder="lowres, bad anatomy, bad hands, text, error...">lowres, bad anatomy, bad hands, text, error, missing fingers, extra digit, fewer digits, cropped, worst quality, low quality, normal quality, jpeg artifacts, signature, watermark, username, blurry</textarea>
            </div>

            <div class="form-group" style="border-top: 1px solid #ddd; padding-top: 15px; margin-top: 15px;">
                <label style="color: #333;">üåê CORS ‰ª£ÁêÜËÆæÁΩÆ</label>
                <select id="nai-cors-proxy" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px;">
                    <option value="">‚ùå Áõ¥ËøûÔºàÊó†‰ª£ÁêÜÔºâ</option>
                    <option value="https://corsproxy.io/?" selected>‚úÖ corsproxy.ioÔºàÊé®ËçêÔºâ</option>
                    <option value="https://api.allorigins.win/raw?url=">allorigins.win</option>
                    <option value="https://cors-anywhere.herokuapp.com/">cors-anywhereÔºàÈúÄÊøÄÊ¥ªÔºâ</option>
                    <option value="custom">üîß Ëá™ÂÆö‰πâ‰ª£ÁêÜ</option>
                </select>
                <small style="color: #e74c3c; display: block; margin-top: 8px;">
                    ‚ö†Ô∏è Êú¨Âú∞ËøêË°å‰ºöÈÅáÂà∞CORSË∑®ÂüüÈóÆÈ¢òÔºåÈúÄ‰ΩøÁî®‰ª£ÁêÜ„ÄÇÊé®Ëçê‰ΩøÁî® corsproxy.io
                </small>
            </div>

            <div id="nai-custom-proxy-group" class="form-group" style="display: none;">
                <label style="color: #333;">Ëá™ÂÆö‰πâ‰ª£ÁêÜÂú∞ÂùÄ</label>
                <input type="text" id="nai-custom-proxy-url" placeholder="https://your-proxy.com/?" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px;">
                <small style="color: #666;">‰ª£ÁêÜURLÂ∫î‰ª• / Êàñ ? ÁªìÂ∞æÔºå‰æãÂ¶ÇÔºöhttps://proxy.com/?</small>
            </div>
        </div>
        <div class="modal-footer">
            <button id="reset-nai-settings-btn" class="form-button form-button-secondary" style="margin-right: 10px;">ÊÅ¢Â§çÈªòËÆ§</button>
            <button id="save-nai-settings-btn" class="form-button form-button-secondary"data-lang-key="save">‰øùÂ≠òËÆæÁΩÆ</button>
        </div>
    </div>
</div>
<!-- ‚ñ≤‚ñ≤‚ñ≤ NovelAI ÁîüÊàêËÆæÁΩÆÂºπÁ™óÁªìÊùü ‚ñ≤‚ñ≤‚ñ≤ -->

<!-- ‚ñº‚ñº‚ñº NovelAI ÊµãËØïÁîüÊàêÂºπÁ™ó ‚ñº‚ñº‚ñº -->
<div id="novelai-test-modal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 700px; width: 90%; max-height: 90vh; overflow-y: auto;">
        <div class="modal-header">
            <span>üñºÔ∏è NovelAI ÊµãËØïÁîüÊàê</span>
            <span class="close" id="close-novelai-test" style="cursor: pointer; float: right; font-size: 28px; font-weight: bold;">&times;</span>
        </div>
        <div class="modal-body" style="padding: 20px;">
            <div class="form-group">
                <label style="color: #333;">Ê≠£Èù¢ÊèêÁ§∫ËØçÔºàÊ≠§Â§ÑÊèêÁ§∫ËØç‰ªÖÁî®‰∫éËØ•ÂºπÁ™óÊµãËØïÔºâ</label>
                <textarea id="nai-test-prompt" rows="4" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 10px; width: 100%; border-radius: 4px; resize: vertical;" placeholder="1girl, solo, long hair, blue eyes, smile...">1girl, solo, long hair, blue eyes, smile, outdoors, cherry blossoms, spring</textarea>
            </div>

            <div class="form-group">
                <label style="color: #333;">Ë¥üÈù¢ÊèêÁ§∫ËØçÔºàÂèØÈÄâÔºåÁïôÁ©∫‰ΩøÁî®ÈªòËÆ§Ôºâ</label>
                <textarea id="nai-test-negative" rows="3" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 10px; width: 100%; border-radius: 4px; resize: vertical;" placeholder="ÁïôÁ©∫Â∞Ü‰ΩøÁî®ËÆæÁΩÆ‰∏≠ÁöÑÈªòËÆ§Ë¥üÈù¢ÊèêÁ§∫ËØç"></textarea>
            </div>

            <div style="text-align: center; margin: 20px 0;">
                <button id="nai-generate-btn" style="background-color: #007bff; color: white; border: none; padding: 12px 30px; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold;">
                    ÁîüÊàêÂõæÂÉè
                </button>
            </div>

            <div id="nai-test-status" style="text-align: center; color: #666; margin: 15px 0; display: none;">
                Ê≠£Âú®ÁîüÊàê‰∏≠ÔºåËØ∑Á®çÂÄô...
            </div>

            <div id="nai-test-result" style="display: none; margin-top: 20px;">
                <div style="font-weight: bold; color: #333; margin-bottom: 10px;">ÁîüÊàêÁªìÊûúÔºö</div>
                <div style="text-align: center; background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #e9ecef;">
                    <img id="nai-result-image" style="max-width: 100%; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                </div>
                <div style="margin-top: 10px; text-align: center;">
                    <button id="nai-download-btn" class="form-button-secondary" style="margin: 0;">‰∏ãËΩΩÂõæÂÉè</button>
                </div>
            </div>

            <div id="nai-test-error" style="display: none; margin-top: 15px; padding: 12px; background: #f8d7da; color: #721c24; border-radius: 6px; border: 1px solid #f5c6cb;"></div>
        </div>
        <div class="modal-footer">
            <button id="close-nai-test-btn" class="form-button">ÂÖ≥Èó≠</button>
        </div>
    </div>
</div>
<!-- ‚ñ≤‚ñ≤‚ñ≤ NovelAI ÊµãËØïÁîüÊàêÂºπÁ™óÁªìÊùü ‚ñ≤‚ñ≤‚ñ≤ -->

<!-- ‚ñº‚ñº‚ñº ËßíËâ≤‰∏ìÂ±ûNAIÂá∫ÂõæËÆæÁΩÆÂºπÁ™ó ‚ñº‚ñº‚ñº -->
<div id="character-nai-prompts-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <span>ËßíËâ≤‰∏ìÂ±ûNAIÊèêÁ§∫ËØçÈÖçÁΩÆ</span>
            <span class="close" id="close-character-nai-prompts" style="cursor: pointer; float: right; font-size: 28px; font-weight: bold;">&times;</span>
        </div>
        <div class="modal-body">
            <p style="font-size: 13px; color: #666; margin-bottom: 20px; background-color: #f0f8ff; padding: 12px; border-radius: 6px; border-left: 3px solid #007bff;">
                üí° ËøôÈáåÈÖçÁΩÆÁöÑÊèêÁ§∫ËØç‰ªÖÁî®‰∫éÂΩìÂâçËßíËâ≤ÁöÑNAIÂá∫ÂõæÔºå‰∏çÂΩ±ÂìçÂÖ∂‰ªñËßíËâ≤ÊàñÁ≥ªÁªüËÆæÁΩÆ
            </p>
            
            <div class="form-group">
                <label for="character-nai-positive" style="color: #333; font-weight: 600;">
                    Ê≠£Èù¢ÊèêÁ§∫ËØç (Positive Prompt)
                </label>
                <textarea id="character-nai-positive" rows="4" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 10px; width: 100%; border-radius: 4px; resize: vertical; font-size: 13px;" placeholder="‰æãÂ¶Ç: masterpiece, best quality, 1girl, beautiful, detailed face, detailed eyes, long hair, anime style"></textarea>
                <small style="display: block; color: #666; font-size: 12px; margin-top: 5px;">
                    ÊèèËø∞‰Ω†Â∏åÊúõÁîüÊàêÁöÑÂõæÂÉèÈ£éÊ†ºÔºåÂèØÂ°´ÂÖ•ÁîªÂ∏à‰∏≤
                </small>
            </div>

            <div class="form-group">
                <label for="character-nai-negative" style="color: #333; font-weight: 600;">
                    Ë¥üÈù¢ÊèêÁ§∫ËØç (Negative Prompt)
                </label>
                <textarea id="character-nai-negative" rows="4" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 10px; width: 100%; border-radius: 4px; resize: vertical; font-size: 13px;" placeholder="‰æãÂ¶Ç: lowres, bad anatomy, bad hands, text, error, missing fingers"></textarea>
                <small style="display: block; color: #666; font-size: 12px; margin-top: 5px;">
                    ÊèèËø∞‰Ω†Â∏åÊúõÈÅøÂÖçÁöÑÂÖÉÁ¥†
                </small>
            </div>
        </div>
        <div class="modal-footer">
            <button id="reset-character-nai-prompts-btn" class="form-button form-button-secondary" style="margin-right: 10px;">Ê∏ÖÁ©∫ÈÖçÁΩÆ</button>
            <button id="save-character-nai-prompts-btn" class="form-button form-button-secondary"data-lang-key="save">‰øùÂ≠ò</button>
        </div>
    </div>
</div>
<!-- ‚ñ≤‚ñ≤‚ñ≤ ËßíËâ≤‰∏ìÂ±ûNAIÂá∫ÂõæËÆæÁΩÆÂºπÁ™óÁªìÊùü ‚ñ≤‚ñ≤‚ñ≤ -->
<div id="npc-group-manager-modal" class="modal">
  <div class="modal-content" style="height: 60%;">
    <div class="modal-header"> <span>ÁÆ°ÁêÜNPCÂàÜÁªÑ</span> </div>
    <div class="modal-body">
      <div class="form-group"> <label>Êñ∞Âª∫ÂàÜÁªÑ</label>
        <div style="display: flex; gap: 10px;"> <input type="text" id="new-npc-group-name-input" placeholder="ËæìÂÖ•ÂàÜÁªÑÂêç (‰æãÂ¶Ç: ÂÆ∂‰∫∫ÁªÑ, ÊúãÂèãÁªÑ)..." style="flex-grow: 1;"> <button id="add-new-npc-group-btn" class="form-button" style="width: auto; margin-top: 0; padding: 0 15px;"data-lang-key="add">Ê∑ªÂä†</button> </div>
      </div>
      <hr style="opacity: 0.2;">
      <div id="existing-npc-groups-list" style="display: flex; flex-direction: column; gap: 10px;"> </div>
    </div>
    <div class="modal-footer"> <button class="save" id="close-npc-group-manager-btn" style="width: 100%;"data-lang-key="done">ÂÆåÊàê</button> </div>
  </div>
</div>
<div id="pin-modal-overlay" class="modal">
    <div id="pin-modal-content" class="modal-content" style="width: 300px; height: auto;">
        <div class="modal-header">
            <span>ÂäüËÉΩÊøÄÊ¥ª</span>
        </div>
        <div class="modal-body" style="text-align: left;">
            <p>Ê≠§ÂäüËÉΩÈúÄË¶ÅÊøÄÊ¥ªÁ†Å (PIN) ÊâçËÉΩ‰ΩøÁî®„ÄÇ</p>
            
            <div class="form-group">
                <label for="pin-device-id-display">ÊÇ®ÁöÑËÆæÂ§áID (ËØ∑ÂéªÂ∞æÂ∑¥ÈïáËßíËâ≤Âç°‰∏≠Ëé∑ÂèñÔºåËøòÊúâËß£ÂØÜÊ≤°Áõ¥Êé•ÁªôÁΩëÂùÄÔºåÊåâÁÖßË¶ÅÊ±ÇÂéªÊêúÁ¥¢Â∞±Â•Ω‰∫ÜÔºå‰ª•‰∏ãÊï∞Â≠óÂç≥‰∏∫‰Ω†ÁöÑËÆæÂ§áÁ†Å)</label>
                <input type="text" id="pin-device-id-display" readonly style="background: #eee; cursor: text; -webkit-user-select: text; user-select: text;">
            </div>
            
            <div class="form-group">
                <label for="pin-input">ËØ∑ËæìÂÖ•ÊøÄÊ¥ªÁ†Å (PIN)</label>
                <input type="text" id="pin-input" placeholder="Âú®Ê≠§ËæìÂÖ•ÊøÄÊ¥ªÁ†Å...">
            </div>
        </div>
        <div class="modal-footer">
            <button class="cancel" id="pin-modal-cancel-btn">ÂèñÊ∂à</button>
            <button class="save" id="pin-modal-confirm-btn">Á°ÆËÆ§ÊøÄÊ¥ª</button>
        </div>
    </div>
</div>
<div id="quick-reply-modal" class="modal">
    <div class="modal-content" style="height: 70%; position: relative;"> <div class="modal-header">
            <span>Âø´Êç∑ÂõûÂ§ç</span>
            <div class="header-actions">
                <button id="batch-quick-reply-btn" class="action-button" style="font-size: 14px; margin-right: 10px;">ÊâπÈáè</button>
                <button id="manage-quick-reply-categories-btn" class="action-button" style="font-size: 14px; margin-right: 10px;">ÂàÜÁ±ª</button>
                <button id="add-quick-reply-btn" class="action-button" style="font-size: 26px; color: var(--accent-color); font-weight: 300; cursor: pointer; background: none; border: none; padding: 0 5px;">+</button>
            </div>
        </div>
        
        <div id="quick-reply-tabs" style="display: flex; overflow-x: auto; padding: 0 15px; flex-shrink: 0; border-bottom: 1px solid var(--border-color); background-color: var(--secondary-bg); -ms-overflow-style: none; scrollbar-width: none;">
        </div>

        <div class="modal-body" id="quick-reply-list" style="padding: 0; display: flex; flex-direction: column; padding-bottom: 60px;"> </div>

        <div id="quick-reply-action-bar" style="display: none; position: absolute; bottom: 0; left: 0; width: 100%; padding: 10px 15px; background: rgba(255,255,255,0.95); border-top: 1px solid #eee; box-sizing: border-box; justify-content: space-between; align-items: center; z-index: 10;">
            <label style="display: flex; align-items: center; gap: 5px;">
                <input type="checkbox" id="select-all-quick-replies-checkbox"> ÂÖ®ÈÄâ
            </label>
            <div style="display: flex; gap: 8px;">
                <button id="move-selected-quick-replies-btn" class="settings-mini-btn" style="background-color: #ff9800; color: white; border: none;">ÁßªÂä® (0)</button>
                <button id="delete-selected-quick-replies-btn" class="settings-mini-btn" style="background-color: #ff3b30; color: white; border: none;">Âà†Èô§ (0)</button>
            </div>
        </div>

        <div class="modal-footer" id="quick-reply-normal-footer">
            <button class="cancel" id="cancel-quick-reply-btn" style="width: 100%;">ÂÖ≥Èó≠</button>
        </div>
    </div>
</div>
<div id="quick-reply-category-manager-modal" class="modal">
    <div class="modal-content" style="height: 60%;">
        <div class="modal-header"> <span>ÁÆ°ÁêÜÂõûÂ§çÂàÜÁ±ª</span> </div>
        <div class="modal-body">
            <div class="form-group"> <label>Êñ∞Âª∫ÂàÜÁ±ª</label>
                <div style="display: flex; gap: 10px;"> 
                    <input type="text" id="new-quick-reply-category-name-input" placeholder="ËæìÂÖ•ÂàÜÁ±ªÂêç..." style="flex-grow: 1;"> 
                    <button id="add-new-quick-reply-category-btn" class="form-button" style="width: auto; margin-top: 0; padding: 0 15px;" data-lang-key="add">Ê∑ªÂä†</button> 
                </div>
            </div>
            <hr style="opacity: 0.2;">
            <div id="existing-quick-reply-categories-list" style="display: flex; flex-direction: column; gap: 10px;"> 
                </div>
        </div>
        <div class="modal-footer"> 
            <button class="save" id="close-quick-reply-category-manager-btn" style="width: 100%;" data-lang-key="done">ÂÆåÊàê</button> 
        </div>
    </div>
</div>
<div id="char-music-restore-btn" style="display: none;">
  <img src="https://static.eeo.cn/upload/images/20251114/78d48a9f1d73b2bc6003.png" alt="Restore Music" style="width: 100%; height: 100%; ">
  </div>
<div id="video-call-restore-btn" style="display: none;">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polygon points="23 7 16 12 23 17 23 7"></polygon>
        <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
    </svg>
</div>
<div id="char-music-player-modal" class="modal">
        <div class="modal-content">
          <button id="minimize-char-music-btn" class="char-player-minimize-btn" title="ÊúÄÂ∞èÂåñ">
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round">
    <line x1="5" y1="12" x2="19" y2="12"></line>
  </svg>
</button>
          <div class="char-player-body">
            <div class="char-player-song-info">
              <p id="char-music-player-title">Ê≠åÊõ≤ÂêçÁß∞</p>
              <p id="char-music-artist">Ê≠åÊâã</p>
            </div>
            <div id="char-vinyl-container"> <img id="char-music-cover" src=""> </div>
            <div id="char-music-lyrics"> </div>
            <div class="char-player-footer">
              <div class="char-player-progress-bar-container"> <span id="char-music-current-time" class="time-display">0:00</span>
                <div id="char-music-progress-bar" class="char-player-progress-bar">
                  <div id="char-music-progress-fill"></div>
                </div> <span id="char-music-total-time" class="time-display">0:00</span>
              </div>
              <div class="char-player-controls"> <button id="char-music-prev-btn" class="control-btn"> <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                    <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"></path>
                  </svg> </button> <button id="char-music-play-pause-btn" class="control-btn play"> <svg viewBox="0 0 24 24" width="32" height="32" fill="currentColor">
                    <path d="M8 5v14l11-7z"></path>
                  </svg> </button> <button id="char-music-next-btn" class="control-btn"> <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                    <path d="M16 6h2v12h-2zm-3.5 6l-8.5 6V6z"></path>
                  </svg> </button> <button id="char-music-mode-btn" class="control-btn mode">È°∫Â∫è</button> </div>
            </div>
          </div> <button id="close-char-music-player-btn" class="char-player-close-btn">√ó</button>
        </div>
      </div>
<!-- Êñ∞Â¢ûÔºö‰∫≤Â±ûÂç°Ëµ†ÈÄÅ‰∏ìÂ±ûÂºπÁ™ó -->
<div id="kinship-creation-modal" class="modal">
  <div class="modal-content" style="height: 70%; display: flex; flex-direction: column;">
    <div class="modal-header">
      <span>Ëµ†ÈÄÅ‰∫≤Â±ûÂç°</span>
    </div>
    
    <!-- ‰∏≠Èó¥ÈÉ®ÂàÜÔºöÂàÜ‰∏∫‰∏äÈù¢ÁöÑËßíËâ≤ÂàóË°®Âíå‰∏ãÈù¢ÁöÑÈáëÈ¢ùËæìÂÖ• -->
    <div class="modal-body" style="padding: 0; flex-grow: 1; display: flex; flex-direction: column; overflow: hidden;">
      
      <!-- ÊèêÁ§∫ËØ≠ -->
      <div style="padding: 10px 15px; background-color: #f5f5f7; color: #666; font-size: 13px; border-bottom: 1px solid var(--border-color);">
        ËØ∑ÈÄâÊã©Ëµ†‰∫àÂØπË±° (ÂçïÈÄâ)
      </div>

      <!-- ËßíËâ≤ÂàóË°®Âå∫Âüü (Â§çÁî®Ê∏ÖÁêÜÊï∞ÊçÆÁöÑÊ†∑Âºè) -->
      <div id="kinship-char-list" style="flex-grow: 1; overflow-y: auto;">
        <!-- JS Âä®ÊÄÅÂ°´ÂÖÖ -->
      </div>

      <!-- ÈáëÈ¢ùËæìÂÖ•Âå∫Âüü -->
      <div style="padding: 20px; background-color: #fff; border-top: 1px solid var(--border-color); box-shadow: 0 -2px 10px rgba(0,0,0,0.05); z-index: 2;">
        <div class="form-group" style="margin-bottom: 0;">
          <label for="kinship-limit-input" style="font-weight: 600;">ÊØèÊúàÊ∂àË¥πÈ¢ùÂ∫¶</label>
          <div style="position: relative; display: flex; align-items: center;">
             <span style="font-size: 20px; font-weight: bold; margin-right: 5px;">¬•</span>
             <input type="number" id="kinship-limit-input" value="5200" placeholder="ËØ∑ËæìÂÖ•ÈáëÈ¢ù" 
                    style="font-size: 24px; font-weight: bold; color: #ff1744; border: none; border-bottom: 1px solid #ddd; border-radius: 0; padding: 5px 0; background: transparent;">
          </div>
          <p style="font-size: 12px; color: #999; margin-top: 8px;">‰ºòÂÖàÊâ£Èô§‰∫≤Â±ûÂç°È¢ùÂ∫¶ÔºåË∂ÖÂá∫ÈÉ®ÂàÜÁî±ÂØπÊñπËá™‰ªò„ÄÇ</p>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="cancel" id="cancel-kinship-creation-btn" data-lang-key="cancel">ÂèñÊ∂à</button>
      <button class="save" id="confirm-kinship-creation-btn" style="background: linear-gradient(135deg, #ff5252, #ff1744); border: none;">Á°ÆËÆ§Ëµ†ÈÄÅ</button>
    </div>
  </div>
</div>
<div id="inventory-modal" class="modal">
    <div class="modal-content" style="height: 70%; background-color: #1c1c1e; color: #e0e0e0; border: 1px solid #333;">
        <div class="modal-header" style="border-bottom: 1px solid #333; color: #d4af37;">
            <span>ÊàëÁöÑËóèÂìÅ</span>
            <span class="action-btn" onclick="closeInventoryModal()" style="font-size: 20px;">√ó</span>
        </div>
        <div class="modal-body" id="inventory-list" style="padding: 15px; overflow-y: auto;">
            </div>
    </div>
</div>
<div id="todo-editor-modal" class="modal">
    <div class="modal-content" style="height: auto;">
        <div class="modal-header">
            <span id="todo-editor-title">Ê∑ªÂä†‰∫ãÈ°π</span>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>ÂÜÖÂÆπ</label>
                <input type="text" id="todo-content-input" placeholder="‰æãÂ¶ÇÔºöËÆ∞ÂæóÂêÉËçØ„ÄÅ‰∏ãÂçàÂºÄ‰ºö">
            </div>
            <div class="form-group">
                <label>Á±ªÂûã/Ê†áÁ≠æ</label>
                <div class="todo-type-selector" id="todo-type-options">
                    <span class="todo-type-option active" data-value="Êó•Â∏∏" style="--tag-color: #8e8e93;">Êó•Â∏∏</span>
                    <span class="todo-type-option" data-value="Â∑•‰Ωú" style="--tag-color: #007aff;">Â∑•‰Ωú</span>
                    <span class="todo-type-option" data-value="ÈáçË¶Å" style="--tag-color: #ff3b30;">ÈáçË¶Å</span>
                    <span class="todo-type-option" data-value="ÁîüÊ¥ª" style="--tag-color: #34c759;">ÁîüÊ¥ª</span>
                    <span class="todo-type-option" data-value="Á∫¶‰ºö" style="--tag-color: #af52de;">Á∫¶‰ºö</span>
                    <span class="todo-type-option" data-value="ËÆ∞Ë¥¶" style="--tag-color: #ffc107;">ËÆ∞Ë¥¶</span>
                </div>
            </div>
            <div class="form-group">
                <label>Êó•Êúü</label>
                <input type="date" id="todo-date-input">
            </div>
            <div class="form-group">
                <label>ÂÖ∑‰ΩìÊó∂Èó¥ (ÂèØÈÄâ)</label>
                <input type="time" id="todo-time-input">
            </div>
        </div>
        <div class="modal-footer">
            <button class="cancel" id="cancel-todo-editor-btn">ÂèñÊ∂à</button>
            <button class="save" id="save-todo-btn">‰øùÂ≠ò</button>
        </div>
    </div>
</div>
<div id="gr-settings-modal" class="modal">
    <div class="modal-content" style="height: 85%; background-color: #FAFAF9;">
        <div class="gr-header" style="background: transparent; padding: 15px;">
            <span class="gr-title" style="color: #1B4F3E;">‰ΩúÂìÅËÆæÂÆö</span>
        </div>
        <div class="modal-body" style="padding: 0 20px;">
            <div class="gr-form-group">
                <label>‰π¶Âêç</label>
                <input type="text" id="gr-story-title" class="gr-input" placeholder="ËØ∑ËæìÂÖ•‰π¶Âêç">
            </div>
            <div class="gr-form-group">
    <label>ÂÆèÂ§ß‰∏ñÁïåËßÇ / IFÁ∫øËÆæÂÆö (Macro World View)</label>
    <textarea id="gr-macro-world-view" class="gr-input" rows="3" placeholder="Âú®Ê≠§ËæìÂÖ•Ê†∏ÂøÉËÆæÂÆö„ÄÇ‰æãÂ¶ÇÔºö'Ê∞ëÂõΩÂÜõÈòÄËÉåÊôØÔºåCharÊòØÂ∞ëÂ∏ÖÔºåUserÊòØËøõÊ≠•Â≠¶Áîü'ÔºåÊàñËÄÖ 'ABOËÆæÂÆöÔºåCharÊòØEnigma'„ÄÇÊ≠§ËÆæÂÆö‰ºòÂÖàÁ∫ßÊúÄÈ´ò„ÄÇ"></textarea>
</div>
            <div class="gr-form-group">
                <label>ÊåáÂÆö‰ΩúËÄÖ (ÊñáÈ£é)</label>
                <select id="gr-author-select" class="gr-select"></select>
            </div>

            <div class="gr-form-group">
                <label>ÁôªÂú∫ËßíËâ≤ (Chat/NPC/Áæ§ËÅä)</label>
                <div class="gr-checkbox-list" id="gr-char-list"></div>
            </div>

            <div class="gr-form-group">
                <label>‰∏ñÁïåËßÇ (World Book)</label>
                <div class="gr-checkbox-list" id="gr-worldbook-list"></div>
            </div>
            
             <div class="gr-form-group">
                <label>ÊàëÁöÑË∫´‰ªΩ (User Persona)</label>
                <select id="gr-user-persona-select" class="gr-select">
                     <option value="">‰ΩøÁî®ÈªòËÆ§</option>
                </select>
            </div>

            <div class="gr-form-group">
                <label>ÂçïÊ¨°ÁîüÊàêÂ≠óÊï∞ (Token)</label>
                <input type="number" id="gr-output-length" class="gr-input" value="500">
            </div>
             <div class="gr-form-group">
                <label>‰∏ä‰∏ãÊñáÂºïÁî®Êù°Êï∞ (History)</label>
                <input type="number" id="gr-context-limit" class="gr-input" value="20">
            </div>

            <!-- ‰ΩúËÄÖËøΩÊõ¥ÂäüËÉΩ -->
            <div class="gr-form-group" style="border-top: 2px solid #E5E5E5; padding-top: 15px; margin-top: 15px;">
                <label style="display: flex; align-items: center; justify-content: space-between; cursor: pointer;">
                    <span style="font-size: 16px; font-weight: 600; color: #1B4F3E;">
                        üìñ ‰ΩúËÄÖËøΩÊõ¥ÂäüËÉΩ
                        <span style="font-size: 12px; color: #999; font-weight: normal; display: block; margin-top: 5px;">
                            ÂºÄÂêØÂêéÔºåÂèØÂÆöÊó∂‰ΩøÁî®ÊåáÂÆö‰ΩúËÄÖÊñáÈ£éÊàñËßíËâ≤ËßÜËßíËá™Âä®Êõ¥Êñ∞Á´†ËäÇ
                        </span>
                    </span>
                    <input type="checkbox" id="gr-auto-update-enabled" style="width: 44px; height: 24px; cursor: pointer;">
                </label>
            </div>

            <div id="gr-auto-update-settings" style="display: none;">
                <div class="gr-form-group">
                    <label>ËøΩÊõ¥ÊñπÂºè</label>
                    <select id="gr-auto-update-type" class="gr-select">
                        <option value="author">‰ΩøÁî®‰ΩúËÄÖÊñáÈ£é</option>
                        <option value="character">‰ΩøÁî®ËßíËâ≤ËßÜËßí</option>
                    </select>
                </div>

                <div class="gr-form-group" id="gr-update-author-select-group">
                    <label>ÈÄâÊã©‰ΩúËÄÖ</label>
                    <select id="gr-update-author-select" class="gr-select"></select>
                </div>

                <div class="gr-form-group" id="gr-update-character-select-group" style="display: none;">
                    <label>ÈÄâÊã©ËßíËâ≤</label>
                    <select id="gr-update-character-select" class="gr-select"></select>
                </div>

                <div class="gr-form-group">
                    <label>Êõ¥Êñ∞È¢ëÁéá</label>
                    <select id="gr-update-frequency" class="gr-select">
                        <option value="manual">ÊâãÂä®Êõ¥Êñ∞Ôºà‰∏çËá™Âä®Ôºâ</option>
                        <option value="daily">ÊØèÂ§©‰∏ÄÊõ¥</option>
                        <option value="weekly">ÊØèÂë®‰∏ÄÊõ¥</option>
                        <option value="custom">Ëá™ÂÆö‰πâÈó¥Èöî</option>
                    </select>
                </div>

                <div class="gr-form-group" id="gr-custom-frequency-group" style="display: none;">
                    <label>Ëá™ÂÆö‰πâÊõ¥Êñ∞Èó¥ÈöîÔºàÂ∞èÊó∂Ôºâ</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="gr-custom-frequency-hours" class="gr-input" value="24" min="1" max="168" style="flex: 1;">
                        <span style="font-size: 13px; color: #888;">Â∞èÊó∂</span>
                    </div>
                </div>

                <div class="gr-form-group">
                    <label style="font-size: 12px; color: #666;">
                        üí° ÊèêÁ§∫ÔºöÂêØÁî®ËøΩÊõ¥ÂêéÔºåÁ≥ªÁªüÂ∞ÜÊåâÁÖßËÆæÂÆöÁöÑÈ¢ëÁéáËá™Âä®ÁîüÊàêÊñ∞Á´†ËäÇ„ÄÇÊØèÊ¨°Êõ¥Êñ∞ÈÉΩ‰ºö‰ΩøÁî®ÈÄâÊã©ÁöÑ‰ΩúËÄÖÊñáÈ£éÊàñËßíËâ≤ËßÜËßí„ÄÇ
                    </label>
                </div>
            </div>
        </div>
        <div class="modal-footer" style="border-top: 1px solid #E5E5E5;">
            <button class="cancel" id="gr-cancel-settings-btn" style="color: #666;">ÂèñÊ∂à</button>
            <button class="save" id="gr-save-story-btn" style="background: #1B4F3E; border: none;">ÂºÄÂßãÂàõ‰Ωú</button>
        </div>
    </div>
</div>
<div id="gr-author-editor-modal" class="modal">
  <div class="modal-content" style="height: auto;">
    <div class="modal-header">
      <span id="gr-author-editor-title">ÁºñËæë‰ΩúËÄÖ</span>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>‰ΩúËÄÖÂêçÁß∞</label>
        <input type="text" id="gr-author-name-input" placeholder="‰æãÂ¶ÇÔºöÈ≤ÅËøÖÈ£éÊ†º">
      </div>
      <div class="form-group">
        <label>ÊñáÈ£éÊèèËø∞</label>
        <textarea id="gr-author-style-input" rows="5" placeholder="Âú®Ê≠§ÊèèËø∞ËØ•‰ΩúËÄÖÁöÑÁî®ËØç‰π†ÊÉØ„ÄÅÂè•ÂºèÁâπÁÇπ..."></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="cancel" onclick="document.getElementById('gr-author-editor-modal').classList.remove('visible')">ÂèñÊ∂à</button>
      <button class="save" id="gr-save-author-btn">‰øùÂ≠ò</button>
    </div>
  </div>
</div>
<div id="nai-binding-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
        <div class="modal-header">
            <span>ÁªëÂÆöÈ¢ÑËÆæÂà∞ËßíËâ≤</span>
        </div>
        <div class="modal-body" id="nai-binding-list" style="padding: 0;">
            </div>
        <div class="modal-footer">
            <button class="cancel" id="cancel-nai-binding-btn" data-lang-key="cancel">ÂèñÊ∂à</button>
            <button class="save" id="save-nai-binding-btn" data-lang-key="save">‰øùÂ≠òÁªëÂÆö</button>
        </div>
    </div>
</div>
<audio id="silent-audio-player" loop preload="auto" style="display:none;">
    <source src="https://phoebeboo.github.io/mewoooo/1-second-of-silence.mp3" type="audio/mpeg">
  </audio><audio id="tts-audio-player" style="display:none;"></audio>

    <!-- ËÅîÊú∫Â•ΩÂèãÂàóË°®ÂºπÁ™ó -->
    <div id="online-friends-modal" class="modal">
      <div class="modal-content" style="height: 70%;">
        <div class="modal-header">
          <span>ËÅîÊú∫Â•ΩÂèã</span>
          <span class="close-btn" onclick="closeOnlineFriendsModal()">√ó</span>
        </div>
        <div class="modal-body" style="padding: 0;">
          <div id="online-friends-list" style="padding: 15px;">
            <!-- JSÂä®ÊÄÅÂ°´ÂÖÖÂ•ΩÂèãÂàóË°® -->
            <div style="text-align: center; color: #999; padding: 40px 20px;">
              ÊöÇÊó†ËÅîÊú∫Â•ΩÂèã
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Â•ΩÂèãÁî≥ËØ∑ÂºπÁ™ó -->
    <div id="friend-requests-modal" class="modal">
      <div class="modal-content" style="height: 70%;">
        <div class="modal-header">
          <span>Â•ΩÂèãÁî≥ËØ∑</span>
          <span class="close-btn" onclick="closeFriendRequestsModal()">√ó</span>
        </div>
        <div class="modal-body" style="padding: 0;">
          <div id="friend-requests-list" style="padding: 15px;">
            <!-- JSÂä®ÊÄÅÂ°´ÂÖÖÂ•ΩÂèãÁî≥ËØ∑ÂàóË°® -->
            <div style="text-align: center; color: #999; padding: 40px 20px;">
              ÊöÇÊó†Â•ΩÂèãÁî≥ËØ∑
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- MyPhone Ê∑ªÂä†ËÅîÁ≥ª‰∫∫ÈÄâÊã©ÂºπÁ™ó -->
    <div id="myphone-add-choice-modal" class="modal">
      <div class="modal-content" style="width: 300px; height: auto;">
        <div class="modal-header">
          <span>Ê∑ªÂä†ËÅîÁ≥ª‰∫∫</span>
        </div>
        <div class="modal-body" style="padding: 20px;">
          <button id="myphone-manual-create-btn" class="form-button" style="width: 100%; margin-bottom: 15px; background-color: #333; color: #fff; border: none; padding: 15px; border-radius: 8px; font-size: 16px;">ÊâãÂä®ÂàõÂª∫ËßíËâ≤</button>
          <button id="myphone-import-from-main-btn" class="form-button" style="width: 100%; background-color: #333; color: #fff; border: none; padding: 15px; border-radius: 8px; font-size: 16px;">ÂØºÂÖ•‰∏ªÂ±èÂπïQQÂØπËØù</button>
        </div>
        <div class="modal-footer">
          <button class="cancel" id="cancel-myphone-add-choice-btn">ÂèñÊ∂à</button>
        </div>
      </div>
    </div>

    <!-- MyPhone ÂØºÂÖ•ËßíËâ≤ÂºπÁ™ó -->
    <div id="myphone-import-characters-modal" class="modal">
      <div class="modal-content" style="height: 70%;">
        <div class="modal-header">
          <span>ÂØºÂÖ•‰∏ªÂ±èÂπïËßíËâ≤</span>
          <label style="font-size: 14px; font-weight: normal; display: flex; align-items: center; gap: 5px;">
            <input type="checkbox" id="select-all-myphone-import">
            ÂÖ®ÈÄâ
          </label>
        </div>
        <div class="modal-body" id="myphone-import-list" style="padding: 0;">
        </div>
        <div class="modal-footer">
          <button class="cancel" id="cancel-myphone-import-btn">ÂèñÊ∂à</button>
          <button class="save" id="confirm-myphone-import-btn">ÂØºÂÖ•ÈÄâ‰∏≠</button>
        </div>
      </div>
    </div>

    <!-- MyPhone Áõ∏ÂÜåÊ∑ªÂä†ÂºπÁ™ó -->
    <div id="myphone-add-album-modal" class="modal">
      <div class="modal-content" style="height: auto;">
        <div class="modal-header">
          <span>Ê∑ªÂä†ÁÖßÁâá</span>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>ÂõæÁâáÊèèËø∞</label>
            <textarea id="myphone-album-description-input" rows="4" placeholder="ÊèèËø∞ËøôÂº†ÁÖßÁâáÁöÑÂÜÖÂÆπ..."></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button class="cancel" id="cancel-myphone-album-btn">ÂèñÊ∂à</button>
          <button class="save" id="save-myphone-album-btn">‰øùÂ≠ò</button>
        </div>
      </div>
    </div>

    <!-- MyPhone ÊµèËßàÂô®Ê∑ªÂä†ÂºπÁ™ó -->
    <div id="myphone-add-browser-modal" class="modal">
      <div class="modal-content" style="height: auto;">
        <div class="modal-header">
          <span>Ê∑ªÂä†ÊµèËßàËÆ∞ÂΩï</span>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Ê†áÈ¢ò</label>
            <input type="text" id="myphone-browser-title-input" placeholder="ÁΩëÈ°µÊ†áÈ¢ò">
          </div>
          <div class="form-group">
            <label>ÂÜÖÂÆπ</label>
            <textarea id="myphone-browser-content-input" rows="5" placeholder="ÁΩëÈ°µÂÜÖÂÆπ..."></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button class="cancel" id="cancel-myphone-browser-btn">ÂèñÊ∂à</button>
          <button class="save" id="save-myphone-browser-btn">‰øùÂ≠ò</button>
        </div>
      </div>
    </div>

    <!-- MyPhone Ê∑òÂÆùÊ∑ªÂä†ÂºπÁ™ó -->
    <div id="myphone-add-taobao-modal" class="modal">
      <div class="modal-content" style="height: auto; max-height: 80%;">
        <div class="modal-header">
          <span>Ê∑ªÂä†Ë¥≠Áâ©ËÆ∞ÂΩï</span>
        </div>
        <div class="modal-body" style="max-height: calc(80vh - 120px); overflow-y: auto;">
          <div class="form-group">
            <label>ÂïÜÂìÅÂêçÁß∞</label>
            <input type="text" id="myphone-taobao-name-input" placeholder="ÂïÜÂìÅÂêçÁß∞">
          </div>
          <div class="form-group">
            <label>ÂïÜÂìÅÊèèËø∞</label>
            <textarea id="myphone-taobao-description-input" rows="3" placeholder="ÊèèËø∞Ëøô‰∏™ÂïÜÂìÅ..."></textarea>
          </div>
          <div class="form-group">
            <label>Ë¥≠‰π∞ÊÉ≥Ê≥ï</label>
            <textarea id="myphone-taobao-thought-input" rows="3" placeholder="‰∏∫‰ªÄ‰πà‰π∞Ëøô‰∏™ÂïÜÂìÅÔºüÊúâ‰ªÄ‰πàÊÉ≥Ê≥ïÔºü"></textarea>
          </div>
          <div class="form-group">
            <label>ÂïÜÂìÅ‰ª∑Ê†º</label>
            <input type="number" id="myphone-taobao-price-input" placeholder="‰ª∑Ê†º" value="99">
          </div>
          <div class="form-group">
            <label>Áâ©ÊµÅÁä∂ÊÄÅ</label>
            <input type="text" id="myphone-taobao-status-input" placeholder="‰æãÂ¶ÇÔºöÂ∑≤Á≠æÊî∂„ÄÅÈÄÅËææ‰∏≠„ÄÅÂæÖÂèëË¥ß" value="Â∑≤Á≠æÊî∂">
          </div>
          <div class="form-group">
            <label style="display: flex; align-items: center; gap: 8px;">
              <input type="checkbox" id="myphone-taobao-ai-image-checkbox">
              <span>‰ΩøÁî®ÂÖçË¥πAIÁîüÊàêÂïÜÂìÅÂõæ</span>
            </label>
            <p style="font-size: 12px; color: #888; margin: 5px 0 0 0;">Â¶ÇÊûú‰∏çÂãæÈÄâÔºåÂ∞Ü‰ΩøÁî®ÈªòËÆ§ÂõæÁâá</p>
          </div>
        </div>
        <div class="modal-footer">
          <button class="cancel" id="cancel-myphone-taobao-btn">ÂèñÊ∂à</button>
          <button class="save" id="save-myphone-taobao-btn">‰øùÂ≠ò</button>
        </div>
      </div>
    </div>

    <!-- MyPhone Êó•ËÆ∞Ê∑ªÂä†ÂºπÁ™ó -->
    <div id="myphone-add-diary-modal" class="modal">
      <div class="modal-content" style="height: auto; max-height: 80%;">
        <div class="modal-header">
          <span>Ê∑ªÂä†Êó•ËÆ∞</span>
        </div>
        <div class="modal-body" style="max-height: calc(80vh - 120px); overflow-y: auto;">
          <div class="form-group">
            <label>Êó•Êúü</label>
            <input type="date" id="myphone-diary-date-input">
          </div>
          <div class="form-group">
            <label>Â§©Ê∞î</label>
            <input type="text" id="myphone-diary-weather-input" placeholder="‰æãÂ¶ÇÔºöÊô¥Â§©„ÄÅÂ§ö‰∫ë">
          </div>
          <div class="form-group">
            <label>Êó•ËÆ∞Ê†áÈ¢ò</label>
            <input type="text" id="myphone-diary-title-input" placeholder="‰ªäÂ§©ÁöÑÊ†áÈ¢ò">
          </div>
          <div class="form-group">
            <label>ÂâçË®Ä</label>
            <textarea id="myphone-diary-preface-input" rows="2" placeholder="‰ªäÂ§©ÁöÑÂøÉÊÉÖ„ÄÅÊÑüÂèó..."></textarea>
          </div>
          <div class="form-group">
            <label>Êó•ËÆ∞ÂÜÖÂÆπ</label>
            <textarea id="myphone-diary-content-input" rows="6" placeholder="ÂÜô‰∏ã‰ªäÂ§©ÂèëÁîüÁöÑ‰∫ãÊÉÖ..."></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button class="cancel" id="cancel-myphone-diary-btn">ÂèñÊ∂à</button>
          <button class="save" id="save-myphone-diary-btn">‰øùÂ≠ò</button>
        </div>
      </div>
    </div>

    <!-- MyPhone Â§áÂøòÂΩïÊ∑ªÂä†ÂºπÁ™ó -->
    <div id="myphone-add-memo-modal" class="modal">
      <div class="modal-content" style="height: auto;">
        <div class="modal-header">
          <span>Ê∑ªÂä†Â§áÂøòÂΩï</span>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Ê†áÈ¢ò</label>
            <input type="text" id="myphone-memo-title-input" placeholder="Â§áÂøòÂΩïÊ†áÈ¢ò">
          </div>
          <div class="form-group">
            <label>ÂÜÖÂÆπ</label>
            <textarea id="myphone-memo-content-input" rows="6" placeholder="ÂÜô‰∏ã‰Ω†ÁöÑÂ§áÂøòÂÜÖÂÆπ..."></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button class="cancel" id="cancel-myphone-memo-btn">ÂèñÊ∂à</button>
          <button class="save" id="save-myphone-memo-btn">‰øùÂ≠ò</button>
        </div>
      </div>
    </div>

    <!-- MyPhone È´òÂæ∑Âú∞ÂõæÊ∑ªÂä†ÂºπÁ™ó -->
    <div id="myphone-add-amap-modal" class="modal">
      <div class="modal-content" style="height: auto;">
        <div class="modal-header">
          <span>Ê∑ªÂä†Ë∂≥Ëøπ</span>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Âú∞ÁÇπ</label>
            <input type="text" id="myphone-amap-location-input" placeholder="Âéª‰∫ÜÂì™ÈáåÔºü">
          </div>
          <div class="form-group">
            <label>Âú∞ÂùÄ</label>
            <input type="text" id="myphone-amap-address-input" placeholder="ËØ¶ÁªÜÂú∞ÂùÄÔºàÂèØÈÄâÔºâ">
          </div>
          <div class="form-group">
            <label>ÂΩìÊó∂ÁöÑÊÉ≥Ê≥ï</label>
            <textarea id="myphone-amap-thought-input" rows="4" placeholder="Âú®ËøôÈáåÊúâ‰ªÄ‰πàÊÑüÂèó„ÄÅÊÉ≥Ê≥ïÔºü"></textarea>
          </div>
          <div class="form-group">
            <label>‰ªÄ‰πàÊó∂ÂÄô</label>
            <input type="text" id="myphone-amap-time-input" placeholder="‰æãÂ¶ÇÔºö10Â∞èÊó∂Ââç„ÄÅ18Â∞èÊó∂Ââç„ÄÅ2Â§©Ââç">
          </div>
        </div>
        <div class="modal-footer">
          <button class="cancel" id="cancel-myphone-amap-btn">ÂèñÊ∂à</button>
          <button class="save" id="save-myphone-amap-btn">‰øùÂ≠ò</button>
        </div>
      </div>
    </div>

    <!-- MyPhone APP‰ΩøÁî®ËÆ∞ÂΩïÊ∑ªÂä†ÂºπÁ™ó -->
    <div id="myphone-add-usage-modal" class="modal">
      <div class="modal-content" style="height: auto;">
        <div class="modal-header">
          <span>Ê∑ªÂä†‰ΩøÁî®ËÆ∞ÂΩï</span>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Â∫îÁî®ÂêçÁß∞</label>
            <input type="text" id="myphone-usage-app-input" placeholder="‰æãÂ¶ÇÔºöÂæÆ‰ø°„ÄÅÊäñÈü≥„ÄÅÂéüÁ•û">
          </div>
          <div class="form-group">
            <label>Â∫îÁî®ÂàÜÁ±ª</label>
            <input type="text" id="myphone-usage-category-input" placeholder="‰æãÂ¶ÇÔºöÁ§æ‰∫§„ÄÅÊ∏∏Êàè„ÄÅÂΩ±Èü≥">
          </div>
          <div class="form-group">
            <label>Â∫îÁî®ÂõæÊ†áURLÔºàÂèØÈÄâÔºâ</label>
            <input type="text" id="myphone-usage-icon-input" placeholder="ÂõæÊ†áÈìæÊé•ÔºåÁïôÁ©∫Âàô‰ΩøÁî®ÈªòËÆ§ÂõæÊ†á">
          </div>
          <div class="form-group">
            <label>‰ΩøÁî®Êó∂ÈïøÔºàÂàÜÈíüÔºâ</label>
            <input type="number" id="myphone-usage-duration-input" placeholder="‰ΩøÁî®‰∫ÜÂ§ö‰πÖÔºü" value="30">
          </div>
        </div>
        <div class="modal-footer">
          <button class="cancel" id="cancel-myphone-usage-btn">ÂèñÊ∂à</button>
          <button class="save" id="save-myphone-usage-btn">‰øùÂ≠ò</button>
        </div>
      </div>
    </div>

    <!-- MyPhone Èü≥‰πêÊ∑ªÂä†ÂºπÁ™ó -->
    <div id="myphone-add-music-modal" class="modal">
      <div class="modal-content" style="height: auto;">
        <div class="modal-header">
          <span>Ê∑ªÂä†Ê≠åÊõ≤</span>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Ê∑ªÂä†ÊñπÂºè</label>
            <select id="myphone-music-source-select" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--secondary-bg); color: var(--text-color);">
              <option value="local">Êú¨Âú∞Êñá‰ª∂</option>
              <option value="url">ÁΩëÁªúURL</option>
              <option value="yiqiting">‰ªé‰∏ÄËµ∑Âê¨ÂØºÂÖ•</option>
            </select>
          </div>
          
          <!-- ‰∏ÄËµ∑Âê¨Ê≠åÊõ≤ÈÄâÊã©ÂàóË°® -->
          <div id="myphone-yiqiting-list-group" style="display: none;">
            <div class="form-group">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <label style="margin: 0;">ÈÄâÊã©Ë¶ÅÂØºÂÖ•ÁöÑÊ≠åÊõ≤</label>
                <label style="margin: 0; font-size: 14px; color: var(--text-secondary); cursor: pointer;">
                  <input type="checkbox" id="myphone-yiqiting-select-all" style="margin-right: 5px;">ÂÖ®ÈÄâ
                </label>
              </div>
              <div id="myphone-yiqiting-song-list" style="max-height: 300px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 6px; padding: 10px; background: var(--bg-color);">
                <!-- Ê≠åÊõ≤ÂàóË°®Â∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
              </div>
            </div>
          </div>
          
          <!-- Êú¨Âú∞Êñá‰ª∂‰∏ä‰º† -->
          <div class="form-group" id="myphone-music-file-group">
            <label>ÈÄâÊã©Èü≥È¢ëÊñá‰ª∂</label>
            <input type="file" id="myphone-music-file-input" accept="audio/*" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px;">
          </div>
          
          <!-- ÊâãÂä®ËæìÂÖ•‰ø°ÊÅØÔºàÊú¨Âú∞Êñá‰ª∂ÂíåURLÊ®°ÂºèÔºâ -->
          <div id="myphone-music-manual-inputs">
            <div class="form-group">
              <label>Ê≠åÊõ≤Ê†áÈ¢ò</label>
              <input type="text" id="myphone-music-title-input" placeholder="Ê≠åÊõ≤Âêç">
            </div>
            <div class="form-group">
              <label>Ê≠åÊâã</label>
              <input type="text" id="myphone-music-artist-input" placeholder="Ê≠åÊâãÂêç">
            </div>
            <div class="form-group" id="myphone-music-url-group">
              <label>Èü≥‰πêÈìæÊé•</label>
              <input type="text" id="myphone-music-url-input" placeholder="Èü≥‰πêÊñá‰ª∂URL">
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="cancel" id="cancel-myphone-music-btn">ÂèñÊ∂à</button>
          <button class="save" id="save-myphone-music-btn">‰øùÂ≠ò</button>
        </div>
      </div>
    </div>

    <!-- APIË∞ÉÁî®ÂéÜÂè≤Êü•ÁúãÂô®Ê®°ÊÄÅÁ™óÂè£ -->
    <div id="api-history-modal" class="modal">
      <div class="modal-content" style="height: 90%; max-width: 900px;">
        <div class="modal-header">
          <span>APIË∞ÉÁî®ÂéÜÂè≤ - ÊèêÁ§∫ËØçÂíåËøîÂõûÊï∞ÊçÆ</span>
        </div>
        <div class="modal-body" style="padding: 0; height: calc(100% - 100px); overflow: hidden; display: flex; flex-direction: column;">
          <div style="padding: 15px; border-bottom: 1px solid var(--border-color); background: var(--bg-secondary);">
            <div style="color: var(--text-secondary); font-size: 13px; margin-bottom: 10px;">
              ËÆ∞ÂΩï‰∫ÜÊØèÊ¨°APIË∞ÉÁî®ÁöÑÂÆåÊï¥ËØ∑Ê±ÇÂíåÂìçÂ∫îÊï∞ÊçÆÔºåÂåÖÊã¨ÂèëÈÄÅÁöÑÊèêÁ§∫ËØç„ÄÅÁ≥ªÁªüÊèêÁ§∫„ÄÅÂéÜÂè≤Ê∂àÊÅØ‰ª•ÂèäAIËøîÂõûÁöÑÂéüÂßãÊï∞ÊçÆ
            </div>
            <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
              <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 13px;">
                <input type="checkbox" id="api-history-select-all" style="cursor: pointer;">
                ÂÖ®ÈÄâ
              </label>
              <button id="api-history-delete-btn" class="form-button-secondary" style="padding: 8px 15px;">
                Âà†Èô§ÈÄâ‰∏≠
              </button>
              <button id="api-history-export-btn" class="form-button" style="padding: 8px 15px;">
                ÂØºÂá∫‰∏∫JSON
              </button>
            </div>
          </div>
          <div id="api-history-list" style="flex: 1; overflow-y: auto; padding: 15px;">
            <!-- APIË∞ÉÁî®ÂéÜÂè≤ÂàóË°®Â∞ÜÂä®ÊÄÅÁîüÊàê -->
          </div>
        </div>
        <div class="modal-footer">
          <button class="cancel" id="close-api-history-btn">ÂÖ≥Èó≠</button>
        </div>
      </div>
    </div>

<!-- ‚ñº‚ñº‚ñº ‰Ω†ÁîªÊàëÁåúÂäüËÉΩ ‚ñº‚ñº‚ñº -->
<div id="draw-guess-screen" class="screen">
    <div class="header">
        <span class="back-btn" onclick="showScreen('home-screen')">‚Äπ</span>
        <span>‰Ω†ÁîªÊàëÁåú</span>
        <div style="display: flex; gap: 10px;">
            <span class="action-btn" id="draw-guess-settings-btn">ËÆæÁΩÆ</span>
            <span class="action-btn" id="draw-guess-select-char-btn">ÈÄâÊã©</span>
        </div>
    </div>

    <div class="list-container" id="draw-guess-content">
        <!-- Ê∏∏Êàè‰∫§‰∫íÂå∫Âüü -->
        <div id="draw-guess-interactive-area" style="display: none;">
            <div class="player-avatars-container">
                <div class="player-info">
                    <img id="draw-guess-user-avatar" src="" class="player-avatar">
                    <span id="draw-guess-user-name" class="player-name"></span>
                </div>
                <div class="player-info">
                    <img id="draw-guess-char-avatar" src="" class="player-avatar">
                    <span id="draw-guess-char-name" class="player-name"></span>
                </div>
            </div>
            <div id="draw-guess-dialogue-box"></div>
            <div class="draw-guess-input-area">
                <div id="draw-guess-action-bar" style="display:none;">
                    <button class="action-bar-btn" data-action="reply">ÂõûÂ§ç</button>
                    <button class="action-bar-btn" data-action="delete">Âà†Èô§</button>
                    <button class="action-bar-btn" data-action="edit">ÁºñËæë</button>
                    <button class="action-bar-btn" data-action="resay">ÈáçËØ¥</button>
                </div>
                <div class="draw-guess-input-row">
                    <input type="text" id="draw-guess-input" placeholder="ËæìÂÖ•‰Ω†ÁöÑÁåúÊµãÊàñÂØπËØù...">
                    <button id="draw-guess-send-btn">ÂèëÈÄÅ</button>
                </div>
            </div>
        </div>

        <div id="draw-guess-main-area">
            <p id="draw-guess-welcome-text">ËØ∑ÂÖàÁÇπÂáªÂè≥‰∏äËßí"ÈÄâÊã©"ÊåâÈíÆ<br>ÈÇÄËØ∑‰∏Ä‰Ωç‰ºô‰º¥Êù•Áé©ÂêßÔºÅ</p>

            <div id="draw-guess-studio" style="display: none;">
                <canvas id="drawing-canvas"></canvas>
            
                <div id="draw-guess-tool-bar">
                    <div class="drawing-tools left">
                        <div class="color-palette">
                            <div class="color-dot active" style="background-color: #000000;" data-color="#000000"></div>
                            <div class="color-dot" style="background-color: #ff3b30;" data-color="#ff3b30"></div>
                            <div class="color-dot" style="background-color: #ff9500;" data-color="#ff9500"></div>
                            <div class="color-dot" style="background-color: #ffcc00;" data-color="#ffcc00"></div>
                            <div class="color-dot" style="background-color: #4cd964;" data-color="#4cd964"></div>
                            <div class="color-dot" style="background-color: #007aff;" data-color="#007aff"></div>
                            <div class="color-dot" style="background-color: #5856d6;" data-color="#5856d6"></div>
                            <div class="color-dot" style="background-color: #af52de;" data-color="#af52de"></div>
                            <div class="color-dot" style="background-color: #ffffff; border: 1px solid #ddd;" data-color="#ffffff"></div>
                        </div>
                        <div id="custom-color-picker-container" class="custom-color-picker">
                            <input type="color" id="custom-color-input" value="#000000">
                        </div>
                        <div class="tool-buttons">
                            <button class="tool-btn active" data-tool="pen">Á¨î</button>
                            <button class="tool-btn" data-tool="eraser">Ê©°ÁöÆ</button>
                            <button class="tool-btn" data-tool="undo">Êí§Âõû</button>
                            <button id="clear-canvas-btn" class="tool-btn" data-tool="clear">Ê∏ÖÁ©∫</button>
                        </div>
                    </div>
            
                    <div id="brush-settings" style="display: none; width: 100%; max-width: 150px;">
                        <div id="pen-settings">
                            <label for="pen-type-select">Á±ªÂûã</label>
                            <select id="pen-type-select">
                                <option value="pen">Èí¢Á¨î</option>
                                <option value="pencil">ÈìÖÁ¨î</option>
                                <option value="watercolor">Ê∞¥Á¨î</option>
                                <option value="brush">ÁîªÁ¨î</option>
                                <option value="calligraphy">ÊØõÁ¨î</option>
                            </select>
                        </div>
                        <div class="size-control">
                            <label for="brush-size-slider">Â§ßÂ∞è</label>
                            <input type="range" id="brush-size-slider" min="1" max="50" value="5">
                            <input type="number" id="brush-size-input" min="1" value="5">
                        </div>
                    </div>
                    
                    <div class="game-controls-group">
                        <button class="game-control-btn" id="draw-guess-get-topic-btn">AIÂá∫È¢ò</button>
                        <button class="game-control-btn" id="draw-guess-ai-turn-btn">ËΩÆÂà∞‰ªñ‰∫Ü</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="draw-guess-bottom-bar" style="display: none;">
            <button id="start-draw-guess-game-btn" class="form-button">ÂºÄÂßãÊ∏∏Êàè</button>
        </div>
    </div>
</div>

<div id="draw-guess-message-manager-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
        <div class="modal-header">
            <span id="draw-guess-manager-title">ÁÆ°ÁêÜÊ∂àÊÅØ</span>
            <label style="font-size: 14px; font-weight: normal; display: flex; align-items: center; gap: 5px;">
                <input type="checkbox" id="draw-guess-manager-select-all"> ÂÖ®ÈÄâ
            </label>
        </div>
        <div class="modal-body" id="draw-guess-manager-list" style="padding: 0;"></div>
        <div class="modal-footer">
            <button class="cancel" id="draw-guess-manager-cancel-btn">ÂèñÊ∂à</button>
            <button class="save" id="draw-guess-manager-confirm-btn">Á°ÆËÆ§</button>
        </div>
    </div>
</div>

<!-- ‰Ω†ÁîªÊàëÁåúËÆæÁΩÆÂºπÁ™ó -->
<div id="draw-guess-settings-modal" class="modal">
    <div class="modal-content" style="max-width: 400px;">
        <div class="modal-header">
            <span>Ê∏∏ÊàèÊ®°ÂºèËÆæÁΩÆ</span>
        </div>
        <div class="modal-body">
            <div class="setting-item">
                <label style="font-weight: 500; margin-bottom: 8px; display: block;">ÈÄâÊã©Ê∏∏ÊàèÊ®°Âºè</label>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-primary);">
                        <input type="radio" name="draw-guess-mode" value="online" id="draw-guess-mode-online" checked>
                        <div>
                            <div style="font-weight: 500;">Á∫ø‰∏äÊ®°Âºè</div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">Ê®°ÊãüÁ∫ø‰∏äËÅäÂ§©ÔºåËßíËâ≤ÂèØÂèëÂ§öÊù°ÁÆÄÁü≠Ê∂àÊÅØ</div>
                        </div>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-primary);">
                        <input type="radio" name="draw-guess-mode" value="offline" id="draw-guess-mode-offline">
                        <div>
                            <div style="font-weight: 500;">Á∫ø‰∏ãÊ®°Âºè</div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">Ê®°ÊãüÈù¢ÂØπÈù¢Âú∫ÊôØÔºåÂåÖÂê´Âä®‰ΩúÂíåÂú∫ÊôØÊèèÂÜô</div>
                        </div>
                    </label>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="cancel" id="draw-guess-settings-cancel-btn">ÂèñÊ∂à</button>
            <button class="save" id="draw-guess-settings-save-btn">‰øùÂ≠ò</button>
        </div>
    </div>
</div>
<!-- ‚ñ≤‚ñ≤‚ñ≤ ‰Ω†ÁîªÊàëÁåúHTMLÁªìÊùü ‚ñ≤‚ñ≤‚ñ≤ -->

</body>
</html>






































